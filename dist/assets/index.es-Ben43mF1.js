const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C9j5dvsw.js","assets/index-Np5hTTDC.js","assets/index-Bbfu8i3Q.css"])))=>i.map(i=>d[i]);
import{f as Cb,h as Db,i as Ub,j as Fb,k as qb,m as jb,o as Lb,p as zb,q as Mb,r as Bb,s as Cp,t as Dp,u as kb,v as Up,w as K,x as Fp,y as qp,z as Hb,A as Go,B as jp,C as Bo,D as Ti,E as xo,F as Vb,_ as Kb}from"./index-Np5hTTDC.js";import{s as Wo,a as us,d as Gb,r as Lp,e as dr,f as Ri,g as Nu,i as fr,b as hs,c as ef,h as Wb,j as Qb,k as Cu,p as Jb,l as Du,m as Uu,E as Fu,n as oi,o as Zb,q as ui}from"./index.es-BBN_bUeE.js";function zp(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n)}function tf(n,e){e||(e=n.reduce((o,c)=>o+c.length,0));const t=zp(e);let s=0;for(const o of n)t.set(o,s),s+=o.length;return t}const rf={...Bb,...Mb,...zb,...Lb,...jb,...qb,...Fb,...Ub,...Db,...Cb};function Mp(n,e,t,s){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:s}}}const nf=Mp("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Dc=Mp("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=zp(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Bp={utf8:nf,"utf-8":nf,hex:rf.base16,latin1:Dc,ascii:Dc,binary:Dc,...rf};function rr(n,e="utf8"){const t=Bp[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n,"utf8"):t.decoder.decode(`${t.prefix}${n}`)}function Mt(n,e="utf8"){const t=Bp[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):t.encoder.encode(n).substring(1)}const Yb={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};function Xb(n,e=[]){const t=[];return Object.keys(n).forEach(s=>{if(e.length&&!e.includes(s))return;const o=n[s];t.push(...o.accounts)}),t}const e1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function t1(n,e){const{message:t,code:s}=e1[n];return{message:t,code:s}}function hu(n,e){return!!Array.isArray(n)}const r1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,i1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,n1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function s1(n,e){if(n==="__proto__"||n==="constructor"&&e&&typeof e=="object"&&"prototype"in e){o1(n);return}return e}function o1(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function Oo(n,e={}){if(typeof n!="string")return n;if(n[0]==='"'&&n[n.length-1]==='"'&&n.indexOf("\\")===-1)return n.slice(1,-1);const t=n.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!n1.test(n)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(r1.test(n)||i1.test(n)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,s1)}return JSON.parse(n)}catch(s){if(e.strict)throw s;return n}}function a1(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function rt(n,...e){try{return a1(n(...e))}catch(t){return Promise.reject(t)}}function c1(n){const e=typeof n;return n===null||e!=="object"&&e!=="function"}function u1(n){const e=Object.getPrototypeOf(n);return!e||e.isPrototypeOf(Object)}function Fo(n){if(c1(n))return String(n);if(u1(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return Fo(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const lu="base64:";function h1(n){return typeof n=="string"?n:lu+p1(n)}function l1(n){return typeof n!="string"||!n.startsWith(lu)?n:f1(n.slice(lu.length))}function f1(n){return globalThis.Buffer?Buffer.from(n,"base64"):Uint8Array.from(globalThis.atob(n),e=>e.codePointAt(0))}function p1(n){return globalThis.Buffer?Buffer.from(n).toString("base64"):globalThis.btoa(String.fromCodePoint(...n))}function At(n){var e;return n&&((e=n.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function d1(...n){return At(n.join(":"))}function Ao(n){return n=At(n),n?n+":":""}function g1(n,e){if(e===void 0)return!0;let t=0,s=n.indexOf(":");for(;s>-1;)t++,s=n.indexOf(":",s+1);return t<=e}function y1(n,e){return e?n.startsWith(e)&&n[n.length-1]!=="$":n[n.length-1]!=="$"}const m1="memory",v1=()=>{const n=new Map;return{name:m1,getInstance:()=>n,hasItem(e){return n.has(e)},getItem(e){return n.get(e)??null},getItemRaw(e){return n.get(e)??null},setItem(e,t){n.set(e,t)},setItemRaw(e,t){n.set(e,t)},removeItem(e){n.delete(e)},getKeys(){return[...n.keys()]},clear(){n.clear()},dispose(){n.clear()}}};function w1(n={}){const e={mounts:{"":n.driver||v1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=d=>{for(const m of e.mountpoints)if(d.startsWith(m))return{base:m,relativeKey:d.slice(m.length),driver:e.mounts[m]};return{base:"",relativeKey:d,driver:e.mounts[""]}},s=(d,m)=>e.mountpoints.filter(b=>b.startsWith(d)||m&&d.startsWith(b)).map(b=>({relativeBase:d.length>b.length?d.slice(b.length):void 0,mountpoint:b,driver:e.mounts[b]})),o=(d,m)=>{if(e.watching){m=At(m);for(const b of e.watchListeners)b(d,m)}},c=async()=>{if(!e.watching){e.watching=!0;for(const d in e.mounts)e.unwatch[d]=await sf(e.mounts[d],o,d)}},h=async()=>{if(e.watching){for(const d in e.unwatch)await e.unwatch[d]();e.unwatch={},e.watching=!1}},f=(d,m,b)=>{const E=new Map,A=x=>{let T=E.get(x.base);return T||(T={driver:x.driver,base:x.base,items:[]},E.set(x.base,T)),T};for(const x of d){const T=typeof x=="string",k=At(T?x:x.key),V=T?void 0:x.value,re=T||!x.options?m:{...m,...x.options},U=t(k);A(U).items.push({key:k,value:V,relativeKey:U.relativeKey,options:re})}return Promise.all([...E.values()].map(x=>b(x))).then(x=>x.flat())},y={hasItem(d,m={}){d=At(d);const{relativeKey:b,driver:E}=t(d);return rt(E.hasItem,b,m)},getItem(d,m={}){d=At(d);const{relativeKey:b,driver:E}=t(d);return rt(E.getItem,b,m).then(A=>Oo(A))},getItems(d,m={}){return f(d,m,b=>b.driver.getItems?rt(b.driver.getItems,b.items.map(E=>({key:E.relativeKey,options:E.options})),m).then(E=>E.map(A=>({key:d1(b.base,A.key),value:Oo(A.value)}))):Promise.all(b.items.map(E=>rt(b.driver.getItem,E.relativeKey,E.options).then(A=>({key:E.key,value:Oo(A)})))))},getItemRaw(d,m={}){d=At(d);const{relativeKey:b,driver:E}=t(d);return E.getItemRaw?rt(E.getItemRaw,b,m):rt(E.getItem,b,m).then(A=>l1(A))},async setItem(d,m,b={}){if(m===void 0)return y.removeItem(d);d=At(d);const{relativeKey:E,driver:A}=t(d);A.setItem&&(await rt(A.setItem,E,Fo(m),b),A.watch||o("update",d))},async setItems(d,m){await f(d,m,async b=>{if(b.driver.setItems)return rt(b.driver.setItems,b.items.map(E=>({key:E.relativeKey,value:Fo(E.value),options:E.options})),m);b.driver.setItem&&await Promise.all(b.items.map(E=>rt(b.driver.setItem,E.relativeKey,Fo(E.value),E.options)))})},async setItemRaw(d,m,b={}){if(m===void 0)return y.removeItem(d,b);d=At(d);const{relativeKey:E,driver:A}=t(d);if(A.setItemRaw)await rt(A.setItemRaw,E,m,b);else if(A.setItem)await rt(A.setItem,E,h1(m),b);else return;A.watch||o("update",d)},async removeItem(d,m={}){typeof m=="boolean"&&(m={removeMeta:m}),d=At(d);const{relativeKey:b,driver:E}=t(d);E.removeItem&&(await rt(E.removeItem,b,m),(m.removeMeta||m.removeMata)&&await rt(E.removeItem,b+"$",m),E.watch||o("remove",d))},async getMeta(d,m={}){typeof m=="boolean"&&(m={nativeOnly:m}),d=At(d);const{relativeKey:b,driver:E}=t(d),A=Object.create(null);if(E.getMeta&&Object.assign(A,await rt(E.getMeta,b,m)),!m.nativeOnly){const x=await rt(E.getItem,b+"$",m).then(T=>Oo(T));x&&typeof x=="object"&&(typeof x.atime=="string"&&(x.atime=new Date(x.atime)),typeof x.mtime=="string"&&(x.mtime=new Date(x.mtime)),Object.assign(A,x))}return A},setMeta(d,m,b={}){return this.setItem(d+"$",m,b)},removeMeta(d,m={}){return this.removeItem(d+"$",m)},async getKeys(d,m={}){var k;d=Ao(d);const b=s(d,!0);let E=[];const A=[];let x=!0;for(const V of b){(k=V.driver.flags)!=null&&k.maxDepth||(x=!1);const re=await rt(V.driver.getKeys,V.relativeBase,m);for(const U of re){const H=V.mountpoint+At(U);E.some(ee=>H.startsWith(ee))||A.push(H)}E=[V.mountpoint,...E.filter(U=>!U.startsWith(V.mountpoint))]}const T=m.maxDepth!==void 0&&!x;return A.filter(V=>(!T||g1(V,m.maxDepth))&&y1(V,d))},async clear(d,m={}){d=Ao(d),await Promise.all(s(d,!1).map(async b=>{if(b.driver.clear)return rt(b.driver.clear,b.relativeBase,m);if(b.driver.removeItem){const E=await b.driver.getKeys(b.relativeBase||"",m);return Promise.all(E.map(A=>b.driver.removeItem(A,m)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(d=>of(d)))},async watch(d){return await c(),e.watchListeners.push(d),async()=>{e.watchListeners=e.watchListeners.filter(m=>m!==d),e.watchListeners.length===0&&await h()}},async unwatch(){e.watchListeners=[],await h()},mount(d,m){if(d=Ao(d),d&&e.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(e.mountpoints.push(d),e.mountpoints.sort((b,E)=>E.length-b.length)),e.mounts[d]=m,e.watching&&Promise.resolve(sf(m,o,d)).then(b=>{e.unwatch[d]=b}).catch(console.error),y},async unmount(d,m=!0){var b,E;d=Ao(d),!(!d||!e.mounts[d])&&(e.watching&&d in e.unwatch&&((E=(b=e.unwatch)[d])==null||E.call(b),delete e.unwatch[d]),m&&await of(e.mounts[d]),e.mountpoints=e.mountpoints.filter(A=>A!==d),delete e.mounts[d])},getMount(d=""){d=At(d)+":";const m=t(d);return{driver:m.driver,base:m.base}},getMounts(d="",m={}){return d=At(d),s(d,m.parents).map(E=>({driver:E.driver,base:E.mountpoint}))},keys:(d,m={})=>y.getKeys(d,m),get:(d,m={})=>y.getItem(d,m),set:(d,m,b={})=>y.setItem(d,m,b),has:(d,m={})=>y.hasItem(d,m),del:(d,m={})=>y.removeItem(d,m),remove:(d,m={})=>y.removeItem(d,m)};return y}function sf(n,e,t){return n.watch?n.watch((s,o)=>e(s,t+o)):()=>{}}async function of(n){typeof n.dispose=="function"&&await rt(n.dispose)}function Ni(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function kp(n,e){let t;const s=()=>{if(t)return t;const o=indexedDB.open(n);return o.onupgradeneeded=()=>o.result.createObjectStore(e),t=Ni(o),t.then(c=>{c.onclose=()=>t=void 0},()=>{}),t};return(o,c)=>s().then(h=>c(h.transaction(e,o).objectStore(e)))}let Uc;function ls(){return Uc||(Uc=kp("keyval-store","keyval")),Uc}function af(n,e=ls()){return e("readonly",t=>Ni(t.get(n)))}function b1(n,e,t=ls()){return t("readwrite",s=>(s.put(e,n),Ni(s.transaction)))}function _1(n,e=ls()){return e("readwrite",t=>(t.delete(n),Ni(t.transaction)))}function E1(n=ls()){return n("readwrite",e=>(e.clear(),Ni(e.transaction)))}function I1(n,e){return n.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Ni(n.transaction)}function S1(n=ls()){return n("readonly",e=>{if(e.getAllKeys)return Ni(e.getAllKeys());const t=[];return I1(e,s=>t.push(s.key)).then(()=>t)})}const P1="idb-keyval";var x1=(n={})=>{const e=n.base&&n.base.length>0?`${n.base}:`:"",t=o=>e+o;let s;return n.dbName&&n.storeName&&(s=kp(n.dbName,n.storeName)),{name:P1,options:n,async hasItem(o){return!(typeof await af(t(o),s)>"u")},async getItem(o){return await af(t(o),s)??null},setItem(o,c){return b1(t(o),c,s)},removeItem(o){return _1(t(o),s)},getKeys(){return S1(s)},clear(){return E1(s)}}};const O1="WALLET_CONNECT_V2_INDEXED_DB",A1="keyvaluestorage";let $1=class{constructor(){this.indexedDb=w1({driver:x1({dbName:O1,storeName:A1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,us(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Fc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qo={exports:{}};(function(){let n;function e(){}n=e,n.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},n.prototype.setItem=function(t,s){this[t]=String(s)},n.prototype.removeItem=function(t){delete this[t]},n.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(s){t[s]=void 0,delete t[s]})},n.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Fc<"u"&&Fc.localStorage?qo.exports=Fc.localStorage:typeof window<"u"&&window.localStorage?qo.exports=window.localStorage:qo.exports=new e})();function R1(n){var e;return[n[0],Wo((e=n[1])!=null?e:"")]}let T1=class{constructor(){this.localStorage=qo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(R1)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return Wo(t)}async setItem(e,t){this.localStorage.setItem(e,us(t))}async removeItem(e){this.localStorage.removeItem(e)}};const N1="wc_storage_version",cf=1,C1=async(n,e,t)=>{const s=N1,o=await e.getItem(s);if(o&&o>=cf){t(e);return}const c=await n.getKeys();if(!c.length){t(e);return}const h=[];for(;c.length;){const f=c.shift();if(!f)continue;const y=f.toLowerCase();if(y.includes("wc@")||y.includes("walletconnect")||y.includes("wc_")||y.includes("wallet_connect")){const d=await n.getItem(f);await e.setItem(f,d),h.push(f)}}await e.setItem(s,cf),t(e),D1(n,h)},D1=async(n,e)=>{e.length&&e.forEach(async t=>{await n.removeItem(t)})};let U1=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new T1;this.storage=e;try{const t=new $1;C1(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var qc={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var fu=function(n,e){return fu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var o in s)s.hasOwnProperty(o)&&(t[o]=s[o])},fu(n,e)};function F1(n,e){fu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var pu=function(){return pu=Object.assign||function(e){for(var t,s=1,o=arguments.length;s<o;s++){t=arguments[s];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},pu.apply(this,arguments)};function q1(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(n);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(n,s[o])&&(t[s[o]]=n[s[o]]);return t}function j1(n,e,t,s){var o=arguments.length,c=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,e,t,s);else for(var f=n.length-1;f>=0;f--)(h=n[f])&&(c=(o<3?h(c):o>3?h(e,t,c):h(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}function L1(n,e){return function(t,s){e(t,s,n)}}function z1(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function M1(n,e,t,s){function o(c){return c instanceof t?c:new t(function(h){h(c)})}return new(t||(t=Promise))(function(c,h){function f(m){try{d(s.next(m))}catch(b){h(b)}}function y(m){try{d(s.throw(m))}catch(b){h(b)}}function d(m){m.done?c(m.value):o(m.value).then(f,y)}d((s=s.apply(n,e||[])).next())})}function B1(n,e){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,o,c,h;return h={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function f(d){return function(m){return y([d,m])}}function y(d){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,o&&(c=d[0]&2?o.return:d[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,d[1])).done)return c;switch(o=0,c&&(d=[d[0]&2,c.value]),d[0]){case 0:case 1:c=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,o=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!c||d[1]>c[0]&&d[1]<c[3])){t.label=d[1];break}if(d[0]===6&&t.label<c[1]){t.label=c[1],c=d;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(d);break}c[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(n,t)}catch(m){d=[6,m],o=0}finally{s=c=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function k1(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}function H1(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function du(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Hp(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var s=t.call(n),o,c=[],h;try{for(;(e===void 0||e-- >0)&&!(o=s.next()).done;)c.push(o.value)}catch(f){h={error:f}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(h)throw h.error}}return c}function V1(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Hp(arguments[e]));return n}function K1(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var s=Array(n),o=0,e=0;e<t;e++)for(var c=arguments[e],h=0,f=c.length;h<f;h++,o++)s[o]=c[h];return s}function as(n){return this instanceof as?(this.v=n,this):new as(n)}function G1(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),o,c=[];return o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o;function h(E){s[E]&&(o[E]=function(A){return new Promise(function(x,T){c.push([E,A,x,T])>1||f(E,A)})})}function f(E,A){try{y(s[E](A))}catch(x){b(c[0][3],x)}}function y(E){E.value instanceof as?Promise.resolve(E.value.v).then(d,m):b(c[0][2],E)}function d(E){f("next",E)}function m(E){f("throw",E)}function b(E,A){E(A),c.shift(),c.length&&f(c[0][0],c[0][1])}}function W1(n){var e,t;return e={},s("next"),s("throw",function(o){throw o}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(o,c){e[o]=n[o]?function(h){return(t=!t)?{value:as(n[o](h)),done:o==="return"}:c?c(h):h}:c}}function Q1(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof du=="function"?du(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(c){t[c]=n[c]&&function(h){return new Promise(function(f,y){h=n[c](h),o(f,y,h.done,h.value)})}}function o(c,h,f,y){Promise.resolve(y).then(function(d){c({value:d,done:f})},h)}}function J1(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function Z1(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function Y1(n){return n&&n.__esModule?n:{default:n}}function X1(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function e_(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}const t_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return pu},__asyncDelegator:W1,__asyncGenerator:G1,__asyncValues:Q1,__await:as,__awaiter:M1,__classPrivateFieldGet:X1,__classPrivateFieldSet:e_,__createBinding:k1,__decorate:j1,__exportStar:H1,__extends:F1,__generator:B1,__importDefault:Y1,__importStar:Z1,__makeTemplateObject:J1,__metadata:z1,__param:L1,__read:Hp,__rest:q1,__spread:V1,__spreadArrays:K1,__values:du},Symbol.toStringTag,{value:"Module"})),Qo=Cp(t_);var Kn={},jc={},Gn={};class Ci{}const r_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ci},Symbol.toStringTag,{value:"Module"})),i_=Cp(r_);var uf;function n_(){if(uf)return Gn;uf=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.IHeartBeat=void 0;const n=i_;class e extends n.IEvents{constructor(s){super()}}return Gn.IHeartBeat=e,Gn}var hf;function Vp(){return hf||(hf=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Qo.__exportStar(n_(),n)}(jc)),jc}var Lc={},xi={},lf;function s_(){if(lf)return xi;lf=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.HEARTBEAT_EVENTS=xi.HEARTBEAT_INTERVAL=void 0;const n=Dp();return xi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,xi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},xi}var ff;function Kp(){return ff||(ff=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Qo.__exportStar(s_(),n)}(Lc)),Lc}var pf;function o_(){if(pf)return Kn;pf=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.HeartBeat=void 0;const n=Qo,e=kb(),t=Dp(),s=Vp(),o=Kp();class c extends s.IHeartBeat{constructor(f){super(f),this.events=new e.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(f==null?void 0:f.interval)||o.HEARTBEAT_INTERVAL}static init(f){return n.__awaiter(this,void 0,void 0,function*(){const y=new c(f);return yield y.init(),y})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(f,y){this.events.on(f,y)}once(f,y){this.events.once(f,y)}off(f,y){this.events.off(f,y)}removeListener(f,y){this.events.removeListener(f,y)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Kn.HeartBeat=c,Kn}var df;function a_(){return df||(df=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=Qo;e.__exportStar(o_(),n),e.__exportStar(Vp(),n),e.__exportStar(Kp(),n)}(qc)),qc}var fs=a_(),zc,gf;function c_(){if(gf)return zc;gf=1;function n(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}zc=e;function e(t,s,o){var c=o&&o.stringify||n,h=1;if(typeof t=="object"&&t!==null){var f=s.length+h;if(f===1)return t;var y=new Array(f);y[0]=c(t);for(var d=1;d<f;d++)y[d]=c(s[d]);return y.join(" ")}if(typeof t!="string")return t;var m=s.length;if(m===0)return t;for(var b="",E=1-h,A=-1,x=t&&t.length||0,T=0;T<x;){if(t.charCodeAt(T)===37&&T+1<x){switch(A=A>-1?A:0,t.charCodeAt(T+1)){case 100:case 102:if(E>=m||s[E]==null)break;A<T&&(b+=t.slice(A,T)),b+=Number(s[E]),A=T+2,T++;break;case 105:if(E>=m||s[E]==null)break;A<T&&(b+=t.slice(A,T)),b+=Math.floor(Number(s[E])),A=T+2,T++;break;case 79:case 111:case 106:if(E>=m||s[E]===void 0)break;A<T&&(b+=t.slice(A,T));var k=typeof s[E];if(k==="string"){b+="'"+s[E]+"'",A=T+2,T++;break}if(k==="function"){b+=s[E].name||"<anonymous>",A=T+2,T++;break}b+=c(s[E]),A=T+2,T++;break;case 115:if(E>=m)break;A<T&&(b+=t.slice(A,T)),b+=String(s[E]),A=T+2,T++;break;case 37:A<T&&(b+=t.slice(A,T)),b+="%",A=T+2,T++,E--;break}++E}++T}return A===-1?t:(A<x&&(b+=t.slice(A)),b)}return zc}var Mc,yf;function u_(){if(yf)return Mc;yf=1;const n=c_();Mc=o;const e=ee().console||{},t={mapHttpRequest:x,mapHttpResponse:x,wrapRequestSerializer:T,wrapResponseSerializer:T,wrapErrorSerializer:T,req:x,res:x,err:E};function s(R,q){return Array.isArray(R)?R.filter(function(Y){return Y!=="!stdSerializers.err"}):R===!0?Object.keys(q):!1}function o(R){R=R||{},R.browser=R.browser||{};const q=R.browser.transmit;if(q&&typeof q.send!="function")throw Error("pino: transmit option must have a send function");const L=R.browser.write||e;R.browser.write&&(R.browser.asObject=!0);const Y=R.serializers||{},ae=s(R.browser.serialize,Y);let we=R.browser.serialize;Array.isArray(R.browser.serialize)&&R.browser.serialize.indexOf("!stdSerializers.err")>-1&&(we=!1);const Pe=["error","fatal","warn","info","debug","trace"];typeof L=="function"&&(L.error=L.fatal=L.warn=L.info=L.debug=L.trace=L),R.enabled===!1&&(R.level="silent");const We=R.level||"info",ie=Object.create(L);ie.log||(ie.log=k),Object.defineProperty(ie,"levelVal",{get:j}),Object.defineProperty(ie,"level",{get:G,set:Z});const Q={transmit:q,serialize:ae,asObject:R.browser.asObject,levels:Pe,timestamp:A(R)};ie.levels=o.levels,ie.level=We,ie.setMaxListeners=ie.getMaxListeners=ie.emit=ie.addListener=ie.on=ie.prependListener=ie.once=ie.prependOnceListener=ie.removeListener=ie.removeAllListeners=ie.listeners=ie.listenerCount=ie.eventNames=ie.write=ie.flush=k,ie.serializers=Y,ie._serialize=ae,ie._stdErrSerialize=we,ie.child=ye,q&&(ie._logEvent=b());function j(){return this.level==="silent"?1/0:this.levels.values[this.level]}function G(){return this._level}function Z(J){if(J!=="silent"&&!this.levels.values[J])throw Error("unknown level "+J);this._level=J,c(Q,ie,"error","log"),c(Q,ie,"fatal","error"),c(Q,ie,"warn","error"),c(Q,ie,"info","log"),c(Q,ie,"debug","log"),c(Q,ie,"trace","log")}function ye(J,ce){if(!J)throw new Error("missing bindings for child Pino");ce=ce||{},ae&&J.serializers&&(ce.serializers=J.serializers);const Oe=ce.serializers;if(ae&&Oe){var be=Object.assign({},Y,Oe),Ae=R.browser.serialize===!0?Object.keys(be):ae;delete J.serializers,y([J],Ae,be,this._stdErrSerialize)}function X(Ie){this._childLevel=(Ie._childLevel|0)+1,this.error=d(Ie,J,"error"),this.fatal=d(Ie,J,"fatal"),this.warn=d(Ie,J,"warn"),this.info=d(Ie,J,"info"),this.debug=d(Ie,J,"debug"),this.trace=d(Ie,J,"trace"),be&&(this.serializers=be,this._serialize=Ae),q&&(this._logEvent=b([].concat(Ie._logEvent.bindings,J)))}return X.prototype=this,new X(this)}return ie}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=t,o.stdTimeFunctions=Object.assign({},{nullTime:V,epochTime:re,unixTime:U,isoTime:H});function c(R,q,L,Y){const ae=Object.getPrototypeOf(q);q[L]=q.levelVal>q.levels.values[L]?k:ae[L]?ae[L]:e[L]||e[Y]||k,h(R,q,L)}function h(R,q,L){!R.transmit&&q[L]===k||(q[L]=function(Y){return function(){const we=R.timestamp(),Pe=new Array(arguments.length),We=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var ie=0;ie<Pe.length;ie++)Pe[ie]=arguments[ie];if(R.serialize&&!R.asObject&&y(Pe,this._serialize,this.serializers,this._stdErrSerialize),R.asObject?Y.call(We,f(this,L,Pe,we)):Y.apply(We,Pe),R.transmit){const Q=R.transmit.level||q.level,j=o.levels.values[Q],G=o.levels.values[L];if(G<j)return;m(this,{ts:we,methodLevel:L,methodValue:G,transmitValue:o.levels.values[R.transmit.level||q.level],send:R.transmit.send,val:q.levelVal},Pe)}}}(q[L]))}function f(R,q,L,Y){R._serialize&&y(L,R._serialize,R.serializers,R._stdErrSerialize);const ae=L.slice();let we=ae[0];const Pe={};Y&&(Pe.time=Y),Pe.level=o.levels.values[q];let We=(R._childLevel|0)+1;if(We<1&&(We=1),we!==null&&typeof we=="object"){for(;We--&&typeof ae[0]=="object";)Object.assign(Pe,ae.shift());we=ae.length?n(ae.shift(),ae):void 0}else typeof we=="string"&&(we=n(ae.shift(),ae));return we!==void 0&&(Pe.msg=we),Pe}function y(R,q,L,Y){for(const ae in R)if(Y&&R[ae]instanceof Error)R[ae]=o.stdSerializers.err(R[ae]);else if(typeof R[ae]=="object"&&!Array.isArray(R[ae]))for(const we in R[ae])q&&q.indexOf(we)>-1&&we in L&&(R[ae][we]=L[we](R[ae][we]))}function d(R,q,L){return function(){const Y=new Array(1+arguments.length);Y[0]=q;for(var ae=1;ae<Y.length;ae++)Y[ae]=arguments[ae-1];return R[L].apply(this,Y)}}function m(R,q,L){const Y=q.send,ae=q.ts,we=q.methodLevel,Pe=q.methodValue,We=q.val,ie=R._logEvent.bindings;y(L,R._serialize||Object.keys(R.serializers),R.serializers,R._stdErrSerialize===void 0?!0:R._stdErrSerialize),R._logEvent.ts=ae,R._logEvent.messages=L.filter(function(Q){return ie.indexOf(Q)===-1}),R._logEvent.level.label=we,R._logEvent.level.value=Pe,Y(we,R._logEvent,We),R._logEvent=b(ie)}function b(R){return{ts:0,messages:[],bindings:R||[],level:{label:"",value:0}}}function E(R){const q={type:R.constructor.name,msg:R.message,stack:R.stack};for(const L in R)q[L]===void 0&&(q[L]=R[L]);return q}function A(R){return typeof R.timestamp=="function"?R.timestamp:R.timestamp===!1?V:re}function x(){return{}}function T(R){return R}function k(){}function V(){return!1}function re(){return Date.now()}function U(){return Math.round(Date.now()/1e3)}function H(){return new Date(Date.now()).toISOString()}function ee(){function R(q){return typeof q<"u"&&q}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return R(self)||R(window)||R(this)||{}}}return Mc}var h_=u_();const Jo=Up(h_),l_={level:"info"},ps="custom_context";var f_=Object.defineProperty,p_=Object.defineProperties,d_=Object.getOwnPropertyDescriptors,mf=Object.getOwnPropertySymbols,g_=Object.prototype.hasOwnProperty,y_=Object.prototype.propertyIsEnumerable,vf=(n,e,t)=>e in n?f_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,m_=(n,e)=>{for(var t in e||(e={}))g_.call(e,t)&&vf(n,t,e[t]);if(mf)for(var t of mf(e))y_.call(e,t)&&vf(n,t,e[t]);return n},v_=(n,e)=>p_(n,d_(e));function Zo(n){return v_(m_({},n),{level:(n==null?void 0:n.level)||l_.level})}function w_(n,e=ps){return n[e]||""}function b_(n,e,t=ps){return n[t]=e,n}function $t(n,e=ps){let t="";return typeof n.bindings>"u"?t=w_(n,e):t=n.bindings().context||"",t}function __(n,e,t=ps){const s=$t(n,t);return s.trim()?`${s}/${e}`:e}function Bt(n,e,t=ps){const s=__(n,e,t),o=n.child({context:s});return b_(o,s,t)}class E_ extends Ci{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let I_=class extends Ci{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},S_=class{constructor(e,t){this.logger=e,this.core=t}},P_=class extends Ci{constructor(e,t){super(),this.relayer=e,this.logger=t}},x_=class extends Ci{constructor(e){super()}},O_=class{constructor(e,t,s,o){this.core=e,this.logger=t,this.name=s}};class A_ extends Ci{constructor(e,t){super(),this.relayer=e,this.logger=t}}let $_=class extends Ci{constructor(e,t){super(),this.core=e,this.logger=t}},R_=class{constructor(e,t){this.projectId=e,this.logger=t}},T_=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},N_=class{constructor(e){this.client=e}};function C_(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Gp(n,...e){if(!C_(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function wf(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function D_(n,e){Gp(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const fn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bc=n=>new DataView(n.buffer,n.byteOffset,n.byteLength);function U_(n){if(typeof n!="string")throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array(new TextEncoder().encode(n))}function Wp(n){return typeof n=="string"&&(n=U_(n)),Gp(n),n}let F_=class{clone(){return this._cloneInto()}};function q_(n){const e=s=>n().update(Wp(s)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Qp(n=32){if(fn&&typeof fn.getRandomValues=="function")return fn.getRandomValues(new Uint8Array(n));if(fn&&typeof fn.randomBytes=="function")return fn.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}function j_(n,e,t,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,s);const o=BigInt(32),c=BigInt(4294967295),h=Number(t>>o&c),f=Number(t&c),y=s?4:0,d=s?0:4;n.setUint32(e+y,h,s),n.setUint32(e+d,f,s)}class L_ extends F_{constructor(e,t,s,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Bc(this.buffer)}update(e){wf(this);const{view:t,buffer:s,blockLen:o}=this;e=Wp(e);const c=e.length;for(let h=0;h<c;){const f=Math.min(o-this.pos,c-h);if(f===o){const y=Bc(e);for(;o<=c-h;h+=o)this.process(y,h);continue}s.set(e.subarray(h,h+f),this.pos),this.pos+=f,h+=f,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wf(this),D_(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:o,isLE:c}=this;let{pos:h}=this;t[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(s,0),h=0);for(let b=h;b<o;b++)t[b]=0;j_(s,o-8,BigInt(this.length*8),c),this.process(s,0);const f=Bc(e),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=y/4,m=this.get();if(d>m.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<d;b++)f.setUint32(4*b,m[b],c)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:o,finished:c,destroyed:h,pos:f}=this;return e.length=o,e.pos=f,e.finished=c,e.destroyed=h,o%t&&e.buffer.set(s),e}}const $o=BigInt(2**32-1),gu=BigInt(32);function Jp(n,e=!1){return e?{h:Number(n&$o),l:Number(n>>gu&$o)}:{h:Number(n>>gu&$o)|0,l:Number(n&$o)|0}}function z_(n,e=!1){let t=new Uint32Array(n.length),s=new Uint32Array(n.length);for(let o=0;o<n.length;o++){const{h:c,l:h}=Jp(n[o],e);[t[o],s[o]]=[c,h]}return[t,s]}const M_=(n,e)=>BigInt(n>>>0)<<gu|BigInt(e>>>0),B_=(n,e,t)=>n>>>t,k_=(n,e,t)=>n<<32-t|e>>>t,H_=(n,e,t)=>n>>>t|e<<32-t,V_=(n,e,t)=>n<<32-t|e>>>t,K_=(n,e,t)=>n<<64-t|e>>>t-32,G_=(n,e,t)=>n>>>t-32|e<<64-t,W_=(n,e)=>e,Q_=(n,e)=>n,J_=(n,e,t)=>n<<t|e>>>32-t,Z_=(n,e,t)=>e<<t|n>>>32-t,Y_=(n,e,t)=>e<<t-32|n>>>64-t,X_=(n,e,t)=>n<<t-32|e>>>64-t;function eE(n,e,t,s){const o=(e>>>0)+(s>>>0);return{h:n+t+(o/2**32|0)|0,l:o|0}}const tE=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),rE=(n,e,t,s)=>e+t+s+(n/2**32|0)|0,iE=(n,e,t,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(s>>>0),nE=(n,e,t,s,o)=>e+t+s+o+(n/2**32|0)|0,sE=(n,e,t,s,o)=>(n>>>0)+(e>>>0)+(t>>>0)+(s>>>0)+(o>>>0),oE=(n,e,t,s,o,c)=>e+t+s+o+c+(n/2**32|0)|0,de={fromBig:Jp,split:z_,toBig:M_,shrSH:B_,shrSL:k_,rotrSH:H_,rotrSL:V_,rotrBH:K_,rotrBL:G_,rotr32H:W_,rotr32L:Q_,rotlSH:J_,rotlSL:Z_,rotlBH:Y_,rotlBL:X_,add:eE,add3L:tE,add3H:rE,add4L:iE,add4H:nE,add5H:oE,add5L:sE},[aE,cE]=de.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),ni=new Uint32Array(80),si=new Uint32Array(80);let uE=class extends L_{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:s,Bl:o,Ch:c,Cl:h,Dh:f,Dl:y,Eh:d,El:m,Fh:b,Fl:E,Gh:A,Gl:x,Hh:T,Hl:k}=this;return[e,t,s,o,c,h,f,y,d,m,b,E,A,x,T,k]}set(e,t,s,o,c,h,f,y,d,m,b,E,A,x,T,k){this.Ah=e|0,this.Al=t|0,this.Bh=s|0,this.Bl=o|0,this.Ch=c|0,this.Cl=h|0,this.Dh=f|0,this.Dl=y|0,this.Eh=d|0,this.El=m|0,this.Fh=b|0,this.Fl=E|0,this.Gh=A|0,this.Gl=x|0,this.Hh=T|0,this.Hl=k|0}process(e,t){for(let U=0;U<16;U++,t+=4)ni[U]=e.getUint32(t),si[U]=e.getUint32(t+=4);for(let U=16;U<80;U++){const H=ni[U-15]|0,ee=si[U-15]|0,R=de.rotrSH(H,ee,1)^de.rotrSH(H,ee,8)^de.shrSH(H,ee,7),q=de.rotrSL(H,ee,1)^de.rotrSL(H,ee,8)^de.shrSL(H,ee,7),L=ni[U-2]|0,Y=si[U-2]|0,ae=de.rotrSH(L,Y,19)^de.rotrBH(L,Y,61)^de.shrSH(L,Y,6),we=de.rotrSL(L,Y,19)^de.rotrBL(L,Y,61)^de.shrSL(L,Y,6),Pe=de.add4L(q,we,si[U-7],si[U-16]),We=de.add4H(Pe,R,ae,ni[U-7],ni[U-16]);ni[U]=We|0,si[U]=Pe|0}let{Ah:s,Al:o,Bh:c,Bl:h,Ch:f,Cl:y,Dh:d,Dl:m,Eh:b,El:E,Fh:A,Fl:x,Gh:T,Gl:k,Hh:V,Hl:re}=this;for(let U=0;U<80;U++){const H=de.rotrSH(b,E,14)^de.rotrSH(b,E,18)^de.rotrBH(b,E,41),ee=de.rotrSL(b,E,14)^de.rotrSL(b,E,18)^de.rotrBL(b,E,41),R=b&A^~b&T,q=E&x^~E&k,L=de.add5L(re,ee,q,cE[U],si[U]),Y=de.add5H(L,V,H,R,aE[U],ni[U]),ae=L|0,we=de.rotrSH(s,o,28)^de.rotrBH(s,o,34)^de.rotrBH(s,o,39),Pe=de.rotrSL(s,o,28)^de.rotrBL(s,o,34)^de.rotrBL(s,o,39),We=s&c^s&f^c&f,ie=o&h^o&y^h&y;V=T|0,re=k|0,T=A|0,k=x|0,A=b|0,x=E|0,{h:b,l:E}=de.add(d|0,m|0,Y|0,ae|0),d=f|0,m=y|0,f=c|0,y=h|0,c=s|0,h=o|0;const Q=de.add3L(ae,Pe,ie);s=de.add3H(Q,Y,we,We),o=Q|0}({h:s,l:o}=de.add(this.Ah|0,this.Al|0,s|0,o|0)),{h:c,l:h}=de.add(this.Bh|0,this.Bl|0,c|0,h|0),{h:f,l:y}=de.add(this.Ch|0,this.Cl|0,f|0,y|0),{h:d,l:m}=de.add(this.Dh|0,this.Dl|0,d|0,m|0),{h:b,l:E}=de.add(this.Eh|0,this.El|0,b|0,E|0),{h:A,l:x}=de.add(this.Fh|0,this.Fl|0,A|0,x|0),{h:T,l:k}=de.add(this.Gh|0,this.Gl|0,T|0,k|0),{h:V,l:re}=de.add(this.Hh|0,this.Hl|0,V|0,re|0),this.set(s,o,c,h,f,y,d,m,b,E,A,x,T,k,V,re)}roundClean(){ni.fill(0),si.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const hE=q_(()=>new uE);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qu=BigInt(0),Zp=BigInt(1),lE=BigInt(2);function ju(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Lu(n){if(!ju(n))throw new Error("Uint8Array expected")}function kc(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}const fE=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function zu(n){Lu(n);let e="";for(let t=0;t<n.length;t++)e+=fE[n[t]];return e}function Yp(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?qu:BigInt("0x"+n)}const zr={_0:48,_9:57,A:65,F:70,a:97,f:102};function bf(n){if(n>=zr._0&&n<=zr._9)return n-zr._0;if(n>=zr.A&&n<=zr.F)return n-(zr.A-10);if(n>=zr.a&&n<=zr.f)return n-(zr.a-10)}function Xp(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(t);for(let o=0,c=0;o<t;o++,c+=2){const h=bf(n.charCodeAt(c)),f=bf(n.charCodeAt(c+1));if(h===void 0||f===void 0){const y=n[c]+n[c+1];throw new Error('hex string expected, got non-hex character "'+y+'" at index '+c)}s[o]=h*16+f}return s}function pE(n){return Yp(zu(n))}function jo(n){return Lu(n),Yp(zu(Uint8Array.from(n).reverse()))}function ed(n,e){return Xp(n.toString(16).padStart(e*2,"0"))}function yu(n,e){return ed(n,e).reverse()}function Mr(n,e,t){let s;if(typeof e=="string")try{s=Xp(e)}catch(c){throw new Error(n+" must be hex string or Uint8Array, cause: "+c)}else if(ju(e))s=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const o=s.length;if(typeof t=="number"&&o!==t)throw new Error(n+" of length "+t+" expected, got "+o);return s}function _f(...n){let e=0;for(let s=0;s<n.length;s++){const o=n[s];Lu(o),e+=o.length}const t=new Uint8Array(e);for(let s=0,o=0;s<n.length;s++){const c=n[s];t.set(c,o),o+=c.length}return t}const Hc=n=>typeof n=="bigint"&&qu<=n;function dE(n,e,t){return Hc(n)&&Hc(e)&&Hc(t)&&e<=n&&n<t}function Wn(n,e,t,s){if(!dE(e,t,s))throw new Error("expected valid "+n+": "+t+" <= n < "+s+", got "+e)}function gE(n){let e;for(e=0;n>qu;n>>=Zp,e+=1);return e}const yE=n=>(lE<<BigInt(n-1))-Zp,mE={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||ju(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Mu(n,e,t={}){const s=(o,c,h)=>{const f=mE[c];if(typeof f!="function")throw new Error("invalid validator function");const y=n[o];if(!(h&&y===void 0)&&!f(y,n))throw new Error("param "+String(o)+" is invalid. Expected "+c+", got "+y)};for(const[o,c]of Object.entries(e))s(o,c,!1);for(const[o,c]of Object.entries(t))s(o,c,!0);return n}function Ef(n){const e=new WeakMap;return(t,...s)=>{const o=e.get(t);if(o!==void 0)return o;const c=n(t,...s);return e.set(t,c),c}}const it=BigInt(0),Ge=BigInt(1),Ai=BigInt(2),vE=BigInt(3),mu=BigInt(4),If=BigInt(5),Sf=BigInt(8);function Xe(n,e){const t=n%e;return t>=it?t:e+t}function wE(n,e,t){if(e<it)throw new Error("invalid exponent, negatives unsupported");if(t<=it)throw new Error("invalid modulus");if(t===Ge)return it;let s=Ge;for(;e>it;)e&Ge&&(s=s*n%t),n=n*n%t,e>>=Ge;return s}function Ir(n,e,t){let s=n;for(;e-- >it;)s*=s,s%=t;return s}function Pf(n,e){if(n===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let t=Xe(n,e),s=e,o=it,c=Ge;for(;t!==it;){const h=s/t,f=s%t,y=o-c*h;s=t,t=f,o=c,c=y}if(s!==Ge)throw new Error("invert: does not exist");return Xe(o,e)}function bE(n){const e=(n-Ge)/Ai;let t,s,o;for(t=n-Ge,s=0;t%Ai===it;t/=Ai,s++);for(o=Ai;o<n&&wE(o,e,n)!==n-Ge;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){const h=(n+Ge)/mu;return function(f,y){const d=f.pow(y,h);if(!f.eql(f.sqr(d),y))throw new Error("Cannot find square root");return d}}const c=(t+Ge)/Ai;return function(h,f){if(h.pow(f,e)===h.neg(h.ONE))throw new Error("Cannot find square root");let y=s,d=h.pow(h.mul(h.ONE,o),t),m=h.pow(f,c),b=h.pow(f,t);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let E=1;for(let x=h.sqr(b);E<y&&!h.eql(x,h.ONE);E++)x=h.sqr(x);const A=h.pow(d,Ge<<BigInt(y-E-1));d=h.sqr(A),m=h.mul(m,A),b=h.mul(b,d),y=E}return m}}function _E(n){if(n%mu===vE){const e=(n+Ge)/mu;return function(t,s){const o=t.pow(s,e);if(!t.eql(t.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%Sf===If){const e=(n-If)/Sf;return function(t,s){const o=t.mul(s,Ai),c=t.pow(o,e),h=t.mul(s,c),f=t.mul(t.mul(h,Ai),c),y=t.mul(h,t.sub(f,t.ONE));if(!t.eql(t.sqr(y),s))throw new Error("Cannot find square root");return y}}return bE(n)}const EE=(n,e)=>(Xe(n,e)&Ge)===Ge,IE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function SE(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=IE.reduce((s,o)=>(s[o]="function",s),e);return Mu(n,t)}function PE(n,e,t){if(t<it)throw new Error("invalid exponent, negatives unsupported");if(t===it)return n.ONE;if(t===Ge)return e;let s=n.ONE,o=e;for(;t>it;)t&Ge&&(s=n.mul(s,o)),o=n.sqr(o),t>>=Ge;return s}function xE(n,e){const t=new Array(e.length),s=e.reduce((c,h,f)=>n.is0(h)?c:(t[f]=c,n.mul(c,h)),n.ONE),o=n.inv(s);return e.reduceRight((c,h,f)=>n.is0(h)?c:(t[f]=n.mul(c,t[f]),n.mul(c,h)),o),t}function td(n,e){const t=e!==void 0?e:n.toString(2).length,s=Math.ceil(t/8);return{nBitLength:t,nByteLength:s}}function rd(n,e,t=!1,s={}){if(n<=it)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:o,nByteLength:c}=td(n,e);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const f=Object.freeze({ORDER:n,isLE:t,BITS:o,BYTES:c,MASK:yE(o),ZERO:it,ONE:Ge,create:y=>Xe(y,n),isValid:y=>{if(typeof y!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof y);return it<=y&&y<n},is0:y=>y===it,isOdd:y=>(y&Ge)===Ge,neg:y=>Xe(-y,n),eql:(y,d)=>y===d,sqr:y=>Xe(y*y,n),add:(y,d)=>Xe(y+d,n),sub:(y,d)=>Xe(y-d,n),mul:(y,d)=>Xe(y*d,n),pow:(y,d)=>PE(f,y,d),div:(y,d)=>Xe(y*Pf(d,n),n),sqrN:y=>y*y,addN:(y,d)=>y+d,subN:(y,d)=>y-d,mulN:(y,d)=>y*d,inv:y=>Pf(y,n),sqrt:s.sqrt||(y=>(h||(h=_E(n)),h(f,y))),invertBatch:y=>xE(f,y),cmov:(y,d,m)=>m?d:y,toBytes:y=>t?yu(y,c):ed(y,c),fromBytes:y=>{if(y.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+y.length);return t?jo(y):pE(y)}});return Object.freeze(f)}const xf=BigInt(0),Ro=BigInt(1);function Vc(n,e){const t=e.negate();return n?t:e}function id(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Kc(n,e){id(n,e);const t=Math.ceil(e/n)+1,s=2**(n-1);return{windows:t,windowSize:s}}function OE(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,s)=>{if(!(t instanceof e))throw new Error("invalid point at index "+s)})}function AE(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,s)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+s)})}const Gc=new WeakMap,nd=new WeakMap;function Wc(n){return nd.get(n)||1}function $E(n,e){return{constTimeNegate:Vc,hasPrecomputes(t){return Wc(t)!==1},unsafeLadder(t,s,o=n.ZERO){let c=t;for(;s>xf;)s&Ro&&(o=o.add(c)),c=c.double(),s>>=Ro;return o},precomputeWindow(t,s){const{windows:o,windowSize:c}=Kc(s,e),h=[];let f=t,y=f;for(let d=0;d<o;d++){y=f,h.push(y);for(let m=1;m<c;m++)y=y.add(f),h.push(y);f=y.double()}return h},wNAF(t,s,o){const{windows:c,windowSize:h}=Kc(t,e);let f=n.ZERO,y=n.BASE;const d=BigInt(2**t-1),m=2**t,b=BigInt(t);for(let E=0;E<c;E++){const A=E*h;let x=Number(o&d);o>>=b,x>h&&(x-=m,o+=Ro);const T=A,k=A+Math.abs(x)-1,V=E%2!==0,re=x<0;x===0?y=y.add(Vc(V,s[T])):f=f.add(Vc(re,s[k]))}return{p:f,f:y}},wNAFUnsafe(t,s,o,c=n.ZERO){const{windows:h,windowSize:f}=Kc(t,e),y=BigInt(2**t-1),d=2**t,m=BigInt(t);for(let b=0;b<h;b++){const E=b*f;if(o===xf)break;let A=Number(o&y);if(o>>=m,A>f&&(A-=d,o+=Ro),A===0)continue;let x=s[E+Math.abs(A)-1];A<0&&(x=x.negate()),c=c.add(x)}return c},getPrecomputes(t,s,o){let c=Gc.get(s);return c||(c=this.precomputeWindow(s,t),t!==1&&Gc.set(s,o(c))),c},wNAFCached(t,s,o){const c=Wc(t);return this.wNAF(c,this.getPrecomputes(c,t,o),s)},wNAFCachedUnsafe(t,s,o,c){const h=Wc(t);return h===1?this.unsafeLadder(t,s,c):this.wNAFUnsafe(h,this.getPrecomputes(h,t,o),s,c)},setWindowSize(t,s){id(s,e),nd.set(t,s),Gc.delete(t)}}}function RE(n,e,t,s){if(OE(t,n),AE(s,e),t.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,c=gE(BigInt(t.length)),h=c>12?c-3:c>4?c-2:c?2:1,f=(1<<h)-1,y=new Array(f+1).fill(o),d=Math.floor((e.BITS-1)/h)*h;let m=o;for(let b=d;b>=0;b-=h){y.fill(o);for(let A=0;A<s.length;A++){const x=s[A],T=Number(x>>BigInt(b)&BigInt(f));y[T]=y[T].add(t[A])}let E=o;for(let A=y.length-1,x=o;A>0;A--)x=x.add(y[A]),E=E.add(x);if(m=m.add(E),b!==0)for(let A=0;A<h;A++)m=m.double()}return m}function TE(n){return SE(n.Fp),Mu(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...td(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}const ur=BigInt(0),xt=BigInt(1),To=BigInt(2),NE=BigInt(8),CE={zip215:!0};function DE(n){const e=TE(n);return Mu(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function UE(n){const e=DE(n),{Fp:t,n:s,prehash:o,hash:c,randomBytes:h,nByteLength:f,h:y}=e,d=To<<BigInt(f*8)-xt,m=t.create,b=rd(e.n,e.nBitLength),E=e.uvRatio||((Q,j)=>{try{return{isValid:!0,value:t.sqrt(Q*t.inv(j))}}catch{return{isValid:!1,value:ur}}}),A=e.adjustScalarBytes||(Q=>Q),x=e.domain||((Q,j,G)=>{if(kc("phflag",G),j.length||G)throw new Error("Contexts/pre-hash are not supported");return Q});function T(Q,j){Wn("coordinate "+Q,j,ur,d)}function k(Q){if(!(Q instanceof U))throw new Error("ExtendedPoint expected")}const V=Ef((Q,j)=>{const{ex:G,ey:Z,ez:ye}=Q,J=Q.is0();j==null&&(j=J?NE:t.inv(ye));const ce=m(G*j),Oe=m(Z*j),be=m(ye*j);if(J)return{x:ur,y:xt};if(be!==xt)throw new Error("invZ was invalid");return{x:ce,y:Oe}}),re=Ef(Q=>{const{a:j,d:G}=e;if(Q.is0())throw new Error("bad point: ZERO");const{ex:Z,ey:ye,ez:J,et:ce}=Q,Oe=m(Z*Z),be=m(ye*ye),Ae=m(J*J),X=m(Ae*Ae),Ie=m(Oe*j),Rt=m(Ae*m(Ie+be)),Fe=m(X+m(G*m(Oe*be)));if(Rt!==Fe)throw new Error("bad point: equation left != right (1)");const ke=m(Z*ye),Tt=m(J*ce);if(ke!==Tt)throw new Error("bad point: equation left != right (2)");return!0});class U{constructor(j,G,Z,ye){this.ex=j,this.ey=G,this.ez=Z,this.et=ye,T("x",j),T("y",G),T("z",Z),T("t",ye),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(j){if(j instanceof U)throw new Error("extended point not allowed");const{x:G,y:Z}=j||{};return T("x",G),T("y",Z),new U(G,Z,xt,m(G*Z))}static normalizeZ(j){const G=t.invertBatch(j.map(Z=>Z.ez));return j.map((Z,ye)=>Z.toAffine(G[ye])).map(U.fromAffine)}static msm(j,G){return RE(U,b,j,G)}_setWindowSize(j){R.setWindowSize(this,j)}assertValidity(){re(this)}equals(j){k(j);const{ex:G,ey:Z,ez:ye}=this,{ex:J,ey:ce,ez:Oe}=j,be=m(G*Oe),Ae=m(J*ye),X=m(Z*Oe),Ie=m(ce*ye);return be===Ae&&X===Ie}is0(){return this.equals(U.ZERO)}negate(){return new U(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){const{a:j}=e,{ex:G,ey:Z,ez:ye}=this,J=m(G*G),ce=m(Z*Z),Oe=m(To*m(ye*ye)),be=m(j*J),Ae=G+Z,X=m(m(Ae*Ae)-J-ce),Ie=be+ce,Rt=Ie-Oe,Fe=be-ce,ke=m(X*Rt),Tt=m(Ie*Fe),gt=m(X*Fe),Nt=m(Rt*Ie);return new U(ke,Tt,Nt,gt)}add(j){k(j);const{a:G,d:Z}=e,{ex:ye,ey:J,ez:ce,et:Oe}=this,{ex:be,ey:Ae,ez:X,et:Ie}=j;if(G===BigInt(-1)){const Fi=m((J-ye)*(Ae+be)),gr=m((J+ye)*(Ae-be)),st=m(gr-Fi);if(st===ur)return this.double();const yr=m(ce*To*Ie),xr=m(Oe*To*X),qi=xr+yr,mr=gr+Fi,ji=xr-yr,kt=m(qi*st),Ht=m(mr*ji),Kr=m(qi*ji),ht=m(st*mr);return new U(kt,Ht,ht,Kr)}const Rt=m(ye*be),Fe=m(J*Ae),ke=m(Oe*Z*Ie),Tt=m(ce*X),gt=m((ye+J)*(be+Ae)-Rt-Fe),Nt=Tt-ke,Vr=Tt+ke,nt=m(Fe-G*Rt),Pr=m(gt*Nt),wn=m(Vr*nt),Ct=m(gt*nt),Ui=m(Nt*Vr);return new U(Pr,wn,Ui,Ct)}subtract(j){return this.add(j.negate())}wNAF(j){return R.wNAFCached(this,j,U.normalizeZ)}multiply(j){const G=j;Wn("scalar",G,xt,s);const{p:Z,f:ye}=this.wNAF(G);return U.normalizeZ([Z,ye])[0]}multiplyUnsafe(j,G=U.ZERO){const Z=j;return Wn("scalar",Z,ur,s),Z===ur?ee:this.is0()||Z===xt?this:R.wNAFCachedUnsafe(this,Z,U.normalizeZ,G)}isSmallOrder(){return this.multiplyUnsafe(y).is0()}isTorsionFree(){return R.unsafeLadder(this,s).is0()}toAffine(j){return V(this,j)}clearCofactor(){const{h:j}=e;return j===xt?this:this.multiplyUnsafe(j)}static fromHex(j,G=!1){const{d:Z,a:ye}=e,J=t.BYTES;j=Mr("pointHex",j,J),kc("zip215",G);const ce=j.slice(),Oe=j[J-1];ce[J-1]=Oe&-129;const be=jo(ce),Ae=G?d:t.ORDER;Wn("pointHex.y",be,ur,Ae);const X=m(be*be),Ie=m(X-xt),Rt=m(Z*X-ye);let{isValid:Fe,value:ke}=E(Ie,Rt);if(!Fe)throw new Error("Point.fromHex: invalid y coordinate");const Tt=(ke&xt)===xt,gt=(Oe&128)!==0;if(!G&&ke===ur&&gt)throw new Error("Point.fromHex: x=0 and x_0=1");return gt!==Tt&&(ke=m(-ke)),U.fromAffine({x:ke,y:be})}static fromPrivateKey(j){return Y(j).point}toRawBytes(){const{x:j,y:G}=this.toAffine(),Z=yu(G,t.BYTES);return Z[Z.length-1]|=j&xt?128:0,Z}toHex(){return zu(this.toRawBytes())}}U.BASE=new U(e.Gx,e.Gy,xt,m(e.Gx*e.Gy)),U.ZERO=new U(ur,xt,xt,ur);const{BASE:H,ZERO:ee}=U,R=$E(U,f*8);function q(Q){return Xe(Q,s)}function L(Q){return q(jo(Q))}function Y(Q){const j=t.BYTES;Q=Mr("private key",Q,j);const G=Mr("hashed private key",c(Q),2*j),Z=A(G.slice(0,j)),ye=G.slice(j,2*j),J=L(Z),ce=H.multiply(J),Oe=ce.toRawBytes();return{head:Z,prefix:ye,scalar:J,point:ce,pointBytes:Oe}}function ae(Q){return Y(Q).pointBytes}function we(Q=new Uint8Array,...j){const G=_f(...j);return L(c(x(G,Mr("context",Q),!!o)))}function Pe(Q,j,G={}){Q=Mr("message",Q),o&&(Q=o(Q));const{prefix:Z,scalar:ye,pointBytes:J}=Y(j),ce=we(G.context,Z,Q),Oe=H.multiply(ce).toRawBytes(),be=we(G.context,Oe,J,Q),Ae=q(ce+be*ye);Wn("signature.s",Ae,ur,s);const X=_f(Oe,yu(Ae,t.BYTES));return Mr("result",X,t.BYTES*2)}const We=CE;function ie(Q,j,G,Z=We){const{context:ye,zip215:J}=Z,ce=t.BYTES;Q=Mr("signature",Q,2*ce),j=Mr("message",j),G=Mr("publicKey",G,ce),J!==void 0&&kc("zip215",J),o&&(j=o(j));const Oe=jo(Q.slice(ce,2*ce));let be,Ae,X;try{be=U.fromHex(G,J),Ae=U.fromHex(Q.slice(0,ce),J),X=H.multiplyUnsafe(Oe)}catch{return!1}if(!J&&be.isSmallOrder())return!1;const Ie=we(ye,Ae.toRawBytes(),be.toRawBytes(),j);return Ae.add(be.multiplyUnsafe(Ie)).subtract(X).clearCofactor().equals(U.ZERO)}return H._setWindowSize(8),{CURVE:e,getPublicKey:ae,sign:Pe,verify:ie,ExtendedPoint:U,utils:{getExtendedPublicKey:Y,randomPrivateKey:()=>h(t.BYTES),precompute(Q=8,j=U.BASE){return j._setWindowSize(Q),j.multiply(BigInt(3)),j}}}}BigInt(0),BigInt(1);const Bu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Of=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const FE=BigInt(1),Af=BigInt(2);BigInt(3);const qE=BigInt(5),jE=BigInt(8);function LE(n){const e=BigInt(10),t=BigInt(20),s=BigInt(40),o=BigInt(80),c=Bu,h=n*n%c*n%c,f=Ir(h,Af,c)*h%c,y=Ir(f,FE,c)*n%c,d=Ir(y,qE,c)*y%c,m=Ir(d,e,c)*d%c,b=Ir(m,t,c)*m%c,E=Ir(b,s,c)*b%c,A=Ir(E,o,c)*E%c,x=Ir(A,o,c)*E%c,T=Ir(x,e,c)*d%c;return{pow_p_5_8:Ir(T,Af,c)*n%c,b2:h}}function zE(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function ME(n,e){const t=Bu,s=Xe(e*e*e,t),o=Xe(s*s*e,t),c=LE(n*o).pow_p_5_8;let h=Xe(n*s*c,t);const f=Xe(e*h*h,t),y=h,d=Xe(h*Of,t),m=f===n,b=f===Xe(-n,t),E=f===Xe(-n*Of,t);return m&&(h=y),(b||E)&&(h=d),EE(h,t)&&(h=Xe(-h,t)),{isValid:m||b,value:h}}const BE=rd(Bu,void 0,!0),kE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:BE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:jE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:hE,randomBytes:Qp,adjustScalarBytes:zE,uvRatio:ME},sd=UE(kE),HE="EdDSA",VE="JWT",od=".",ad="base64url",KE="utf8",GE="utf8",WE=":",QE="did",JE="key",$f="base58btc",ZE="z",YE="K36",XE=32;function ku(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function cd(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ku(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function ud(n,e){e||(e=n.reduce((o,c)=>o+c.length,0));const t=cd(e);let s=0;for(const o of n)t.set(o,s),s+=o.length;return ku(t)}function eI(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var o=0;o<n.length;o++){var c=n.charAt(o),h=c.charCodeAt(0);if(t[h]!==255)throw new TypeError(c+" is ambiguous");t[h]=o}var f=n.length,y=n.charAt(0),d=Math.log(f)/Math.log(256),m=Math.log(256)/Math.log(f);function b(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var T=0,k=0,V=0,re=x.length;V!==re&&x[V]===0;)V++,T++;for(var U=(re-V)*m+1>>>0,H=new Uint8Array(U);V!==re;){for(var ee=x[V],R=0,q=U-1;(ee!==0||R<k)&&q!==-1;q--,R++)ee+=256*H[q]>>>0,H[q]=ee%f>>>0,ee=ee/f>>>0;if(ee!==0)throw new Error("Non-zero carry");k=R,V++}for(var L=U-k;L!==U&&H[L]===0;)L++;for(var Y=y.repeat(T);L<U;++L)Y+=n.charAt(H[L]);return Y}function E(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var T=0;if(x[T]!==" "){for(var k=0,V=0;x[T]===y;)k++,T++;for(var re=(x.length-T)*d+1>>>0,U=new Uint8Array(re);x[T];){var H=t[x.charCodeAt(T)];if(H===255)return;for(var ee=0,R=re-1;(H!==0||ee<V)&&R!==-1;R--,ee++)H+=f*U[R]>>>0,U[R]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");V=ee,T++}if(x[T]!==" "){for(var q=re-V;q!==re&&U[q]===0;)q++;for(var L=new Uint8Array(k+(re-q)),Y=k;q!==re;)L[Y++]=U[q++];return L}}}function A(x){var T=E(x);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:E,decode:A}}var tI=eI,rI=tI;const hd=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},iI=n=>new TextEncoder().encode(n),nI=n=>new TextDecoder().decode(n);class sI{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}let oI=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ld(this,e)}};class aI{constructor(e){this.decoders=e}or(e){return ld(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ld=(n,e)=>new aI({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});let cI=class{constructor(e,t,s,o){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=o,this.encoder=new sI(e,t,s),this.decoder=new oI(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Yo=({name:n,prefix:e,encode:t,decode:s})=>new cI(n,e,t,s),ds=({prefix:n,name:e,alphabet:t})=>{const{encode:s,decode:o}=rI(t,e);return Yo({prefix:n,name:e,encode:s,decode:c=>hd(o(c))})},uI=(n,e,t,s)=>{const o={};for(let m=0;m<e.length;++m)o[e[m]]=m;let c=n.length;for(;n[c-1]==="=";)--c;const h=new Uint8Array(c*t/8|0);let f=0,y=0,d=0;for(let m=0;m<c;++m){const b=o[n[m]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);y=y<<t|b,f+=t,f>=8&&(f-=8,h[d++]=255&y>>f)}if(f>=t||255&y<<8-f)throw new SyntaxError("Unexpected end of data");return h},hI=(n,e,t)=>{const s=e[e.length-1]==="=",o=(1<<t)-1;let c="",h=0,f=0;for(let y=0;y<n.length;++y)for(f=f<<8|n[y],h+=8;h>t;)h-=t,c+=e[o&f>>h];if(h&&(c+=e[o&f<<t-h]),s)for(;c.length*t&7;)c+="=";return c},ct=({name:n,prefix:e,bitsPerChar:t,alphabet:s})=>Yo({prefix:e,name:n,encode(o){return hI(o,s,t)},decode(o){return uI(o,s,t,n)}}),lI=Yo({prefix:"\0",name:"identity",encode:n=>nI(n),decode:n=>iI(n)});var fI=Object.freeze({__proto__:null,identity:lI});const pI=ct({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var dI=Object.freeze({__proto__:null,base2:pI});const gI=ct({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var yI=Object.freeze({__proto__:null,base8:gI});const mI=ds({prefix:"9",name:"base10",alphabet:"0123456789"});var vI=Object.freeze({__proto__:null,base10:mI});const wI=ct({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bI=ct({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _I=Object.freeze({__proto__:null,base16:wI,base16upper:bI});const EI=ct({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),II=ct({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),SI=ct({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),PI=ct({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xI=ct({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),OI=ct({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),AI=ct({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$I=ct({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),RI=ct({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var TI=Object.freeze({__proto__:null,base32:EI,base32upper:II,base32pad:SI,base32padupper:PI,base32hex:xI,base32hexupper:OI,base32hexpad:AI,base32hexpadupper:$I,base32z:RI});const NI=ds({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),CI=ds({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var DI=Object.freeze({__proto__:null,base36:NI,base36upper:CI});const UI=ds({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),FI=ds({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var qI=Object.freeze({__proto__:null,base58btc:UI,base58flickr:FI});const jI=ct({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),LI=ct({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zI=ct({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),MI=ct({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var BI=Object.freeze({__proto__:null,base64:jI,base64pad:LI,base64url:zI,base64urlpad:MI});const fd=Array.from(""),kI=fd.reduce((n,e,t)=>(n[t]=e,n),[]),HI=fd.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function VI(n){return n.reduce((e,t)=>(e+=kI[t],e),"")}function KI(n){const e=[];for(const t of n){const s=HI[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const GI=Yo({prefix:"",name:"base256emoji",encode:VI,decode:KI});var WI=Object.freeze({__proto__:null,base256emoji:GI}),QI=pd,Rf=128,JI=-128,ZI=Math.pow(2,31);function pd(n,e,t){e=e||[],t=t||0;for(var s=t;n>=ZI;)e[t++]=n&255|Rf,n/=128;for(;n&JI;)e[t++]=n&255|Rf,n>>>=7;return e[t]=n|0,pd.bytes=t-s+1,e}var YI=vu,XI=128,Tf=127;function vu(n,s){var t=0,s=s||0,o=0,c=s,h,f=n.length;do{if(c>=f)throw vu.bytes=0,new RangeError("Could not decode varint");h=n[c++],t+=o<28?(h&Tf)<<o:(h&Tf)*Math.pow(2,o),o+=7}while(h>=XI);return vu.bytes=c-s,t}var eS=Math.pow(2,7),tS=Math.pow(2,14),rS=Math.pow(2,21),iS=Math.pow(2,28),nS=Math.pow(2,35),sS=Math.pow(2,42),oS=Math.pow(2,49),aS=Math.pow(2,56),cS=Math.pow(2,63),uS=function(n){return n<eS?1:n<tS?2:n<rS?3:n<iS?4:n<nS?5:n<sS?6:n<oS?7:n<aS?8:n<cS?9:10},hS={encode:QI,decode:YI,encodingLength:uS},dd=hS;const Nf=(n,e,t=0)=>(dd.encode(n,e,t),e),Cf=n=>dd.encodingLength(n),wu=(n,e)=>{const t=e.byteLength,s=Cf(n),o=s+Cf(t),c=new Uint8Array(o+t);return Nf(n,c,0),Nf(t,c,s),c.set(e,o),new lS(n,t,e,c)};class lS{constructor(e,t,s,o){this.code=e,this.size=t,this.digest=s,this.bytes=o}}const gd=({name:n,code:e,encode:t})=>new fS(n,e,t);class fS{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?wu(this.code,t):t.then(s=>wu(this.code,s))}else throw Error("Unknown type, must be binary type")}}const yd=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),pS=gd({name:"sha2-256",code:18,encode:yd("SHA-256")}),dS=gd({name:"sha2-512",code:19,encode:yd("SHA-512")});var gS=Object.freeze({__proto__:null,sha256:pS,sha512:dS});const md=0,yS="identity",vd=hd,mS=n=>wu(md,vd(n)),vS={code:md,name:yS,encode:vd,digest:mS};var wS=Object.freeze({__proto__:null,identity:vS});new TextEncoder,new TextDecoder;const Df={...fI,...dI,...yI,...vI,..._I,...TI,...DI,...qI,...BI,...WI};({...gS,...wS});function wd(n,e,t,s){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:s}}}const Uf=wd("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Qc=wd("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=cd(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),bd={utf8:Uf,"utf-8":Uf,hex:Df.base16,latin1:Qc,ascii:Qc,binary:Qc,...Df};function Hu(n,e="utf8"){const t=bd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):t.encoder.encode(n).substring(1)}function Vu(n,e="utf8"){const t=bd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ku(globalThis.Buffer.from(n,"utf-8")):t.decoder.decode(`${t.prefix}${n}`)}function ko(n){return Hu(Vu(us(n),KE),ad)}function _d(n){const e=Vu(YE,$f),t=ZE+Hu(ud([e,n]),$f);return[QE,JE,t].join(WE)}function bS(n){return Hu(n,ad)}function _S(n){return Vu([ko(n.header),ko(n.payload)].join(od),GE)}function ES(n){return[ko(n.header),ko(n.payload),bS(n.signature)].join(od)}function Ff(n=Qp(XE)){const e=sd.getPublicKey(n);return{secretKey:ud([n,e]),publicKey:e}}async function IS(n,e,t,s,o=K.fromMiliseconds(Date.now())){const c={alg:HE,typ:VE},h=_d(s.publicKey),f=o+t,y={iss:h,sub:n,aud:e,iat:o,exp:f},d=_S({header:c,payload:y}),m=sd.sign(d,s.secretKey.slice(0,32));return ES({header:c,payload:y,signature:m})}const Ed="base10",bt="base16",bu="base64pad",Ku="utf8",Id=0,yn=1,SS=0,qf=1,_u=12,Gu=32;function PS(){const n=Fp.generateKeyPair();return{privateKey:Mt(n.secretKey,bt),publicKey:Mt(n.publicKey,bt)}}function Eu(){const n=qp.randomBytes(Gu);return Mt(n,bt)}function xS(n,e){const t=Fp.sharedKey(rr(n,bt),rr(e,bt),!0),s=new Hb.HKDF(Go.SHA256,t).expand(Gu);return Mt(s,bt)}function OS(n){const e=Go.hash(rr(n,bt));return Mt(e,bt)}function Iu(n){const e=Go.hash(rr(n,Ku));return Mt(e,bt)}function AS(n){return rr(`${n}`,Ed)}function gs(n){return Number(Mt(n,Ed))}function $S(n){const e=AS(typeof n.type<"u"?n.type:Id);if(gs(e)===yn&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof n.senderPublicKey<"u"?rr(n.senderPublicKey,bt):void 0,s=typeof n.iv<"u"?rr(n.iv,bt):qp.randomBytes(_u),o=new jp.ChaCha20Poly1305(rr(n.symKey,bt)).seal(s,rr(n.message,Ku));return TS({type:e,sealed:o,iv:s,senderPublicKey:t})}function RS(n){const e=new jp.ChaCha20Poly1305(rr(n.symKey,bt)),{sealed:t,iv:s}=Ho(n.encoded),o=e.open(s,t);if(o===null)throw new Error("Failed to decrypt");return Mt(o,Ku)}function TS(n){if(gs(n.type)===yn){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Mt(tf([n.type,n.senderPublicKey,n.iv,n.sealed]),bu)}return Mt(tf([n.type,n.iv,n.sealed]),bu)}function Ho(n){const e=rr(n,bu),t=e.slice(SS,qf),s=qf;if(gs(t)===yn){const f=s+Gu,y=f+_u,d=e.slice(s,f),m=e.slice(f,y),b=e.slice(y);return{type:t,sealed:b,iv:m,senderPublicKey:d}}const o=s+_u,c=e.slice(s,o),h=e.slice(o);return{type:t,sealed:h,iv:c}}function NS(n,e){const t=Ho(n);return Sd({type:gs(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Mt(t.senderPublicKey,bt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Sd(n){const e=(n==null?void 0:n.type)||Id;if(e===yn){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function jf(n){return n.type===yn&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var CS=Object.defineProperty,Lf=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,US=Object.prototype.propertyIsEnumerable,zf=(n,e,t)=>e in n?CS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Mf=(n,e)=>{for(var t in e||(e={}))DS.call(e,t)&&zf(n,t,e[t]);if(Lf)for(var t of Lf(e))US.call(e,t)&&zf(n,t,e[t]);return n};const FS="ReactNative",pr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},qS="js";function Wu(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function mn(){return!Ti.getDocument()&&!!Ti.getNavigator()&&navigator.product===FS}function Xo(){return!Wu()&&!!Ti.getNavigator()}function ea(){return mn()?pr.reactNative:Wu()?pr.node:Xo()?pr.browser:pr.unknown}function jS(){var n;try{return mn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(n=global.Application)==null?void 0:n.applicationId:void 0}catch{return}}function LS(n,e){let t=Bo.parse(n);return t=Mf(Mf({},t),e),n=Bo.stringify(t),n}function zS(){if(ea()===pr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:s}=global.Platform;return[t,s].join("-")}const n=Gb();if(n===null)return"unknown";const e=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[e,n.name,n.version].join("-"):[e,n.version].join("-")}function MS(){var n;const e=ea();return e===pr.browser?[e,((n=Ti.getLocation())==null?void 0:n.host)||"unknown"].join(":"):e}function BS(n,e,t){const s=zS(),o=MS();return[[n,e].join("-"),[qS,t].join("-"),s,o].join("/")}function kS({protocol:n,version:e,relayUrl:t,sdkVersion:s,auth:o,projectId:c,useOnCloseEvent:h,bundleId:f}){const y=t.split("?"),d=BS(n,e,s),m={auth:o,ua:d,projectId:c,useOnCloseEvent:h,origin:f||void 0},b=LS(y[1]||"",m);return y[0]+"?"+b}function Pd(n){return Object.fromEntries(n.entries())}function xd(n){return new Map(Object.entries(n))}function HS(n=K.FIVE_MINUTES,e){const t=K.toMiliseconds(n||K.FIVE_MINUTES);let s,o,c;return{resolve:h=>{c&&s&&(clearTimeout(c),s(h))},reject:h=>{c&&o&&(clearTimeout(c),o(h))},done:()=>new Promise((h,f)=>{c=setTimeout(()=>{f(new Error(e))},t),s=h,o=f})}}function cs(n,e,t){return new Promise(async(s,o)=>{const c=setTimeout(()=>o(new Error(t)),e);try{const h=await n;s(h)}catch(h){o(h)}clearTimeout(c)})}function Od(n,e){if(typeof e=="string"&&e.startsWith(`${n}:`))return e;if(n.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(n.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${n}`)}function VS(n){return Od("topic",n)}function KS(n){return Od("id",n)}function GS(n){const[e,t]=n.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")s.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return s}function Lo(n,e){return K.fromMiliseconds(Date.now()+K.toMiliseconds(n))}function Bf(n){return Date.now()>=K.toMiliseconds(n)}function Jc(n,e){return`${n}${e?`:${e}`:""}`}const WS="irn";function Su(n){return(n==null?void 0:n.relay)||{protocol:WS}}function zo(n){const e=Yb[n];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${n}`);return e}var QS=Object.defineProperty,kf=Object.getOwnPropertySymbols,JS=Object.prototype.hasOwnProperty,ZS=Object.prototype.propertyIsEnumerable,Hf=(n,e,t)=>e in n?QS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YS=(n,e)=>{for(var t in e||(e={}))JS.call(e,t)&&Hf(n,t,e[t]);if(kf)for(var t of kf(e))ZS.call(e,t)&&Hf(n,t,e[t]);return n};function XS(n,e="-"){const t={},s="relay"+e;return Object.keys(n).forEach(o=>{if(o.startsWith(s)){const c=o.replace(s,""),h=n[o];t[c]=h}}),t}function Vf(n){n=n.includes("wc://")?n.replace("wc://",""):n,n=n.includes("wc:")?n.replace("wc:",""):n;const e=n.indexOf(":"),t=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,e),o=n.substring(e+1,t).split("@"),c=typeof t<"u"?n.substring(t):"",h=Bo.parse(c);return{protocol:s,topic:eP(o[0]),version:parseInt(o[1],10),symKey:h.symKey,relay:XS(h)}}function eP(n){return n.startsWith("//")?n.substring(2):n}function tP(n,e="-"){const t="relay",s={};return Object.keys(n).forEach(o=>{const c=t+e+o;n[o]&&(s[c]=n[o])}),s}function rP(n){return`${n.protocol}:${n.topic}@${n.version}?`+Bo.stringify(YS({symKey:n.symKey},tP(n.relay)))}const iP={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},nP={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Te(n,e){const{message:t,code:s}=nP[n];return{message:e?`${t} ${e}`:t,code:s}}function ts(n,e){const{message:t,code:s}=iP[n];return{message:e?`${t} ${e}`:t,code:s}}function sP(n,e){return!!Array.isArray(n)}function Pu(n){return typeof n>"u"}function Ad(n,e){return typeof n=="string"&&!!n.trim().length}function oP(n){if(Ad(n))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function aP(n){var e;return(e=n==null?void 0:n.proposer)==null?void 0:e.publicKey}function cP(n){return n==null?void 0:n.topic}function Zc(n){return typeof n<"u"&&typeof n!==null}function Kf(){const n=ea();return new Promise(e=>{switch(n){case pr.browser:e(uP());break;case pr.reactNative:e(hP());break;case pr.node:e(lP());break;default:e(!0)}})}function uP(){return Xo()&&(navigator==null?void 0:navigator.onLine)}async function hP(){if(mn()&&typeof global<"u"&&global!=null&&global.NetInfo){const n=await(global==null?void 0:global.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function lP(){return!0}function fP(n){switch(ea()){case pr.browser:pP(n);break;case pr.reactNative:dP(n);break}}function pP(n){!mn()&&Xo()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function dP(n){mn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>n(e==null?void 0:e.isConnected)))}let gP=class extends Lp{constructor(e){super(e),this.events=new dr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Ri(e.method,e.params||[],e.id||Nu().toString()),t)}async requestStrict(e,t){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${e.id}`,c=>{fr(c)?o(c.error):s(c.result)});try{await this.connection.send(e,t)}catch(c){o(c)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),hs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const yP=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),mP=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Gf=n=>n.split("?")[0],Wf=10,vP=yP();let wP=class{constructor(e){if(this.url=e,this.events=new dr.EventEmitter,this.registering=!1,!ef(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(us(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!ef(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((s,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,s)=>{const o=new URLSearchParams(e).get("origin"),c=Wb.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!Qb(e)},h=new vP(e,[],c);mP()?h.onerror=f=>{const y=f;s(this.emitError(y.error))}:h.on("error",f=>{s(this.emitError(f))}),h.onopen=()=>{this.onOpen(h),t(h)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Wo(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const s=this.parseError(t),o=s.message||s.toString(),c=Cu(e,o);this.events.emit("payload",c)}parseError(e,t=this.url){return Jb(e,Gf(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Wf&&this.events.setMaxListeners(Wf)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Gf(this.url)}`));return this.events.emit("register_error",t),t}};var rs={exports:{}};rs.exports;var Qf;function bP(){return Qf||(Qf=1,function(n,e){var t=200,s="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,f="[object Arguments]",y="[object Array]",d="[object AsyncFunction]",m="[object Boolean]",b="[object Date]",E="[object Error]",A="[object Function]",x="[object GeneratorFunction]",T="[object Map]",k="[object Number]",V="[object Null]",re="[object Object]",U="[object Promise]",H="[object Proxy]",ee="[object RegExp]",R="[object Set]",q="[object String]",L="[object Symbol]",Y="[object Undefined]",ae="[object WeakMap]",we="[object ArrayBuffer]",Pe="[object DataView]",We="[object Float32Array]",ie="[object Float64Array]",Q="[object Int8Array]",j="[object Int16Array]",G="[object Int32Array]",Z="[object Uint8Array]",ye="[object Uint8ClampedArray]",J="[object Uint16Array]",ce="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,X={};X[We]=X[ie]=X[Q]=X[j]=X[G]=X[Z]=X[ye]=X[J]=X[ce]=!0,X[f]=X[y]=X[we]=X[m]=X[Pe]=X[b]=X[E]=X[A]=X[T]=X[k]=X[re]=X[ee]=X[R]=X[q]=X[ae]=!1;var Ie=typeof xo=="object"&&xo&&xo.Object===Object&&xo,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Fe=Ie||Rt||Function("return this")(),ke=e&&!e.nodeType&&e,Tt=ke&&!0&&n&&!n.nodeType&&n,gt=Tt&&Tt.exports===ke,Nt=gt&&Ie.process,Vr=function(){try{return Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),nt=Vr&&Vr.isTypedArray;function Pr(v,I){for(var D=-1,M=v==null?0:v.length,Ce=0,he=[];++D<M;){var qe=v[D];I(qe,D,v)&&(he[Ce++]=qe)}return he}function wn(v,I){for(var D=-1,M=I.length,Ce=v.length;++D<M;)v[Ce+D]=I[D];return v}function Ct(v,I){for(var D=-1,M=v==null?0:v.length;++D<M;)if(I(v[D],D,v))return!0;return!1}function Ui(v,I){for(var D=-1,M=Array(v);++D<v;)M[D]=I(D);return M}function Fi(v){return function(I){return v(I)}}function gr(v,I){return v.has(I)}function st(v,I){return v==null?void 0:v[I]}function yr(v){var I=-1,D=Array(v.size);return v.forEach(function(M,Ce){D[++I]=[Ce,M]}),D}function xr(v,I){return function(D){return v(I(D))}}function qi(v){var I=-1,D=Array(v.size);return v.forEach(function(M){D[++I]=M}),D}var mr=Array.prototype,ji=Function.prototype,kt=Object.prototype,Ht=Fe["__core-js_shared__"],Kr=ji.toString,ht=kt.hasOwnProperty,Li=function(){var v=/[^.]+$/.exec(Ht&&Ht.keys&&Ht.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),zi=kt.toString,bn=RegExp("^"+Kr.call(ht).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mi=gt?Fe.Buffer:void 0,Gr=Fe.Symbol,Bi=Fe.Uint8Array,ki=kt.propertyIsEnumerable,na=mr.splice,Or=Gr?Gr.toStringTag:void 0,ms=Object.getOwnPropertySymbols,vs=Mi?Mi.isBuffer:void 0,ws=xr(Object.keys,Object),_n=Dt(Fe,"DataView"),li=Dt(Fe,"Map"),En=Dt(Fe,"Promise"),In=Dt(Fe,"Set"),Hi=Dt(Fe,"WeakMap"),fi=Dt(Object,"create"),sa=Rr(_n),oa=Rr(li),Sn=Rr(En),aa=Rr(In),Pn=Rr(Hi),bs=Gr?Gr.prototype:void 0,xn=bs?bs.valueOf:void 0;function Ar(v){var I=-1,D=v==null?0:v.length;for(this.clear();++I<D;){var M=v[I];this.set(M[0],M[1])}}function ca(){this.__data__=fi?fi(null):{},this.size=0}function ua(v){var I=this.has(v)&&delete this.__data__[v];return this.size-=I?1:0,I}function ha(v){var I=this.__data__;if(fi){var D=I[v];return D===s?void 0:D}return ht.call(I,v)?I[v]:void 0}function la(v){var I=this.__data__;return fi?I[v]!==void 0:ht.call(I,v)}function fa(v,I){var D=this.__data__;return this.size+=this.has(v)?0:1,D[v]=fi&&I===void 0?s:I,this}Ar.prototype.clear=ca,Ar.prototype.delete=ua,Ar.prototype.get=ha,Ar.prototype.has=la,Ar.prototype.set=fa;function Vt(v){var I=-1,D=v==null?0:v.length;for(this.clear();++I<D;){var M=v[I];this.set(M[0],M[1])}}function pa(){this.__data__=[],this.size=0}function da(v){var I=this.__data__,D=pi(I,v);if(D<0)return!1;var M=I.length-1;return D==M?I.pop():na.call(I,D,1),--this.size,!0}function ga(v){var I=this.__data__,D=pi(I,v);return D<0?void 0:I[D][1]}function ya(v){return pi(this.__data__,v)>-1}function ma(v,I){var D=this.__data__,M=pi(D,v);return M<0?(++this.size,D.push([v,I])):D[M][1]=I,this}Vt.prototype.clear=pa,Vt.prototype.delete=da,Vt.prototype.get=ga,Vt.prototype.has=ya,Vt.prototype.set=ma;function $r(v){var I=-1,D=v==null?0:v.length;for(this.clear();++I<D;){var M=v[I];this.set(M[0],M[1])}}function Vi(){this.size=0,this.__data__={hash:new Ar,map:new(li||Vt),string:new Ar}}function va(v){var I=Wr(this,v).delete(v);return this.size-=I?1:0,I}function Ki(v){return Wr(this,v).get(v)}function wa(v){return Wr(this,v).has(v)}function ba(v,I){var D=Wr(this,v),M=D.size;return D.set(v,I),this.size+=D.size==M?0:1,this}$r.prototype.clear=Vi,$r.prototype.delete=va,$r.prototype.get=Ki,$r.prototype.has=wa,$r.prototype.set=ba;function Gi(v){var I=-1,D=v==null?0:v.length;for(this.__data__=new $r;++I<D;)this.add(v[I])}function _s(v){return this.__data__.set(v,s),this}function Es(v){return this.__data__.has(v)}Gi.prototype.add=Gi.prototype.push=_s,Gi.prototype.has=Es;function ir(v){var I=this.__data__=new Vt(v);this.size=I.size}function _a(){this.__data__=new Vt,this.size=0}function Ea(v){var I=this.__data__,D=I.delete(v);return this.size=I.size,D}function Ia(v){return this.__data__.get(v)}function Sa(v){return this.__data__.has(v)}function Is(v,I){var D=this.__data__;if(D instanceof Vt){var M=D.__data__;if(!li||M.length<t-1)return M.push([v,I]),this.size=++D.size,this;D=this.__data__=new $r(M)}return D.set(v,I),this.size=D.size,this}ir.prototype.clear=_a,ir.prototype.delete=Ea,ir.prototype.get=Ia,ir.prototype.has=Sa,ir.prototype.set=Is;function Ss(v,I){var D=Ji(v),M=!D&&Fs(v),Ce=!D&&!M&&$n(v),he=!D&&!M&&!Ce&&Ls(v),qe=D||M||Ce||he,Qe=qe?Ui(v.length,String):[],_e=Qe.length;for(var De in v)ht.call(v,De)&&!(qe&&(De=="length"||Ce&&(De=="offset"||De=="parent")||he&&(De=="buffer"||De=="byteLength"||De=="byteOffset")||Ts(De,_e)))&&Qe.push(De);return Qe}function pi(v,I){for(var D=v.length;D--;)if(Us(v[D][0],I))return D;return-1}function On(v,I,D){var M=I(v);return Ji(v)?M:wn(M,D(v))}function di(v){return v==null?v===void 0?Y:V:Or&&Or in Object(v)?$s(v):Oa(v)}function An(v){return yi(v)&&di(v)==f}function gi(v,I,D,M,Ce){return v===I?!0:v==null||I==null||!yi(v)&&!yi(I)?v!==v&&I!==I:Ps(v,I,D,M,gi,Ce)}function Ps(v,I,D,M,Ce,he){var qe=Ji(v),Qe=Ji(I),_e=qe?y:vr(v),De=Qe?y:vr(I);_e=_e==f?re:_e,De=De==f?re:De;var He=_e==re,_t=De==re,Je=_e==De;if(Je&&$n(v)){if(!$n(I))return!1;qe=!0,He=!1}if(Je&&!He)return he||(he=new ir),qe||Ls(v)?Wi(v,I,D,M,Ce,he):xa(v,I,_e,D,M,Ce,he);if(!(D&o)){var je=He&&ht.call(v,"__wrapped__"),yt=_t&&ht.call(I,"__wrapped__");if(je||yt){var nr=je?v.value():v,Kt=yt?I.value():I;return he||(he=new ir),Ce(nr,Kt,D,M,he)}}return Je?(he||(he=new ir),As(v,I,D,M,Ce,he)):!1}function Pa(v){if(!js(v)||Cs(v))return!1;var I=Zi(v)?bn:be;return I.test(Rr(v))}function xs(v){return yi(v)&&qs(v.length)&&!!X[di(v)]}function Os(v){if(!Ds(v))return ws(v);var I=[];for(var D in Object(v))ht.call(v,D)&&D!="constructor"&&I.push(D);return I}function Wi(v,I,D,M,Ce,he){var qe=D&o,Qe=v.length,_e=I.length;if(Qe!=_e&&!(qe&&_e>Qe))return!1;var De=he.get(v);if(De&&he.get(I))return De==I;var He=-1,_t=!0,Je=D&c?new Gi:void 0;for(he.set(v,I),he.set(I,v);++He<Qe;){var je=v[He],yt=I[He];if(M)var nr=qe?M(yt,je,He,I,v,he):M(je,yt,He,v,I,he);if(nr!==void 0){if(nr)continue;_t=!1;break}if(Je){if(!Ct(I,function(Kt,wr){if(!gr(Je,wr)&&(je===Kt||Ce(je,Kt,D,M,he)))return Je.push(wr)})){_t=!1;break}}else if(!(je===yt||Ce(je,yt,D,M,he))){_t=!1;break}}return he.delete(v),he.delete(I),_t}function xa(v,I,D,M,Ce,he,qe){switch(D){case Pe:if(v.byteLength!=I.byteLength||v.byteOffset!=I.byteOffset)return!1;v=v.buffer,I=I.buffer;case we:return!(v.byteLength!=I.byteLength||!he(new Bi(v),new Bi(I)));case m:case b:case k:return Us(+v,+I);case E:return v.name==I.name&&v.message==I.message;case ee:case q:return v==I+"";case T:var Qe=yr;case R:var _e=M&o;if(Qe||(Qe=qi),v.size!=I.size&&!_e)return!1;var De=qe.get(v);if(De)return De==I;M|=c,qe.set(v,I);var He=Wi(Qe(v),Qe(I),M,Ce,he,qe);return qe.delete(v),He;case L:if(xn)return xn.call(v)==xn.call(I)}return!1}function As(v,I,D,M,Ce,he){var qe=D&o,Qe=Qi(v),_e=Qe.length,De=Qi(I),He=De.length;if(_e!=He&&!qe)return!1;for(var _t=_e;_t--;){var Je=Qe[_t];if(!(qe?Je in I:ht.call(I,Je)))return!1}var je=he.get(v);if(je&&he.get(I))return je==I;var yt=!0;he.set(v,I),he.set(I,v);for(var nr=qe;++_t<_e;){Je=Qe[_t];var Kt=v[Je],wr=I[Je];if(M)var Rn=qe?M(wr,Kt,Je,I,v,he):M(Kt,wr,Je,v,I,he);if(!(Rn===void 0?Kt===wr||Ce(Kt,wr,D,M,he):Rn)){yt=!1;break}nr||(nr=Je=="constructor")}if(yt&&!nr){var mi=v.constructor,et=I.constructor;mi!=et&&"constructor"in v&&"constructor"in I&&!(typeof mi=="function"&&mi instanceof mi&&typeof et=="function"&&et instanceof et)&&(yt=!1)}return he.delete(v),he.delete(I),yt}function Qi(v){return On(v,Ra,Rs)}function Wr(v,I){var D=v.__data__;return Ns(I)?D[typeof I=="string"?"string":"hash"]:D.map}function Dt(v,I){var D=st(v,I);return Pa(D)?D:void 0}function $s(v){var I=ht.call(v,Or),D=v[Or];try{v[Or]=void 0;var M=!0}catch{}var Ce=zi.call(v);return M&&(I?v[Or]=D:delete v[Or]),Ce}var Rs=ms?function(v){return v==null?[]:(v=Object(v),Pr(ms(v),function(I){return ki.call(v,I)}))}:Ne,vr=di;(_n&&vr(new _n(new ArrayBuffer(1)))!=Pe||li&&vr(new li)!=T||En&&vr(En.resolve())!=U||In&&vr(new In)!=R||Hi&&vr(new Hi)!=ae)&&(vr=function(v){var I=di(v),D=I==re?v.constructor:void 0,M=D?Rr(D):"";if(M)switch(M){case sa:return Pe;case oa:return T;case Sn:return U;case aa:return R;case Pn:return ae}return I});function Ts(v,I){return I=I??h,!!I&&(typeof v=="number"||Ae.test(v))&&v>-1&&v%1==0&&v<I}function Ns(v){var I=typeof v;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?v!=="__proto__":v===null}function Cs(v){return!!Li&&Li in v}function Ds(v){var I=v&&v.constructor,D=typeof I=="function"&&I.prototype||kt;return v===D}function Oa(v){return zi.call(v)}function Rr(v){if(v!=null){try{return Kr.call(v)}catch{}try{return v+""}catch{}}return""}function Us(v,I){return v===I||v!==v&&I!==I}var Fs=An(function(){return arguments}())?An:function(v){return yi(v)&&ht.call(v,"callee")&&!ki.call(v,"callee")},Ji=Array.isArray;function Aa(v){return v!=null&&qs(v.length)&&!Zi(v)}var $n=vs||Re;function $a(v,I){return gi(v,I)}function Zi(v){if(!js(v))return!1;var I=di(v);return I==A||I==x||I==d||I==H}function qs(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=h}function js(v){var I=typeof v;return v!=null&&(I=="object"||I=="function")}function yi(v){return v!=null&&typeof v=="object"}var Ls=nt?Fi(nt):xs;function Ra(v){return Aa(v)?Ss(v):Os(v)}function Ne(){return[]}function Re(){return!1}n.exports=$a}(rs,rs.exports)),rs.exports}var _P=bP();const EP=Up(_P);var IP={};function SP(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var o=0;o<n.length;o++){var c=n.charAt(o),h=c.charCodeAt(0);if(t[h]!==255)throw new TypeError(c+" is ambiguous");t[h]=o}var f=n.length,y=n.charAt(0),d=Math.log(f)/Math.log(256),m=Math.log(256)/Math.log(f);function b(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var T=0,k=0,V=0,re=x.length;V!==re&&x[V]===0;)V++,T++;for(var U=(re-V)*m+1>>>0,H=new Uint8Array(U);V!==re;){for(var ee=x[V],R=0,q=U-1;(ee!==0||R<k)&&q!==-1;q--,R++)ee+=256*H[q]>>>0,H[q]=ee%f>>>0,ee=ee/f>>>0;if(ee!==0)throw new Error("Non-zero carry");k=R,V++}for(var L=U-k;L!==U&&H[L]===0;)L++;for(var Y=y.repeat(T);L<U;++L)Y+=n.charAt(H[L]);return Y}function E(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var T=0;if(x[T]!==" "){for(var k=0,V=0;x[T]===y;)k++,T++;for(var re=(x.length-T)*d+1>>>0,U=new Uint8Array(re);x[T];){var H=t[x.charCodeAt(T)];if(H===255)return;for(var ee=0,R=re-1;(H!==0||ee<V)&&R!==-1;R--,ee++)H+=f*U[R]>>>0,U[R]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");V=ee,T++}if(x[T]!==" "){for(var q=re-V;q!==re&&U[q]===0;)q++;for(var L=new Uint8Array(k+(re-q)),Y=k;q!==re;)L[Y++]=U[q++];return L}}}function A(x){var T=E(x);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:E,decode:A}}var PP=SP,xP=PP;const $d=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},OP=n=>new TextEncoder().encode(n),AP=n=>new TextDecoder().decode(n);class $P{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class RP{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Rd(this,e)}}let TP=class{constructor(e){this.decoders=e}or(e){return Rd(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Rd=(n,e)=>new TP({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class NP{constructor(e,t,s,o){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=o,this.encoder=new $P(e,t,s),this.decoder=new RP(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ta=({name:n,prefix:e,encode:t,decode:s})=>new NP(n,e,t,s),ys=({prefix:n,name:e,alphabet:t})=>{const{encode:s,decode:o}=xP(t,e);return ta({prefix:n,name:e,encode:s,decode:c=>$d(o(c))})},CP=(n,e,t,s)=>{const o={};for(let m=0;m<e.length;++m)o[e[m]]=m;let c=n.length;for(;n[c-1]==="=";)--c;const h=new Uint8Array(c*t/8|0);let f=0,y=0,d=0;for(let m=0;m<c;++m){const b=o[n[m]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);y=y<<t|b,f+=t,f>=8&&(f-=8,h[d++]=255&y>>f)}if(f>=t||255&y<<8-f)throw new SyntaxError("Unexpected end of data");return h},DP=(n,e,t)=>{const s=e[e.length-1]==="=",o=(1<<t)-1;let c="",h=0,f=0;for(let y=0;y<n.length;++y)for(f=f<<8|n[y],h+=8;h>t;)h-=t,c+=e[o&f>>h];if(h&&(c+=e[o&f<<t-h]),s)for(;c.length*t&7;)c+="=";return c},ut=({name:n,prefix:e,bitsPerChar:t,alphabet:s})=>ta({prefix:e,name:n,encode(o){return DP(o,s,t)},decode(o){return CP(o,s,t,n)}}),UP=ta({prefix:"\0",name:"identity",encode:n=>AP(n),decode:n=>OP(n)});var FP=Object.freeze({__proto__:null,identity:UP});const qP=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jP=Object.freeze({__proto__:null,base2:qP});const LP=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var zP=Object.freeze({__proto__:null,base8:LP});const MP=ys({prefix:"9",name:"base10",alphabet:"0123456789"});var BP=Object.freeze({__proto__:null,base10:MP});const kP=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),HP=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var VP=Object.freeze({__proto__:null,base16:kP,base16upper:HP});const KP=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),GP=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),WP=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),QP=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),JP=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ZP=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),YP=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),XP=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),e2=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var t2=Object.freeze({__proto__:null,base32:KP,base32upper:GP,base32pad:WP,base32padupper:QP,base32hex:JP,base32hexupper:ZP,base32hexpad:YP,base32hexpadupper:XP,base32z:e2});const r2=ys({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i2=ys({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var n2=Object.freeze({__proto__:null,base36:r2,base36upper:i2});const s2=ys({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),o2=ys({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var a2=Object.freeze({__proto__:null,base58btc:s2,base58flickr:o2});const c2=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),u2=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),h2=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),l2=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var f2=Object.freeze({__proto__:null,base64:c2,base64pad:u2,base64url:h2,base64urlpad:l2});const Td=Array.from(""),p2=Td.reduce((n,e,t)=>(n[t]=e,n),[]),d2=Td.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function g2(n){return n.reduce((e,t)=>(e+=p2[t],e),"")}function y2(n){const e=[];for(const t of n){const s=d2[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const m2=ta({prefix:"",name:"base256emoji",encode:g2,decode:y2});var v2=Object.freeze({__proto__:null,base256emoji:m2}),w2=Nd,Jf=128,b2=-128,_2=Math.pow(2,31);function Nd(n,e,t){e=e||[],t=t||0;for(var s=t;n>=_2;)e[t++]=n&255|Jf,n/=128;for(;n&b2;)e[t++]=n&255|Jf,n>>>=7;return e[t]=n|0,Nd.bytes=t-s+1,e}var E2=xu,I2=128,Zf=127;function xu(n,s){var t=0,s=s||0,o=0,c=s,h,f=n.length;do{if(c>=f)throw xu.bytes=0,new RangeError("Could not decode varint");h=n[c++],t+=o<28?(h&Zf)<<o:(h&Zf)*Math.pow(2,o),o+=7}while(h>=I2);return xu.bytes=c-s,t}var S2=Math.pow(2,7),P2=Math.pow(2,14),x2=Math.pow(2,21),O2=Math.pow(2,28),A2=Math.pow(2,35),$2=Math.pow(2,42),R2=Math.pow(2,49),T2=Math.pow(2,56),N2=Math.pow(2,63),C2=function(n){return n<S2?1:n<P2?2:n<x2?3:n<O2?4:n<A2?5:n<$2?6:n<R2?7:n<T2?8:n<N2?9:10},D2={encode:w2,decode:E2,encodingLength:C2},Cd=D2;const Yf=(n,e,t=0)=>(Cd.encode(n,e,t),e),Xf=n=>Cd.encodingLength(n),Ou=(n,e)=>{const t=e.byteLength,s=Xf(n),o=s+Xf(t),c=new Uint8Array(o+t);return Yf(n,c,0),Yf(t,c,s),c.set(e,o),new U2(n,t,e,c)};let U2=class{constructor(e,t,s,o){this.code=e,this.size=t,this.digest=s,this.bytes=o}};const Dd=({name:n,code:e,encode:t})=>new F2(n,e,t);class F2{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ou(this.code,t):t.then(s=>Ou(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Ud=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),q2=Dd({name:"sha2-256",code:18,encode:Ud("SHA-256")}),j2=Dd({name:"sha2-512",code:19,encode:Ud("SHA-512")});var L2=Object.freeze({__proto__:null,sha256:q2,sha512:j2});const Fd=0,z2="identity",qd=$d,M2=n=>Ou(Fd,qd(n)),B2={code:Fd,name:z2,encode:qd,digest:M2};var k2=Object.freeze({__proto__:null,identity:B2});new TextEncoder,new TextDecoder;const ep={...FP,...jP,...zP,...BP,...VP,...t2,...n2,...a2,...f2,...v2};({...L2,...k2});function jd(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function H2(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?jd(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Ld(n,e,t,s){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:s}}}const tp=Ld("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Yc=Ld("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=H2(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),V2={utf8:tp,"utf-8":tp,hex:ep.base16,latin1:Yc,ascii:Yc,binary:Yc,...ep};function K2(n,e="utf8"){const t=V2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?jd(globalThis.Buffer.from(n,"utf-8")):t.decoder.decode(`${t.prefix}${n}`)}const zd="wc",G2=2,Md="core",ai=`${zd}@2:${Md}:`,W2={logger:"error"},Q2={database:":memory:"},J2="crypto",rp="client_ed25519_seed",Z2=K.ONE_DAY,Y2="keychain",X2="0.3",ex="messages",tx="0.3",rx=K.SIX_HOURS,ix="publisher",Bd="irn",nx="error",kd="wss://relay.walletconnect.com",ip="wss://relay.walletconnect.org",sx="relayer",pt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ox="_subscription",Br={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ax=K.ONE_SECOND,cx="2.10.6",ux=1e4,hx="0.3",lx="WALLETCONNECT_CLIENT_ID",lr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},fx="subscription",px="0.3",dx=K.FIVE_SECONDS*1e3,gx="pairing",yx="0.3",Qn={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},is={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Sr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},mx="history",vx="0.3",wx="expirer",er={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},bx="0.3",Xc="verify-api",dn="https://verify.walletconnect.com",Au="https://verify.walletconnect.org",_x=[dn,Au];class Ex{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Y2,this.version=X2,this.initialized=!1,this.storagePrefix=ai,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:c}=Te("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(c)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=e,this.logger=Bt(t,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Pd(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?xd(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ix{constructor(e,t,s){this.core=e,this.logger=t,this.name=J2,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=Ff(o);return _d(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=PS();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),h=Ff(c),f=Eu();return await IS(f,o,Z2,h)},this.generateSharedKey=(o,c,h)=>{this.isInitialized();const f=this.getPrivateKey(o),y=xS(f,c);return this.setSymKey(y,h)},this.setSymKey=async(o,c)=>{this.isInitialized();const h=c||OS(o);return await this.keychain.set(h,o),h},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,h)=>{this.isInitialized();const f=Sd(h),y=us(c);if(jf(f)){const E=f.senderPublicKey,A=f.receiverPublicKey;o=await this.generateSharedKey(E,A)}const d=this.getSymKey(o),{type:m,senderPublicKey:b}=f;return $S({type:m,symKey:d,message:y,senderPublicKey:b})},this.decode=async(o,c,h)=>{this.isInitialized();const f=NS(c,h);if(jf(f)){const y=f.receiverPublicKey,d=f.senderPublicKey;o=await this.generateSharedKey(y,d)}try{const y=this.getSymKey(o),d=RS({symKey:y,encoded:c});return Wo(d)}catch(y){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(y)}},this.getPayloadType=o=>{const c=Ho(o);return gs(c.type)},this.getPayloadSenderPublicKey=o=>{const c=Ho(o);return c.senderPublicKey?Mt(c.senderPublicKey,bt):void 0},this.core=e,this.logger=Bt(t,this.name),this.keychain=s||new Ex(this.core,this.logger)}get context(){return $t(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(rp)}catch{e=Eu(),await this.keychain.set(rp,e)}return K2(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Sx extends S_{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=ex,this.version=tx,this.initialized=!1,this.storagePrefix=ai,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const c=Iu(o);let h=this.messages.get(s);return typeof h>"u"&&(h={}),typeof h[c]<"u"||(h[c]=o,this.messages.set(s,h),await this.persist()),c},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const c=this.get(s),h=Iu(o);return typeof c[h]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Bt(e,this.name),this.core=t}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Pd(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?xd(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Px extends P_{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new dr.EventEmitter,this.name=ix,this.queue=new Map,this.publishTimeout=K.toMiliseconds(K.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,c)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}});try{const f=(c==null?void 0:c.ttl)||rx,y=Su(c),d=(c==null?void 0:c.prompt)||!1,m=(c==null?void 0:c.tag)||0,b=(c==null?void 0:c.id)||Nu().toString(),E={topic:s,message:o,opts:{ttl:f,relay:y,prompt:d,tag:m,id:b}},A=setTimeout(()=>this.queue.set(b,E),this.publishTimeout);try{await await cs(this.rpcPublish(s,o,f,y,d,m,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(pt.publish,E)}catch(x){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=c==null?void 0:c.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),x;return}finally{clearTimeout(A)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}})}catch(f){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(f),f}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=e,this.logger=Bt(t,this.name),this.registerEventListeners()}get context(){return $t(this.logger)}rpcPublish(e,t,s,o,c,h,f){var y,d,m,b;const E={method:zo(o.protocol).publish,params:{topic:e,message:t,ttl:s,prompt:c,tag:h},id:f};return Pu((y=E.params)==null?void 0:y.prompt)&&((d=E.params)==null||delete d.prompt),Pu((m=E.params)==null?void 0:m.tag)&&((b=E.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.request(E)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:s,opts:o}=e;await this.publish(t,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(fs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(pt.connection_stalled);return}this.checkQueue()}),this.relayer.on(pt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class xx{constructor(){this.map=new Map,this.set=(e,t)=>{const s=this.get(e);this.exists(e,t)||this.map.set(e,[...s,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,t))return;const o=s.filter(c=>c!==t);if(!o.length){this.map.delete(e);return}this.map.set(e,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Ox=Object.defineProperty,Ax=Object.defineProperties,$x=Object.getOwnPropertyDescriptors,np=Object.getOwnPropertySymbols,Rx=Object.prototype.hasOwnProperty,Tx=Object.prototype.propertyIsEnumerable,sp=(n,e,t)=>e in n?Ox(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Jn=(n,e)=>{for(var t in e||(e={}))Rx.call(e,t)&&sp(n,t,e[t]);if(np)for(var t of np(e))Tx.call(e,t)&&sp(n,t,e[t]);return n},eu=(n,e)=>Ax(n,$x(e));class Nx extends A_{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new xx,this.events=new dr.EventEmitter,this.name=fx,this.version=px,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ai,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const c=Su(o),h={topic:s,relay:c};this.pending.set(s,h);const f=await this.rpcSubscribe(s,c);return this.onSubscribe(f,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),f}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,c)=>{const h=new K.Watch;h.start(this.pendingSubscriptionWatchLabel);const f=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(f),h.stop(this.pendingSubscriptionWatchLabel),o(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=dx&&(clearInterval(f),h.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Bt(t,this.name),this.clientId=""}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let s=!1;try{s=this.getSubscription(e).topic===t}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const s=this.topicMap.get(e);await Promise.all(s.map(async o=>await this.unsubscribeById(e,o,t)))}async unsubscribeById(e,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}});try{const o=Su(s);await this.rpcUnsubscribe(e,t,o);const c=ts("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(e,t){const s={method:zo(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await cs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(pt.connection_stalled)}return Iu(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,s={method:zo(t.protocol).batchSubscribe,params:{topics:e.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await cs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(pt.connection_stalled)}}rpcUnsubscribe(e,t,s){const o={method:zo(s.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(e,t){this.setSubscription(e,eu(Jn({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Jn({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Jn({},t)),this.topicMap.set(t.topic,e),this.events.emit(lr.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:s}=Te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(lr.deleted,eu(Jn({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lr.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(lr.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=Te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);sP(t)&&this.onBatchSubscribe(t.map((s,o)=>eu(Jn({},e[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(fs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(pt.connect,async()=>{await this.onConnect()}),this.relayer.on(pt.disconnect,()=>{this.onDisconnect()}),this.events.on(lr.created,async e=>{const t=lr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(lr.deleted,async e=>{const t=lr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var Cx=Object.defineProperty,op=Object.getOwnPropertySymbols,Dx=Object.prototype.hasOwnProperty,Ux=Object.prototype.propertyIsEnumerable,ap=(n,e,t)=>e in n?Cx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Fx=(n,e)=>{for(var t in e||(e={}))Dx.call(e,t)&&ap(n,t,e[t]);if(op)for(var t of op(e))Ux.call(e,t)&&ap(n,t,e[t]);return n};class qx extends x_{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new dr.EventEmitter,this.name=sx,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(pt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(pt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Br.payload,this.onPayloadHandler),this.provider.on(Br.connect,this.onConnectHandler),this.provider.on(Br.disconnect,this.onDisconnectHandler),this.provider.on(Br.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Bt(e.logger,this.name):Jo(Zo({level:e.logger||nx})),this.messages=new Sx(this.logger,e.core),this.subscriber=new Nx(this,this.logger),this.publisher=new Px(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||kd,this.projectId=e.projectId,this.bundleId=jS(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ip}...`),await this.restartTransport(ip)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},ux)}get context(){return $t(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,s){this.isInitialized(),await this.publisher.publish(e,t,s),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"";if(o)return o;let c;const h=f=>{f.topic===e&&(this.subscriber.off(lr.created,h),c())};return await Promise.all([new Promise(f=>{c=f,this.subscriber.on(lr.created,h)}),new Promise(async f=>{o=await this.subscriber.subscribe(e,t),f()})]),o}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await cs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(lr.resubscribed,()=>{t()})}),new Promise(async(t,s)=>{try{await cs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}t()})])}catch(t){this.logger.error(t);const s=t;if(!this.isConnectionStalled(s.message))throw t;this.provider.events.emit(Br.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Kf())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new gP(new wP(kS({sdkVersion:cx,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:s}=e;await this.messages.set(t,s)}async shouldIgnoreMessageEvent(e){const{topic:t,message:s}=e;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const o=this.messages.has(t,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Du(e)){if(!e.method.endsWith(ox))return;const t=e.params,{topic:s,message:o,publishedAt:c}=t.data,h={topic:s,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fx({type:"event",event:t.id},h)),this.events.emit(t.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}else hs(e)&&this.events.emit(pt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(pt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Uu(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Br.payload,this.onPayloadHandler),this.provider.off(Br.connect,this.onConnectHandler),this.provider.off(Br.disconnect,this.onDisconnectHandler),this.provider.off(Br.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(pt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let e=await Kf();fP(async t=>{this.initialized&&e!==t&&(e=t,t?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(pt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},K.toMiliseconds(ax)))}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var jx=Object.defineProperty,cp=Object.getOwnPropertySymbols,Lx=Object.prototype.hasOwnProperty,zx=Object.prototype.propertyIsEnumerable,up=(n,e,t)=>e in n?jx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,hp=(n,e)=>{for(var t in e||(e={}))Lx.call(e,t)&&up(n,t,e[t]);if(cp)for(var t of cp(e))zx.call(e,t)&&up(n,t,e[t]);return n};class ra extends O_{constructor(e,t,s,o=ai,c=void 0){super(e,t,s,o),this.core=e,this.logger=t,this.name=s,this.map=new Map,this.version=hx,this.cached=[],this.initialized=!1,this.storagePrefix=ai,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!Pu(h)?this.map.set(this.getKey(h),h):aP(h)?this.map.set(h.id,h):cP(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,f)=>{this.isInitialized(),this.map.has(h)?await this.update(h,f):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:f}),this.map.set(h,f),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(f=>Object.keys(h).every(y=>EP(f[y],h[y]))):this.values),this.update=async(h,f)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:f});const y=hp(hp({},this.getData(h)),f);this.map.set(h,y),await this.persist()},this.delete=async(h,f)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:f}),this.map.delete(h),await this.persist())},this.logger=Bt(t,this.name),this.storagePrefix=o,this.getKey=c}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:s}=Te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=Te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Mx{constructor(e,t){this.core=e,this.logger=t,this.name=gx,this.version=yx,this.events=new Fu,this.initialized=!1,this.storagePrefix=ai,this.ignoredPayloadTypes=[yn],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Eu(),o=await this.core.crypto.setSymKey(s),c=Lo(K.FIVE_MINUTES),h={protocol:Bd},f={topic:o,expiry:c,relay:h,active:!1},y=rP({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:h});return await this.pairings.set(o,f),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:y}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:c,relay:h}=Vf(s.uri);let f;if(this.pairings.keys.includes(o)&&(f=this.pairings.get(o),f.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const y=Lo(K.FIVE_MINUTES),d={topic:o,relay:h,expiry:y,active:!1};return await this.pairings.set(o,d),this.core.expirer.set(o,y),s.activatePairing&&await this.activate({topic:o}),this.events.emit(is.create,d),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:h})),d},this.activate=async({topic:s})=>{this.isInitialized();const o=Lo(K.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:f,reject:y}=HS();this.events.once(Jc("pairing_ping",c),({error:d})=>{d?y(d):f()}),await h()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",ts("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,c)=>{const h=Ri(o,c),f=await this.core.crypto.encode(s,h),y=Qn[o].req;return this.core.history.set(s,h),this.core.relayer.publish(s,f,y),h.id},this.sendResult=async(s,o,c)=>{const h=Uu(s,c),f=await this.core.crypto.encode(o,h),y=await this.core.history.get(o,s),d=Qn[y.request.method].res;await this.core.relayer.publish(o,f,d),await this.core.history.resolve(h)},this.sendError=async(s,o,c)=>{const h=Cu(s,c),f=await this.core.crypto.encode(o,h),y=await this.core.history.get(o,s),d=Qn[y.request.method]?Qn[y.request.method].res:Qn.unregistered_method.res;await this.core.relayer.publish(o,f,d),await this.core.history.resolve(h)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ts("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>Bf(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:c}=s;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:c}=s,h=(await this.core.history.get(o,c.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(s,o)=>{const{id:c}=o;try{this.isValidPing({topic:s}),await this.sendResult(c,s,!0),this.events.emit(is.ping,{id:c,topic:s})}catch(h){await this.sendError(c,s,h),this.logger.error(h)}},this.onPairingPingResponse=(s,o)=>{const{id:c}=o;setTimeout(()=>{oi(o)?this.events.emit(Jc("pairing_ping",c),{}):fr(o)&&this.events.emit(Jc("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(is.delete,{id:c,topic:s})}catch(h){await this.sendError(c,s,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:c,method:h}=o;try{if(this.registeredMethods.includes(h))return;const f=ts("WC_METHOD_UNSUPPORTED",h);await this.sendError(c,s,f),this.logger.error(f)}catch(f){await this.sendError(c,s,f),this.logger.error(f)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(ts("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var o;if(!Zc(s)){const{message:h}=Te("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(h)}if(!oP(s.uri)){const{message:h}=Te("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(h)}const c=Vf(s.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:h}=Te("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(c!=null&&c.symKey)){const{message:h}=Te("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async s=>{if(!Zc(s)){const{message:c}=Te("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!Zc(s)){const{message:c}=Te("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!Ad(s)){const{message:o}=Te("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=Te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(Bf(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=Te("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=e,this.logger=Bt(t,this.name),this.pairings=new ra(this.core,this.logger,this.name,this.storagePrefix)}get context(){return $t(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(pt.message,async e=>{const{topic:t,message:s}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(t,s);try{Du(o)?(this.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o})):hs(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o}),this.core.history.delete(t,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(er.expired,async e=>{const{topic:t}=GS(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(is.expire,{topic:t}))})}}let Bx=class extends I_{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new dr.EventEmitter,this.name=mx,this.version=vx,this.cached=[],this.initialized=!1,this.storagePrefix=ai,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:c}),this.records.has(o.id))return;const h={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:c,expiry:Lo(K.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(Sr.created,h)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=fr(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(Sr.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===s){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(Sr.deleted,c)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Bt(t,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const s={topic:t.topic,request:Ri(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:s}=Te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Sr.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=Te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Sr.created,e=>{const t=Sr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Sr.updated,e=>{const t=Sr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Sr.deleted,e=>{const t=Sr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.core.heartbeat.on(fs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{K.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}},kx=class extends $_{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new dr.EventEmitter,this.name=wx,this.version=bx,this.cached=[],this.initialized=!1,this.storagePrefix=ai,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const c=this.formatTarget(s),h={target:c,expiry:o};this.expirations.set(c,h),this.checkExpiry(c,h),this.events.emit(er.created,{target:c,expiration:h})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(er.deleted,{target:o,expiration:c})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Bt(t,this.name)}get context(){return $t(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return VS(e);if(typeof e=="number")return KS(e);const{message:t}=Te("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(er.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=Te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:s}=Te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}checkExpiry(e,t){const{expiry:s}=t;K.toMiliseconds(s)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(er.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(fs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(er.created,e=>{const t=er.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(er.expired,e=>{const t=er.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(er.deleted,e=>{const t=er.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Te("NOT_INITIALIZED",this.name);throw new Error(e)}}};class Hx extends R_{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=Xc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||mn()||!Xo())return;const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Au;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let c;try{c=await this.fetchAttestation(s.attestationId,o)}catch(h){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(h),c=await this.fetchAttestation(s.attestationId,Au)}return c},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const c=this.startAbortTimer(K.ONE_SECOND*2),h=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(c),h.status===200?await h.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(c=>{if(document.getElementById(Xc))return c();window.addEventListener("message",o);const h=document.createElement("iframe");h.id=Xc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,s=c}),new Promise((c,h)=>setTimeout(()=>{window.removeEventListener("message",o),h("verify iframe load timeout")},K.toMiliseconds(K.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let o=s||dn;return _x.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${dn}`),o=dn),o},this.logger=Bt(t,this.name),this.verifyUrl=dn,this.abortController=new AbortController,this.isDevEnv=Wu()&&IP.IS_VITEST}get context(){return $t(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),K.toMiliseconds(e))}}var Vx=Object.defineProperty,lp=Object.getOwnPropertySymbols,Kx=Object.prototype.hasOwnProperty,Gx=Object.prototype.propertyIsEnumerable,fp=(n,e,t)=>e in n?Vx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pp=(n,e)=>{for(var t in e||(e={}))Kx.call(e,t)&&fp(n,t,e[t]);if(lp)for(var t of lp(e))Gx.call(e,t)&&fp(n,t,e[t]);return n};let Wx=class Hd extends E_{constructor(e){super(e),this.protocol=zd,this.version=G2,this.name=Md,this.events=new dr.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||kd,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Jo(Zo({level:(e==null?void 0:e.logger)||W2.logger}));this.logger=Bt(t,this.name),this.heartbeat=new fs.HeartBeat,this.crypto=new Ix(this,this.logger,e==null?void 0:e.keychain),this.history=new Bx(this,this.logger),this.expirer=new kx(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new U1(pp(pp({},Q2),e==null?void 0:e.storageOptions)),this.relayer=new qx({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Mx(this,this.logger),this.verify=new Hx(this.projectId||"",this.logger)}static async init(e){const t=new Hd(e);await t.initialize();const s=await t.crypto.getClientId();return await t.storage.setItem(lx,s),t}get context(){return $t(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const Qx=Wx;function Vd(n,e){return n.includes(":")?[n]:e.chains||[]}const Jx="base16",Zx="utf8",Yx=1;function tu(n){const e=Go.hash(rr(n,Zx));return Mt(e,Jx)}const Xx="ReactNative",gn={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function Kd(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function eO(){return!Ti.getDocument()&&!!Ti.getNavigator()&&navigator.product===Xx}function Qu(){return!Kd()&&!!Ti.getNavigator()}function tO(){return eO()?gn.reactNative:Kd()?gn.node:Qu()?gn.browser:gn.unknown}function rO(){return Vb.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function $i(n,e){return n.filter(t=>e.includes(t)).length===n.length}function Zn(n=K.FIVE_MINUTES,e){const t=K.toMiliseconds(n||K.FIVE_MINUTES);let s,o,c;return{resolve:h=>{c&&s&&(clearTimeout(c),s(h))},reject:h=>{c&&o&&(clearTimeout(c),o(h))},done:()=>new Promise((h,f)=>{c=setTimeout(()=>{f(new Error(e))},t),s=h,o=f})}}function iO(n){const[e,t]=n.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")s.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return s}function Oi(n,e){return K.fromMiliseconds(Date.now()+K.toMiliseconds(n))}function pn(n){return Date.now()>=K.toMiliseconds(n)}function at(n,e){return`${n}${e?`:${e}`:""}`}async function nO({id:n,topic:e,wcDeepLink:t}){try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t;let o=s==null?void 0:s.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const c=`${o}/wc?requestId=${n}&sessionTopic=${e}`,h=tO();h===gn.browser?c.startsWith("https://")?window.open(c,"_blank","noreferrer noopener"):window.open(c,"_self","noreferrer noopener"):h===gn.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(c)}catch(s){console.error(s)}}async function sO(n,e){try{return await n.getItem(e)||(Qu()?localStorage.getItem(e):void 0)}catch(t){console.error(t)}}function vn(n){const e=[];return n.forEach(t=>{const[s,o]=t.split(":");e.push(`${s}:${o}`)}),e}function oO(n){const e=[];return Object.values(n).forEach(t=>{e.push(...vn(t.accounts))}),e}function aO(n,e){const t=[];return Object.values(n).forEach(s=>{vn(s.accounts).includes(e)&&t.push(...s.methods)}),t}function cO(n,e){const t=[];return Object.values(n).forEach(s=>{vn(s.accounts).includes(e)&&t.push(...s.events)}),t}function uO(n,e){const t=Mo(n,e);if(t)throw new Error(t.message);const s={};for(const[o,c]of Object.entries(n))s[o]={methods:c.methods,events:c.events,chains:c.accounts.map(h=>`${h.split(":")[0]}:${h.split(":")[1]}`)};return s}const hO={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},lO={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function oe(n,e){const{message:t,code:s}=lO[n];return{message:e?`${t} ${e}`:t,code:s}}function zt(n,e){const{message:t,code:s}=hO[n];return{message:e?`${t} ${e}`:t,code:s}}function ia(n,e){return!!Array.isArray(n)}function os(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function tr(n){return typeof n>"u"}function dt(n,e){return e&&tr(n)?!0:typeof n=="string"&&!!n.trim().length}function Ju(n,e){return e&&tr(n)?!0:typeof n=="number"&&!isNaN(n)}function fO(n,e){const{requiredNamespaces:t}=e,s=Object.keys(n.namespaces),o=Object.keys(t);let c=!0;return $i(o,s)?(s.forEach(h=>{const{accounts:f,methods:y,events:d}=n.namespaces[h],m=vn(f),b=t[h];(!$i(Vd(h,b),m)||!$i(b.methods,y)||!$i(b.events,d))&&(c=!1)}),c):!1}function Vo(n){return dt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function pO(n){if(dt(n,!1)&&n.includes(":")){const e=n.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Vo(t)}}return!1}function dO(n,e){let t=null;return dt(n==null?void 0:n.publicKey,!1)||(t=oe("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function dp(n){let e=!0;return ia(n)?n.length&&(e=n.every(t=>dt(t,!1))):e=!1,e}function gO(n,e,t){let s=null;return ia(e)&&e.length?e.forEach(o=>{s||Vo(o)||(s=zt("UNSUPPORTED_CHAINS",`${t}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):Vo(n)||(s=zt("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function yO(n,e,t){let s=null;return Object.entries(n).forEach(([o,c])=>{if(s)return;const h=gO(o,Vd(o,c),`${e} ${t}`);h&&(s=h)}),s}function mO(n,e){let t=null;return ia(n)?n.forEach(s=>{t||pO(s)||(t=zt("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):t=zt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function vO(n,e){let t=null;return Object.values(n).forEach(s=>{if(t)return;const o=mO(s==null?void 0:s.accounts,`${e} namespace`);o&&(t=o)}),t}function wO(n,e){let t=null;return dp(n==null?void 0:n.methods)?dp(n==null?void 0:n.events)||(t=zt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=zt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Gd(n,e){let t=null;return Object.values(n).forEach(s=>{if(t)return;const o=wO(s,`${e}, namespace`);o&&(t=o)}),t}function bO(n,e,t){let s=null;if(n&&os(n)){const o=Gd(n,e);o&&(s=o);const c=yO(n,e,t);c&&(s=c)}else s=oe("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return s}function Mo(n,e){let t=null;if(n&&os(n)){const s=Gd(n,e);s&&(t=s);const o=vO(n,e);o&&(t=o)}else t=oe("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Wd(n){return dt(n.protocol,!0)}function _O(n,e){let t=!1;return n?n&&ia(n)&&n.length&&n.forEach(s=>{t=Wd(s)}):t=!0,t}function EO(n){return typeof n=="number"}function hr(n){return typeof n<"u"&&typeof n!==null}function IO(n){return!(!n||typeof n!="object"||!n.code||!Ju(n.code,!1)||!n.message||!dt(n.message,!1))}function SO(n){return!(tr(n)||!dt(n.method,!1))}function PO(n){return!(tr(n)||tr(n.result)&&tr(n.error)||!Ju(n.id,!1)||!dt(n.jsonrpc,!1))}function xO(n){return!(tr(n)||!dt(n.name,!1))}function gp(n,e){return!(!Vo(e)||!oO(n).includes(e))}function OO(n,e,t){return dt(t,!1)?aO(n,e).includes(t):!1}function AO(n,e,t){return dt(t,!1)?cO(n,e).includes(t):!1}function yp(n,e,t){let s=null;const o=$O(n),c=RO(e),h=Object.keys(o),f=Object.keys(c),y=mp(Object.keys(n)),d=mp(Object.keys(e)),m=y.filter(b=>!d.includes(b));return m.length&&(s=oe("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${m.toString()}
      Received: ${Object.keys(e).toString()}`)),$i(h,f)||(s=oe("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${f.toString()}`)),Object.keys(e).forEach(b=>{if(!b.includes(":")||s)return;const E=vn(e[b].accounts);E.includes(b)||(s=oe("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${b}
        Required: ${b}
        Approved: ${E.toString()}`))}),h.forEach(b=>{s||($i(o[b].methods,c[b].methods)?$i(o[b].events,c[b].events)||(s=oe("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${b}`)):s=oe("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${b}`))}),s}function $O(n){const e={};return Object.keys(n).forEach(t=>{var s;t.includes(":")?e[t]=n[t]:(s=n[t].chains)==null||s.forEach(o=>{e[o]={methods:n[t].methods,events:n[t].events}})}),e}function mp(n){return[...new Set(n.map(e=>e.includes(":")?e.split(":")[0]:e))]}function RO(n){const e={};return Object.keys(n).forEach(t=>{if(t.includes(":"))e[t]=n[t];else{const s=vn(n[t].accounts);s==null||s.forEach(o=>{e[o]={accounts:n[t].accounts.filter(c=>c.includes(`${o}:`)),methods:n[t].methods,events:n[t].events}})}}),e}function TO(n,e){return Ju(n,!1)&&n<=e.max&&n>=e.min}const ru={};class No{static get(e){return ru[e]}static set(e,t){ru[e]=t}static delete(e){delete ru[e]}}const Qd="wc",Jd=2,Zd="client",Zu=`${Qd}@${Jd}:${Zd}:`,iu={name:Zd,logger:"error"},vp="WALLETCONNECT_DEEPLINK_CHOICE",NO="proposal",Yd="Proposal expired",CO="session",Co=K.SEVEN_DAYS,DO="engine",Yn={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1115}}},nu={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},kr={idle:"IDLE",active:"ACTIVE"},UO="request",FO=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var qO=Object.defineProperty,jO=Object.defineProperties,LO=Object.getOwnPropertyDescriptors,wp=Object.getOwnPropertySymbols,zO=Object.prototype.hasOwnProperty,MO=Object.prototype.propertyIsEnumerable,bp=(n,e,t)=>e in n?qO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ot=(n,e)=>{for(var t in e||(e={}))zO.call(e,t)&&bp(n,t,e[t]);if(wp)for(var t of wp(e))MO.call(e,t)&&bp(n,t,e[t]);return n},Xn=(n,e)=>jO(n,LO(e));class BO extends N_{constructor(e){super(e),this.name=DO,this.events=new Fu,this.initialized=!1,this.ignoredPayloadTypes=[Yx],this.requestQueue={state:kr.idle,queue:[]},this.sessionRequestQueue={state:kr.idle,queue:[]},this.requestQueueDelay=K.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Yn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const s=Xn(Ot({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:h,sessionProperties:f,relays:y}=s;let d=o,m,b=!1;if(d&&(b=this.client.core.pairing.pairings.get(d).active),!d||!b){const{topic:U,uri:H}=await this.client.core.pairing.create();d=U,m=H}const E=await this.client.core.crypto.generateKeyPair(),A=Ot({requiredNamespaces:c,optionalNamespaces:h,relays:y??[{protocol:Bd}],proposer:{publicKey:E,metadata:this.client.metadata}},f&&{sessionProperties:f}),{reject:x,resolve:T,done:k}=Zn(K.FIVE_MINUTES,Yd);if(this.events.once(at("session_connect"),async({error:U,session:H})=>{if(U)x(U);else if(H){H.self.publicKey=E;const ee=Xn(Ot({},H),{requiredNamespaces:H.requiredNamespaces,optionalNamespaces:H.optionalNamespaces});await this.client.session.set(H.topic,ee),await this.setExpiry(H.topic,H.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:H.peer.metadata}),T(ee)}}),!d){const{message:U}=oe("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(U)}const V=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:A}),re=Oi(K.FIVE_MINUTES);return await this.setProposal(V,Ot({id:V,expiry:re},A)),{uri:m,approval:k}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:s,relayProtocol:o,namespaces:c,sessionProperties:h}=t,f=this.client.proposal.get(s);let{pairingTopic:y,proposer:d,requiredNamespaces:m,optionalNamespaces:b}=f;y=y||"",os(m)||(m=uO(c,"approve()"));const E=await this.client.core.crypto.generateKeyPair(),A=d.publicKey,x=await this.client.core.crypto.generateSharedKey(E,A);y&&s&&(await this.client.core.pairing.updateMetadata({topic:y,metadata:d.metadata}),await this.sendResult({id:s,topic:y,result:{relay:{protocol:o??"irn"},responderPublicKey:E}}),await this.client.proposal.delete(s,zt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:y}));const T=Ot({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:m,optionalNamespaces:b,pairingTopic:y,controller:{publicKey:E,metadata:this.client.metadata},expiry:Oi(Co)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(x),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0});const k=Xn(Ot({},T),{topic:x,pairingTopic:y,acknowledged:!1,self:T.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:E});return await this.client.session.set(x,k),await this.setExpiry(x,Oi(Co)),{topic:x,acknowledged:()=>new Promise(V=>setTimeout(()=>V(this.client.session.get(x)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:s,reason:o}=t,{pairingTopic:c}=this.client.proposal.get(s);c&&(await this.sendError(s,c,o),await this.client.proposal.delete(s,zt("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:s,namespaces:o}=t,c=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:h,resolve:f,reject:y}=Zn();return this.events.once(at("session_update",c),({error:d})=>{d?y(d):f()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:h}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:s}=t,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:c,resolve:h,reject:f}=Zn();return this.events.once(at("session_extend",o),({error:y})=>{y?f(y):h()}),await this.setExpiry(s,Oi(Co)),{acknowledged:c}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:s,request:o,topic:c,expiry:h}=t,f=Zb(),{done:y,resolve:d,reject:m}=Zn(h,"Request expired. Please try again.");return this.events.once(at("session_request",f),({error:b,result:E})=>{b?m(b):d(E)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:f,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:s},expiry:h,throwOnFailedPublish:!0}).catch(E=>m(E)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:s,id:f}),b()}),new Promise(async b=>{const E=await sO(this.client.core.storage,vp);nO({id:f,topic:c,wcDeepLink:E}),b()}),y()]).then(b=>b[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:s,response:o}=t,{id:c}=o;oi(o)?await this.sendResult({id:c,topic:s,result:o.result,throwOnFailedPublish:!0}):fr(o)&&await this.sendError(c,s,o.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:s}=t;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:c,resolve:h,reject:f}=Zn();this.events.once(at("session_ping",o),({error:y})=>{y?f(y):h()}),await c()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:s,event:o,chainId:c}=t;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:s}=t;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:zt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(s=>fO(s,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const s=this.client.core.pairing.pairings.get(t.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var h,f;return((h=c.peerMetadata)==null?void 0:h.url)&&((f=c.peerMetadata)==null?void 0:f.url)===t.peer.metadata.url&&c.topic&&c.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(t,s)=>{const{self:o}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,zt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),s||this.client.core.expirer.del(t),this.client.core.storage.removeItem(vp).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(t,s)=>{await Promise.all([this.client.proposal.delete(t,zt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),o?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==t),o&&(this.sessionRequestQueue.state=kr.idle)},this.setExpiry=async(t,s)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:s}),this.client.core.expirer.set(t,s)},this.setProposal=async(t,s)=>{await this.client.proposal.set(t,s),this.client.core.expirer.set(t,s.expiry)},this.setPendingSessionRequest=async t=>{const s=Yn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:h,verifyContext:f}=t;await this.client.pendingRequest.set(o,{id:o,topic:c,params:h,verifyContext:f}),s&&this.client.core.expirer.set(o,Oi(s))},this.sendRequest=async t=>{const{topic:s,method:o,params:c,expiry:h,relayRpcId:f,clientRpcId:y,throwOnFailedPublish:d}=t,m=Ri(o,c,y);if(Qu()&&FO.includes(o)){const A=tu(JSON.stringify(m));this.client.core.verify.register({attestationId:A})}const b=await this.client.core.crypto.encode(s,m),E=Yn[o].req;return h&&(E.ttl=h),f&&(E.id=f),this.client.core.history.set(s,m),d?(E.internal=Xn(Ot({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,b,E)):this.client.core.relayer.publish(s,b,E).catch(A=>this.client.logger.error(A)),m.id},this.sendResult=async t=>{const{id:s,topic:o,result:c,throwOnFailedPublish:h}=t,f=Uu(s,c),y=await this.client.core.crypto.encode(o,f),d=await this.client.core.history.get(o,s),m=Yn[d.request.method].res;h?(m.internal=Xn(Ot({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,y,m)):this.client.core.relayer.publish(o,y,m).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(f)},this.sendError=async(t,s,o)=>{const c=Cu(t,o),h=await this.client.core.crypto.encode(s,c),f=await this.client.core.history.get(s,t),y=Yn[f.request.method].res;this.client.core.relayer.publish(s,h,y),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],s=[];this.client.session.getAll().forEach(o=>{pn(o.expiry)&&t.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{pn(o.expiry)&&s.push(o.id)}),await Promise.all([...t.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===kr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=kr.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=kr.idle},this.processRequest=t=>{const{topic:s,payload:o}=t,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:s,payload:o}=t,c=(await this.client.core.history.get(s,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:s}=t,{message:o}=oe("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(t,s)=>{const{params:o,id:c}=s;try{this.isValidConnect(Ot({},s.params));const h=Oi(K.FIVE_MINUTES),f=Ot({id:c,pairingTopic:t,expiry:h},o);await this.setProposal(c,f);const y=tu(JSON.stringify(s)),d=await this.getVerifyContext(y,f.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:f,verifyContext:d})}catch(h){await this.sendError(c,t,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(t,s)=>{const{id:o}=s;if(oi(s)){const{result:c}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const h=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const f=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:f});const y=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:y});const d=await this.client.core.crypto.generateSharedKey(f,y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const m=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:t})}else fr(s)&&(await this.client.proposal.delete(o,zt("USER_DISCONNECTED")),this.events.emit(at("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(t,s)=>{const{id:o,params:c}=s;try{this.isValidSessionSettleRequest(c);const{relay:h,controller:f,expiry:y,namespaces:d,requiredNamespaces:m,optionalNamespaces:b,sessionProperties:E,pairingTopic:A}=s.params,x=Ot({topic:t,relay:h,expiry:y,namespaces:d,acknowledged:!0,pairingTopic:A,requiredNamespaces:m,optionalNamespaces:b,controller:f.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:f.publicKey,metadata:f.metadata}},E&&{sessionProperties:E});await this.sendResult({id:s.id,topic:t,result:!0}),this.events.emit(at("session_connect"),{session:x}),this.cleanupDuplicatePairings(x)}catch(h){await this.sendError(o,t,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(t,s)=>{const{id:o}=s;oi(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(at("session_approve",o),{})):fr(s)&&(await this.client.session.delete(t,zt("USER_DISCONNECTED")),this.events.emit(at("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(t,s)=>{const{params:o,id:c}=s;try{const h=`${t}_session_update`,f=No.get(h);if(f&&this.isRequestOutOfSync(f,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(Ot({topic:t},o)),await this.client.session.update(t,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:t,result:!0}),this.client.events.emit("session_update",{id:c,topic:t,params:o}),No.set(h,c)}catch(h){await this.sendError(c,t,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(t,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,s)=>{const{id:o}=s;oi(s)?this.events.emit(at("session_update",o),{}):fr(s)&&this.events.emit(at("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(t,s)=>{const{id:o}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Oi(Co)),await this.sendResult({id:o,topic:t,result:!0}),this.client.events.emit("session_extend",{id:o,topic:t})}catch(c){await this.sendError(o,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,s)=>{const{id:o}=s;oi(s)?this.events.emit(at("session_extend",o),{}):fr(s)&&this.events.emit(at("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(t,s)=>{const{id:o}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:o,topic:t,result:!0}),this.client.events.emit("session_ping",{id:o,topic:t})}catch(c){await this.sendError(o,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,s)=>{const{id:o}=s;setTimeout(()=>{oi(s)?this.events.emit(at("session_ping",o),{}):fr(s)&&this.events.emit(at("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(t,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(pt.publish,async()=>{c(await this.deleteSession(t))})}),this.sendResult({id:o,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:t})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(t,s)=>{const{id:o,params:c}=s;try{this.isValidRequest(Ot({topic:t},c));const h=tu(JSON.stringify(Ri("wc_sessionRequest",c,o))),f=this.client.session.get(t),y=await this.getVerifyContext(h,f.peer.metadata),d={id:o,topic:t,params:c,verifyContext:y};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(h){await this.sendError(o,t,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(t,s)=>{const{id:o}=s;oi(s)?this.events.emit(at("session_request",o),{result:s.result}):fr(s)&&this.events.emit(at("session_request",o),{error:s.error})},this.onSessionEventRequest=async(t,s)=>{const{id:o,params:c}=s;try{const h=`${t}_session_event_${c.event.name}`,f=No.get(h);if(f&&this.isRequestOutOfSync(f,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(Ot({topic:t},c)),this.client.events.emit("session_event",{id:o,topic:t,params:c}),No.set(h,o)}catch(h){await this.sendError(o,t,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=kr.idle,this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===kr.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=kr.active,this.client.events.emit("session_request",t)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=t=>{if(t.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===t.topic);s&&this.onSessionProposeRequest(t.topic,Ri("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async t=>{if(!hr(t)){const{message:y}=oe("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(y)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:h,relays:f}=t;if(tr(s)||await this.isValidPairingTopic(s),!_O(f)){const{message:y}=oe("MISSING_OR_INVALID",`connect() relays: ${f}`);throw new Error(y)}!tr(o)&&os(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!tr(c)&&os(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),tr(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(t,s)=>{const o=bO(t,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async t=>{if(!hr(t))throw new Error(oe("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:s,namespaces:o,relayProtocol:c,sessionProperties:h}=t;await this.isValidProposalId(s);const f=this.client.proposal.get(s),y=Mo(o,"approve()");if(y)throw new Error(y.message);const d=yp(f.requiredNamespaces,o,"approve()");if(d)throw new Error(d.message);if(!dt(c,!0)){const{message:m}=oe("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(m)}tr(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async t=>{if(!hr(t)){const{message:c}=oe("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:s,reason:o}=t;if(await this.isValidProposalId(s),!IO(o)){const{message:c}=oe("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!hr(t)){const{message:d}=oe("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(d)}const{relay:s,controller:o,namespaces:c,expiry:h}=t;if(!Wd(s)){const{message:d}=oe("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const f=dO(o,"onSessionSettleRequest()");if(f)throw new Error(f.message);const y=Mo(c,"onSessionSettleRequest()");if(y)throw new Error(y.message);if(pn(h)){const{message:d}=oe("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async t=>{if(!hr(t)){const{message:y}=oe("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(y)}const{topic:s,namespaces:o}=t;await this.isValidSessionTopic(s);const c=this.client.session.get(s),h=Mo(o,"update()");if(h)throw new Error(h.message);const f=yp(c.requiredNamespaces,o,"update()");if(f)throw new Error(f.message)},this.isValidExtend=async t=>{if(!hr(t)){const{message:o}=oe("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(o)}const{topic:s}=t;await this.isValidSessionTopic(s)},this.isValidRequest=async t=>{if(!hr(t)){const{message:y}=oe("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(y)}const{topic:s,request:o,chainId:c,expiry:h}=t;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!gp(f,c)){const{message:y}=oe("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(y)}if(!SO(o)){const{message:y}=oe("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(y)}if(!OO(f,c,o.method)){const{message:y}=oe("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(y)}if(h&&!TO(h,nu)){const{message:y}=oe("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${nu.min} and ${nu.max}`);throw new Error(y)}},this.isValidRespond=async t=>{if(!hr(t)){const{message:c}=oe("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:s,response:o}=t;if(await this.isValidSessionTopic(s),!PO(o)){const{message:c}=oe("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!hr(t)){const{message:o}=oe("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(o)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async t=>{if(!hr(t)){const{message:f}=oe("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(f)}const{topic:s,event:o,chainId:c}=t;await this.isValidSessionTopic(s);const{namespaces:h}=this.client.session.get(s);if(!gp(h,c)){const{message:f}=oe("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(f)}if(!xO(o)){const{message:f}=oe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(f)}if(!AO(h,c,o.name)){const{message:f}=oe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(f)}},this.isValidDisconnect=async t=>{if(!hr(t)){const{message:o}=oe("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(o)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(t,s)=>{const o={verified:{verifyUrl:s.verifyUrl||dn,validation:"UNKNOWN",origin:s.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:t,verifyUrl:s.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(t,s)=>{Object.values(t).forEach(o=>{if(!dt(o,!1)){const{message:c}=oe("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:e}=oe("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(pt.message,async e=>{const{topic:t,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(t,s);try{Du(o)?(this.client.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o})):hs(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o}),this.client.core.history.delete(t,o.id)):this.onRelayEventUnknownPayload({topic:t,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(er.expired,async e=>{const{topic:t,id:s}=iO(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,oe("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(is.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!dt(e,!1)){const{message:t}=oe("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(pn(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=oe("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!dt(e,!1)){const{message:t}=oe("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=oe("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(pn(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=oe("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(dt(e,!1)){const{message:t}=oe("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=oe("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!EO(e)){const{message:t}=oe("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=oe("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(pn(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=oe("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class kO extends ra{constructor(e,t){super(e,t,NO,Zu),this.core=e,this.logger=t}}class HO extends ra{constructor(e,t){super(e,t,CO,Zu),this.core=e,this.logger=t}}class VO extends ra{constructor(e,t){super(e,t,UO,Zu,s=>s.id),this.core=e,this.logger=t}}let KO=class Xd extends T_{constructor(e){super(e),this.protocol=Qd,this.version=Jd,this.name=iu.name,this.events=new dr.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||iu.name,this.metadata=(e==null?void 0:e.metadata)||rO();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Jo(Zo({level:(e==null?void 0:e.logger)||iu.logger}));this.core=(e==null?void 0:e.core)||new Qx(e),this.logger=Bt(t,this.name),this.session=new HO(this.core,this.logger),this.proposal=new kO(this.core,this.logger),this.pendingRequest=new VO(this.core,this.logger),this.engine=new BO(this)}static async init(e){const t=new Xd(e);return await t.initialize(),t}get context(){return $t(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const GO=":";function WO(n){const[e,t]=n.split(GO);return{namespace:e,reference:t}}function su(n=[],e=[]){return[...new Set([...n,...e])]}function Yu(n){return n.includes(":")}function ns(n){return Yu(n)?n.split(":")[0]:n}const QO={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function _p(n,e){const{message:t,code:s}=QO[n];return{message:e?`${t} ${e}`:t,code:s}}function Ep(n,e){return!!Array.isArray(n)}function JO(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}class hi extends Lp{constructor(e){super(e),this.events=new dr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Ri(e.method,e.params||[],e.id||Nu().toString()),t)}async requestStrict(e,t){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${e.id}`,c=>{fr(c)?o(c.error):s(c.result)});try{await this.connection.send(e,t)}catch(c){o(c)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),hs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Ip="error",ZO="wss://relay.walletconnect.com",YO="wc",XO="universal_provider",Sp=`${YO}@2:${XO}:`,eA="https://rpc.walletconnect.com/v1/",Hr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$u={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,e){(function(){var t,s="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",f="Invalid `variable` option passed into `_.template`",y="__lodash_hash_undefined__",d=500,m="__lodash_placeholder__",b=1,E=2,A=4,x=1,T=2,k=1,V=2,re=4,U=8,H=16,ee=32,R=64,q=128,L=256,Y=512,ae=30,we="...",Pe=800,We=16,ie=1,Q=2,j=3,G=1/0,Z=9007199254740991,ye=17976931348623157e292,J=NaN,ce=4294967295,Oe=ce-1,be=ce>>>1,Ae=[["ary",q],["bind",k],["bindKey",V],["curry",U],["curryRight",H],["flip",Y],["partial",ee],["partialRight",R],["rearg",L]],X="[object Arguments]",Ie="[object Array]",Rt="[object AsyncFunction]",Fe="[object Boolean]",ke="[object Date]",Tt="[object DOMException]",gt="[object Error]",Nt="[object Function]",Vr="[object GeneratorFunction]",nt="[object Map]",Pr="[object Number]",wn="[object Null]",Ct="[object Object]",Ui="[object Promise]",Fi="[object Proxy]",gr="[object RegExp]",st="[object Set]",yr="[object String]",xr="[object Symbol]",qi="[object Undefined]",mr="[object WeakMap]",ji="[object WeakSet]",kt="[object ArrayBuffer]",Ht="[object DataView]",Kr="[object Float32Array]",ht="[object Float64Array]",Li="[object Int8Array]",zi="[object Int16Array]",bn="[object Int32Array]",Mi="[object Uint8Array]",Gr="[object Uint8ClampedArray]",Bi="[object Uint16Array]",ki="[object Uint32Array]",na=/\b__p \+= '';/g,Or=/\b(__p \+=) '' \+/g,ms=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vs=/&(?:amp|lt|gt|quot|#39);/g,ws=/[&<>"']/g,_n=RegExp(vs.source),li=RegExp(ws.source),En=/<%-([\s\S]+?)%>/g,In=/<%([\s\S]+?)%>/g,Hi=/<%=([\s\S]+?)%>/g,fi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sa=/^\w*$/,oa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Sn=/[\\^$.*+?()[\]{}|]/g,aa=RegExp(Sn.source),Pn=/^\s+/,bs=/\s/,xn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ar=/\{\n\/\* \[wrapped with (.+)\] \*/,ca=/,? & /,ua=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ha=/[()=,{}\[\]\/\s]/,la=/\\(\\)?/g,fa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Vt=/\w*$/,pa=/^[-+]0x[0-9a-f]+$/i,da=/^0b[01]+$/i,ga=/^\[object .+?Constructor\]$/,ya=/^0o[0-7]+$/i,ma=/^(?:0|[1-9]\d*)$/,$r=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Vi=/($^)/,va=/['\n\r\u2028\u2029\\]/g,Ki="\\ud800-\\udfff",wa="\\u0300-\\u036f",ba="\\ufe20-\\ufe2f",Gi="\\u20d0-\\u20ff",_s=wa+ba+Gi,Es="\\u2700-\\u27bf",ir="a-z\\xdf-\\xf6\\xf8-\\xff",_a="\\xac\\xb1\\xd7\\xf7",Ea="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ia="\\u2000-\\u206f",Sa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Is="A-Z\\xc0-\\xd6\\xd8-\\xde",Ss="\\ufe0e\\ufe0f",pi=_a+Ea+Ia+Sa,On="[']",di="["+Ki+"]",An="["+pi+"]",gi="["+_s+"]",Ps="\\d+",Pa="["+Es+"]",xs="["+ir+"]",Os="[^"+Ki+pi+Ps+Es+ir+Is+"]",Wi="\\ud83c[\\udffb-\\udfff]",xa="(?:"+gi+"|"+Wi+")",As="[^"+Ki+"]",Qi="(?:\\ud83c[\\udde6-\\uddff]){2}",Wr="[\\ud800-\\udbff][\\udc00-\\udfff]",Dt="["+Is+"]",$s="\\u200d",Rs="(?:"+xs+"|"+Os+")",vr="(?:"+Dt+"|"+Os+")",Ts="(?:"+On+"(?:d|ll|m|re|s|t|ve))?",Ns="(?:"+On+"(?:D|LL|M|RE|S|T|VE))?",Cs=xa+"?",Ds="["+Ss+"]?",Oa="(?:"+$s+"(?:"+[As,Qi,Wr].join("|")+")"+Ds+Cs+")*",Rr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Us="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Fs=Ds+Cs+Oa,Ji="(?:"+[Pa,Qi,Wr].join("|")+")"+Fs,Aa="(?:"+[As+gi+"?",gi,Qi,Wr,di].join("|")+")",$n=RegExp(On,"g"),$a=RegExp(gi,"g"),Zi=RegExp(Wi+"(?="+Wi+")|"+Aa+Fs,"g"),qs=RegExp([Dt+"?"+xs+"+"+Ts+"(?="+[An,Dt,"$"].join("|")+")",vr+"+"+Ns+"(?="+[An,Dt+Rs,"$"].join("|")+")",Dt+"?"+Rs+"+"+Ts,Dt+"+"+Ns,Us,Rr,Ps,Ji].join("|"),"g"),js=RegExp("["+$s+Ki+_s+Ss+"]"),yi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ls=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ra=-1,Ne={};Ne[Kr]=Ne[ht]=Ne[Li]=Ne[zi]=Ne[bn]=Ne[Mi]=Ne[Gr]=Ne[Bi]=Ne[ki]=!0,Ne[X]=Ne[Ie]=Ne[kt]=Ne[Fe]=Ne[Ht]=Ne[ke]=Ne[gt]=Ne[Nt]=Ne[nt]=Ne[Pr]=Ne[Ct]=Ne[gr]=Ne[st]=Ne[yr]=Ne[mr]=!1;var Re={};Re[X]=Re[Ie]=Re[kt]=Re[Ht]=Re[Fe]=Re[ke]=Re[Kr]=Re[ht]=Re[Li]=Re[zi]=Re[bn]=Re[nt]=Re[Pr]=Re[Ct]=Re[gr]=Re[st]=Re[yr]=Re[xr]=Re[Mi]=Re[Gr]=Re[Bi]=Re[ki]=!0,Re[gt]=Re[Nt]=Re[mr]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},D={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},M={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ce=parseFloat,he=parseInt,qe=typeof es=="object"&&es&&es.Object===Object&&es,Qe=typeof self=="object"&&self&&self.Object===Object&&self,_e=qe||Qe||Function("return this")(),De=e&&!e.nodeType&&e,He=De&&!0&&n&&!n.nodeType&&n,_t=He&&He.exports===De,Je=_t&&qe.process,je=function(){try{var S=He&&He.require&&He.require("util").types;return S||Je&&Je.binding&&Je.binding("util")}catch{}}(),yt=je&&je.isArrayBuffer,nr=je&&je.isDate,Kt=je&&je.isMap,wr=je&&je.isRegExp,Rn=je&&je.isSet,mi=je&&je.isTypedArray;function et(S,$,O){switch(O.length){case 0:return S.call($);case 1:return S.call($,O[0]);case 2:return S.call($,O[0],O[1]);case 3:return S.call($,O[0],O[1],O[2])}return S.apply($,O)}function rg(S,$,O,B){for(var ue=-1,Se=S==null?0:S.length;++ue<Se;){var Ze=S[ue];$(B,Ze,O(Ze),S)}return B}function Gt(S,$){for(var O=-1,B=S==null?0:S.length;++O<B&&$(S[O],O,S)!==!1;);return S}function ig(S,$){for(var O=S==null?0:S.length;O--&&$(S[O],O,S)!==!1;);return S}function th(S,$){for(var O=-1,B=S==null?0:S.length;++O<B;)if(!$(S[O],O,S))return!1;return!0}function Qr(S,$){for(var O=-1,B=S==null?0:S.length,ue=0,Se=[];++O<B;){var Ze=S[O];$(Ze,O,S)&&(Se[ue++]=Ze)}return Se}function zs(S,$){var O=S==null?0:S.length;return!!O&&Yi(S,$,0)>-1}function Ta(S,$,O){for(var B=-1,ue=S==null?0:S.length;++B<ue;)if(O($,S[B]))return!0;return!1}function Le(S,$){for(var O=-1,B=S==null?0:S.length,ue=Array(B);++O<B;)ue[O]=$(S[O],O,S);return ue}function Jr(S,$){for(var O=-1,B=$.length,ue=S.length;++O<B;)S[ue+O]=$[O];return S}function Na(S,$,O,B){var ue=-1,Se=S==null?0:S.length;for(B&&Se&&(O=S[++ue]);++ue<Se;)O=$(O,S[ue],ue,S);return O}function ng(S,$,O,B){var ue=S==null?0:S.length;for(B&&ue&&(O=S[--ue]);ue--;)O=$(O,S[ue],ue,S);return O}function Ca(S,$){for(var O=-1,B=S==null?0:S.length;++O<B;)if($(S[O],O,S))return!0;return!1}var sg=Da("length");function og(S){return S.split("")}function ag(S){return S.match(ua)||[]}function rh(S,$,O){var B;return O(S,function(ue,Se,Ze){if($(ue,Se,Ze))return B=Se,!1}),B}function Ms(S,$,O,B){for(var ue=S.length,Se=O+(B?1:-1);B?Se--:++Se<ue;)if($(S[Se],Se,S))return Se;return-1}function Yi(S,$,O){return $===$?wg(S,$,O):Ms(S,ih,O)}function cg(S,$,O,B){for(var ue=O-1,Se=S.length;++ue<Se;)if(B(S[ue],$))return ue;return-1}function ih(S){return S!==S}function nh(S,$){var O=S==null?0:S.length;return O?Fa(S,$)/O:J}function Da(S){return function($){return $==null?t:$[S]}}function Ua(S){return function($){return S==null?t:S[$]}}function sh(S,$,O,B,ue){return ue(S,function(Se,Ze,Ue){O=B?(B=!1,Se):$(O,Se,Ze,Ue)}),O}function ug(S,$){var O=S.length;for(S.sort($);O--;)S[O]=S[O].value;return S}function Fa(S,$){for(var O,B=-1,ue=S.length;++B<ue;){var Se=$(S[B]);Se!==t&&(O=O===t?Se:O+Se)}return O}function qa(S,$){for(var O=-1,B=Array(S);++O<S;)B[O]=$(O);return B}function hg(S,$){return Le($,function(O){return[O,S[O]]})}function oh(S){return S&&S.slice(0,hh(S)+1).replace(Pn,"")}function Ut(S){return function($){return S($)}}function ja(S,$){return Le($,function(O){return S[O]})}function Tn(S,$){return S.has($)}function ah(S,$){for(var O=-1,B=S.length;++O<B&&Yi($,S[O],0)>-1;);return O}function ch(S,$){for(var O=S.length;O--&&Yi($,S[O],0)>-1;);return O}function lg(S,$){for(var O=S.length,B=0;O--;)S[O]===$&&++B;return B}var fg=Ua(v),pg=Ua(I);function dg(S){return"\\"+M[S]}function gg(S,$){return S==null?t:S[$]}function Xi(S){return js.test(S)}function yg(S){return yi.test(S)}function mg(S){for(var $,O=[];!($=S.next()).done;)O.push($.value);return O}function La(S){var $=-1,O=Array(S.size);return S.forEach(function(B,ue){O[++$]=[ue,B]}),O}function uh(S,$){return function(O){return S($(O))}}function Zr(S,$){for(var O=-1,B=S.length,ue=0,Se=[];++O<B;){var Ze=S[O];(Ze===$||Ze===m)&&(S[O]=m,Se[ue++]=O)}return Se}function Bs(S){var $=-1,O=Array(S.size);return S.forEach(function(B){O[++$]=B}),O}function vg(S){var $=-1,O=Array(S.size);return S.forEach(function(B){O[++$]=[B,B]}),O}function wg(S,$,O){for(var B=O-1,ue=S.length;++B<ue;)if(S[B]===$)return B;return-1}function bg(S,$,O){for(var B=O+1;B--;)if(S[B]===$)return B;return B}function en(S){return Xi(S)?Eg(S):sg(S)}function sr(S){return Xi(S)?Ig(S):og(S)}function hh(S){for(var $=S.length;$--&&bs.test(S.charAt($)););return $}var _g=Ua(D);function Eg(S){for(var $=Zi.lastIndex=0;Zi.test(S);)++$;return $}function Ig(S){return S.match(Zi)||[]}function Sg(S){return S.match(qs)||[]}var Pg=function S($){$=$==null?_e:tn.defaults(_e.Object(),$,tn.pick(_e,Ls));var O=$.Array,B=$.Date,ue=$.Error,Se=$.Function,Ze=$.Math,Ue=$.Object,za=$.RegExp,xg=$.String,Wt=$.TypeError,ks=O.prototype,Og=Se.prototype,rn=Ue.prototype,Hs=$["__core-js_shared__"],Vs=Og.toString,$e=rn.hasOwnProperty,Ag=0,lh=function(){var r=/[^.]+$/.exec(Hs&&Hs.keys&&Hs.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Ks=rn.toString,$g=Vs.call(Ue),Rg=_e._,Tg=za("^"+Vs.call($e).replace(Sn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gs=_t?$.Buffer:t,Yr=$.Symbol,Ws=$.Uint8Array,fh=Gs?Gs.allocUnsafe:t,Qs=uh(Ue.getPrototypeOf,Ue),ph=Ue.create,dh=rn.propertyIsEnumerable,Js=ks.splice,gh=Yr?Yr.isConcatSpreadable:t,Nn=Yr?Yr.iterator:t,vi=Yr?Yr.toStringTag:t,Zs=function(){try{var r=Ii(Ue,"defineProperty");return r({},"",{}),r}catch{}}(),Ng=$.clearTimeout!==_e.clearTimeout&&$.clearTimeout,Cg=B&&B.now!==_e.Date.now&&B.now,Dg=$.setTimeout!==_e.setTimeout&&$.setTimeout,Ys=Ze.ceil,Xs=Ze.floor,Ma=Ue.getOwnPropertySymbols,Ug=Gs?Gs.isBuffer:t,yh=$.isFinite,Fg=ks.join,qg=uh(Ue.keys,Ue),Ye=Ze.max,lt=Ze.min,jg=B.now,Lg=$.parseInt,mh=Ze.random,zg=ks.reverse,Ba=Ii($,"DataView"),Cn=Ii($,"Map"),ka=Ii($,"Promise"),nn=Ii($,"Set"),Dn=Ii($,"WeakMap"),Un=Ii(Ue,"create"),eo=Dn&&new Dn,sn={},Mg=Si(Ba),Bg=Si(Cn),kg=Si(ka),Hg=Si(nn),Vg=Si(Dn),to=Yr?Yr.prototype:t,Fn=to?to.valueOf:t,vh=to?to.toString:t;function p(r){if(Be(r)&&!le(r)&&!(r instanceof ve)){if(r instanceof Qt)return r;if($e.call(r,"__wrapped__"))return wl(r)}return new Qt(r)}var on=function(){function r(){}return function(i){if(!Me(i))return{};if(ph)return ph(i);r.prototype=i;var a=new r;return r.prototype=t,a}}();function ro(){}function Qt(r,i){this.__wrapped__=r,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}p.templateSettings={escape:En,evaluate:In,interpolate:Hi,variable:"",imports:{_:p}},p.prototype=ro.prototype,p.prototype.constructor=p,Qt.prototype=on(ro.prototype),Qt.prototype.constructor=Qt;function ve(r){this.__wrapped__=r,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ce,this.__views__=[]}function Kg(){var r=new ve(this.__wrapped__);return r.__actions__=Et(this.__actions__),r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=Et(this.__iteratees__),r.__takeCount__=this.__takeCount__,r.__views__=Et(this.__views__),r}function Gg(){if(this.__filtered__){var r=new ve(this);r.__dir__=-1,r.__filtered__=!0}else r=this.clone(),r.__dir__*=-1;return r}function Wg(){var r=this.__wrapped__.value(),i=this.__dir__,a=le(r),u=i<0,l=a?r.length:0,g=om(0,l,this.__views__),w=g.start,_=g.end,P=_-w,N=u?_:w-1,C=this.__iteratees__,F=C.length,z=0,W=lt(P,this.__takeCount__);if(!a||!u&&l==P&&W==P)return Bh(r,this.__actions__);var ne=[];e:for(;P--&&z<W;){N+=i;for(var pe=-1,se=r[N];++pe<F;){var me=C[pe],Ee=me.iteratee,jt=me.type,wt=Ee(se);if(jt==Q)se=wt;else if(!wt){if(jt==ie)continue e;break e}}ne[z++]=se}return ne}ve.prototype=on(ro.prototype),ve.prototype.constructor=ve;function wi(r){var i=-1,a=r==null?0:r.length;for(this.clear();++i<a;){var u=r[i];this.set(u[0],u[1])}}function Qg(){this.__data__=Un?Un(null):{},this.size=0}function Jg(r){var i=this.has(r)&&delete this.__data__[r];return this.size-=i?1:0,i}function Zg(r){var i=this.__data__;if(Un){var a=i[r];return a===y?t:a}return $e.call(i,r)?i[r]:t}function Yg(r){var i=this.__data__;return Un?i[r]!==t:$e.call(i,r)}function Xg(r,i){var a=this.__data__;return this.size+=this.has(r)?0:1,a[r]=Un&&i===t?y:i,this}wi.prototype.clear=Qg,wi.prototype.delete=Jg,wi.prototype.get=Zg,wi.prototype.has=Yg,wi.prototype.set=Xg;function Tr(r){var i=-1,a=r==null?0:r.length;for(this.clear();++i<a;){var u=r[i];this.set(u[0],u[1])}}function ey(){this.__data__=[],this.size=0}function ty(r){var i=this.__data__,a=io(i,r);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Js.call(i,a,1),--this.size,!0}function ry(r){var i=this.__data__,a=io(i,r);return a<0?t:i[a][1]}function iy(r){return io(this.__data__,r)>-1}function ny(r,i){var a=this.__data__,u=io(a,r);return u<0?(++this.size,a.push([r,i])):a[u][1]=i,this}Tr.prototype.clear=ey,Tr.prototype.delete=ty,Tr.prototype.get=ry,Tr.prototype.has=iy,Tr.prototype.set=ny;function Nr(r){var i=-1,a=r==null?0:r.length;for(this.clear();++i<a;){var u=r[i];this.set(u[0],u[1])}}function sy(){this.size=0,this.__data__={hash:new wi,map:new(Cn||Tr),string:new wi}}function oy(r){var i=yo(this,r).delete(r);return this.size-=i?1:0,i}function ay(r){return yo(this,r).get(r)}function cy(r){return yo(this,r).has(r)}function uy(r,i){var a=yo(this,r),u=a.size;return a.set(r,i),this.size+=a.size==u?0:1,this}Nr.prototype.clear=sy,Nr.prototype.delete=oy,Nr.prototype.get=ay,Nr.prototype.has=cy,Nr.prototype.set=uy;function bi(r){var i=-1,a=r==null?0:r.length;for(this.__data__=new Nr;++i<a;)this.add(r[i])}function hy(r){return this.__data__.set(r,y),this}function ly(r){return this.__data__.has(r)}bi.prototype.add=bi.prototype.push=hy,bi.prototype.has=ly;function or(r){var i=this.__data__=new Tr(r);this.size=i.size}function fy(){this.__data__=new Tr,this.size=0}function py(r){var i=this.__data__,a=i.delete(r);return this.size=i.size,a}function dy(r){return this.__data__.get(r)}function gy(r){return this.__data__.has(r)}function yy(r,i){var a=this.__data__;if(a instanceof Tr){var u=a.__data__;if(!Cn||u.length<o-1)return u.push([r,i]),this.size=++a.size,this;a=this.__data__=new Nr(u)}return a.set(r,i),this.size=a.size,this}or.prototype.clear=fy,or.prototype.delete=py,or.prototype.get=dy,or.prototype.has=gy,or.prototype.set=yy;function wh(r,i){var a=le(r),u=!a&&Pi(r),l=!a&&!u&&ii(r),g=!a&&!u&&!l&&hn(r),w=a||u||l||g,_=w?qa(r.length,xg):[],P=_.length;for(var N in r)(i||$e.call(r,N))&&!(w&&(N=="length"||l&&(N=="offset"||N=="parent")||g&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Fr(N,P)))&&_.push(N);return _}function bh(r){var i=r.length;return i?r[ec(0,i-1)]:t}function my(r,i){return mo(Et(r),_i(i,0,r.length))}function vy(r){return mo(Et(r))}function Ha(r,i,a){(a!==t&&!ar(r[i],a)||a===t&&!(i in r))&&Cr(r,i,a)}function qn(r,i,a){var u=r[i];(!($e.call(r,i)&&ar(u,a))||a===t&&!(i in r))&&Cr(r,i,a)}function io(r,i){for(var a=r.length;a--;)if(ar(r[a][0],i))return a;return-1}function wy(r,i,a,u){return Xr(r,function(l,g,w){i(u,l,a(l),w)}),u}function _h(r,i){return r&&_r(i,tt(i),r)}function by(r,i){return r&&_r(i,St(i),r)}function Cr(r,i,a){i=="__proto__"&&Zs?Zs(r,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[i]=a}function Va(r,i){for(var a=-1,u=i.length,l=O(u),g=r==null;++a<u;)l[a]=g?t:Pc(r,i[a]);return l}function _i(r,i,a){return r===r&&(a!==t&&(r=r<=a?r:a),i!==t&&(r=r>=i?r:i)),r}function Jt(r,i,a,u,l,g){var w,_=i&b,P=i&E,N=i&A;if(a&&(w=l?a(r,u,l,g):a(r)),w!==t)return w;if(!Me(r))return r;var C=le(r);if(C){if(w=cm(r),!_)return Et(r,w)}else{var F=ft(r),z=F==Nt||F==Vr;if(ii(r))return Vh(r,_);if(F==Ct||F==X||z&&!l){if(w=P||z?{}:hl(r),!_)return P?Zy(r,by(w,r)):Jy(r,_h(w,r))}else{if(!Re[F])return l?r:{};w=um(r,F,_)}}g||(g=new or);var W=g.get(r);if(W)return W;g.set(r,w),Ll(r)?r.forEach(function(se){w.add(Jt(se,i,a,se,r,g))}):ql(r)&&r.forEach(function(se,me){w.set(me,Jt(se,i,a,me,r,g))});var ne=N?P?lc:hc:P?St:tt,pe=C?t:ne(r);return Gt(pe||r,function(se,me){pe&&(me=se,se=r[me]),qn(w,me,Jt(se,i,a,me,r,g))}),w}function _y(r){var i=tt(r);return function(a){return Eh(a,r,i)}}function Eh(r,i,a){var u=a.length;if(r==null)return!u;for(r=Ue(r);u--;){var l=a[u],g=i[l],w=r[l];if(w===t&&!(l in r)||!g(w))return!1}return!0}function Ih(r,i,a){if(typeof r!="function")throw new Wt(h);return Hn(function(){r.apply(t,a)},i)}function jn(r,i,a,u){var l=-1,g=zs,w=!0,_=r.length,P=[],N=i.length;if(!_)return P;a&&(i=Le(i,Ut(a))),u?(g=Ta,w=!1):i.length>=o&&(g=Tn,w=!1,i=new bi(i));e:for(;++l<_;){var C=r[l],F=a==null?C:a(C);if(C=u||C!==0?C:0,w&&F===F){for(var z=N;z--;)if(i[z]===F)continue e;P.push(C)}else g(i,F,u)||P.push(C)}return P}var Xr=Jh(br),Sh=Jh(Ga,!0);function Ey(r,i){var a=!0;return Xr(r,function(u,l,g){return a=!!i(u,l,g),a}),a}function no(r,i,a){for(var u=-1,l=r.length;++u<l;){var g=r[u],w=i(g);if(w!=null&&(_===t?w===w&&!qt(w):a(w,_)))var _=w,P=g}return P}function Iy(r,i,a,u){var l=r.length;for(a=fe(a),a<0&&(a=-a>l?0:l+a),u=u===t||u>l?l:fe(u),u<0&&(u+=l),u=a>u?0:Ml(u);a<u;)r[a++]=i;return r}function Ph(r,i){var a=[];return Xr(r,function(u,l,g){i(u,l,g)&&a.push(u)}),a}function ot(r,i,a,u,l){var g=-1,w=r.length;for(a||(a=lm),l||(l=[]);++g<w;){var _=r[g];i>0&&a(_)?i>1?ot(_,i-1,a,u,l):Jr(l,_):u||(l[l.length]=_)}return l}var Ka=Zh(),xh=Zh(!0);function br(r,i){return r&&Ka(r,i,tt)}function Ga(r,i){return r&&xh(r,i,tt)}function so(r,i){return Qr(i,function(a){return qr(r[a])})}function Ei(r,i){i=ti(i,r);for(var a=0,u=i.length;r!=null&&a<u;)r=r[Er(i[a++])];return a&&a==u?r:t}function Oh(r,i,a){var u=i(r);return le(r)?u:Jr(u,a(r))}function mt(r){return r==null?r===t?qi:wn:vi&&vi in Ue(r)?sm(r):vm(r)}function Wa(r,i){return r>i}function Sy(r,i){return r!=null&&$e.call(r,i)}function Py(r,i){return r!=null&&i in Ue(r)}function xy(r,i,a){return r>=lt(i,a)&&r<Ye(i,a)}function Qa(r,i,a){for(var u=a?Ta:zs,l=r[0].length,g=r.length,w=g,_=O(g),P=1/0,N=[];w--;){var C=r[w];w&&i&&(C=Le(C,Ut(i))),P=lt(C.length,P),_[w]=!a&&(i||l>=120&&C.length>=120)?new bi(w&&C):t}C=r[0];var F=-1,z=_[0];e:for(;++F<l&&N.length<P;){var W=C[F],ne=i?i(W):W;if(W=a||W!==0?W:0,!(z?Tn(z,ne):u(N,ne,a))){for(w=g;--w;){var pe=_[w];if(!(pe?Tn(pe,ne):u(r[w],ne,a)))continue e}z&&z.push(ne),N.push(W)}}return N}function Oy(r,i,a,u){return br(r,function(l,g,w){i(u,a(l),g,w)}),u}function Ln(r,i,a){i=ti(i,r),r=dl(r,i);var u=r==null?r:r[Er(Yt(i))];return u==null?t:et(u,r,a)}function Ah(r){return Be(r)&&mt(r)==X}function Ay(r){return Be(r)&&mt(r)==kt}function $y(r){return Be(r)&&mt(r)==ke}function zn(r,i,a,u,l){return r===i?!0:r==null||i==null||!Be(r)&&!Be(i)?r!==r&&i!==i:Ry(r,i,a,u,zn,l)}function Ry(r,i,a,u,l,g){var w=le(r),_=le(i),P=w?Ie:ft(r),N=_?Ie:ft(i);P=P==X?Ct:P,N=N==X?Ct:N;var C=P==Ct,F=N==Ct,z=P==N;if(z&&ii(r)){if(!ii(i))return!1;w=!0,C=!1}if(z&&!C)return g||(g=new or),w||hn(r)?al(r,i,a,u,l,g):im(r,i,P,a,u,l,g);if(!(a&x)){var W=C&&$e.call(r,"__wrapped__"),ne=F&&$e.call(i,"__wrapped__");if(W||ne){var pe=W?r.value():r,se=ne?i.value():i;return g||(g=new or),l(pe,se,a,u,g)}}return z?(g||(g=new or),nm(r,i,a,u,l,g)):!1}function Ty(r){return Be(r)&&ft(r)==nt}function Ja(r,i,a,u){var l=a.length,g=l,w=!u;if(r==null)return!g;for(r=Ue(r);l--;){var _=a[l];if(w&&_[2]?_[1]!==r[_[0]]:!(_[0]in r))return!1}for(;++l<g;){_=a[l];var P=_[0],N=r[P],C=_[1];if(w&&_[2]){if(N===t&&!(P in r))return!1}else{var F=new or;if(u)var z=u(N,C,P,r,i,F);if(!(z===t?zn(C,N,x|T,u,F):z))return!1}}return!0}function $h(r){if(!Me(r)||pm(r))return!1;var i=qr(r)?Tg:ga;return i.test(Si(r))}function Ny(r){return Be(r)&&mt(r)==gr}function Cy(r){return Be(r)&&ft(r)==st}function Dy(r){return Be(r)&&Io(r.length)&&!!Ne[mt(r)]}function Rh(r){return typeof r=="function"?r:r==null?Pt:typeof r=="object"?le(r)?Ch(r[0],r[1]):Nh(r):Yl(r)}function Za(r){if(!kn(r))return qg(r);var i=[];for(var a in Ue(r))$e.call(r,a)&&a!="constructor"&&i.push(a);return i}function Uy(r){if(!Me(r))return mm(r);var i=kn(r),a=[];for(var u in r)u=="constructor"&&(i||!$e.call(r,u))||a.push(u);return a}function Ya(r,i){return r<i}function Th(r,i){var a=-1,u=It(r)?O(r.length):[];return Xr(r,function(l,g,w){u[++a]=i(l,g,w)}),u}function Nh(r){var i=pc(r);return i.length==1&&i[0][2]?fl(i[0][0],i[0][1]):function(a){return a===r||Ja(a,r,i)}}function Ch(r,i){return gc(r)&&ll(i)?fl(Er(r),i):function(a){var u=Pc(a,r);return u===t&&u===i?xc(a,r):zn(i,u,x|T)}}function oo(r,i,a,u,l){r!==i&&Ka(i,function(g,w){if(l||(l=new or),Me(g))Fy(r,i,w,a,oo,u,l);else{var _=u?u(mc(r,w),g,w+"",r,i,l):t;_===t&&(_=g),Ha(r,w,_)}},St)}function Fy(r,i,a,u,l,g,w){var _=mc(r,a),P=mc(i,a),N=w.get(P);if(N){Ha(r,a,N);return}var C=g?g(_,P,a+"",r,i,w):t,F=C===t;if(F){var z=le(P),W=!z&&ii(P),ne=!z&&!W&&hn(P);C=P,z||W||ne?le(_)?C=_:Ve(_)?C=Et(_):W?(F=!1,C=Vh(P,!0)):ne?(F=!1,C=Kh(P,!0)):C=[]:Vn(P)||Pi(P)?(C=_,Pi(_)?C=Bl(_):(!Me(_)||qr(_))&&(C=hl(P))):F=!1}F&&(w.set(P,C),l(C,P,u,g,w),w.delete(P)),Ha(r,a,C)}function Dh(r,i){var a=r.length;if(a)return i+=i<0?a:0,Fr(i,a)?r[i]:t}function Uh(r,i,a){i.length?i=Le(i,function(g){return le(g)?function(w){return Ei(w,g.length===1?g[0]:g)}:g}):i=[Pt];var u=-1;i=Le(i,Ut(te()));var l=Th(r,function(g,w,_){var P=Le(i,function(N){return N(g)});return{criteria:P,index:++u,value:g}});return ug(l,function(g,w){return Qy(g,w,a)})}function qy(r,i){return Fh(r,i,function(a,u){return xc(r,u)})}function Fh(r,i,a){for(var u=-1,l=i.length,g={};++u<l;){var w=i[u],_=Ei(r,w);a(_,w)&&Mn(g,ti(w,r),_)}return g}function jy(r){return function(i){return Ei(i,r)}}function Xa(r,i,a,u){var l=u?cg:Yi,g=-1,w=i.length,_=r;for(r===i&&(i=Et(i)),a&&(_=Le(r,Ut(a)));++g<w;)for(var P=0,N=i[g],C=a?a(N):N;(P=l(_,C,P,u))>-1;)_!==r&&Js.call(_,P,1),Js.call(r,P,1);return r}function qh(r,i){for(var a=r?i.length:0,u=a-1;a--;){var l=i[a];if(a==u||l!==g){var g=l;Fr(l)?Js.call(r,l,1):ic(r,l)}}return r}function ec(r,i){return r+Xs(mh()*(i-r+1))}function Ly(r,i,a,u){for(var l=-1,g=Ye(Ys((i-r)/(a||1)),0),w=O(g);g--;)w[u?g:++l]=r,r+=a;return w}function tc(r,i){var a="";if(!r||i<1||i>Z)return a;do i%2&&(a+=r),i=Xs(i/2),i&&(r+=r);while(i);return a}function ge(r,i){return vc(pl(r,i,Pt),r+"")}function zy(r){return bh(ln(r))}function My(r,i){var a=ln(r);return mo(a,_i(i,0,a.length))}function Mn(r,i,a,u){if(!Me(r))return r;i=ti(i,r);for(var l=-1,g=i.length,w=g-1,_=r;_!=null&&++l<g;){var P=Er(i[l]),N=a;if(P==="__proto__"||P==="constructor"||P==="prototype")return r;if(l!=w){var C=_[P];N=u?u(C,P,_):t,N===t&&(N=Me(C)?C:Fr(i[l+1])?[]:{})}qn(_,P,N),_=_[P]}return r}var jh=eo?function(r,i){return eo.set(r,i),r}:Pt,By=Zs?function(r,i){return Zs(r,"toString",{configurable:!0,enumerable:!1,value:Ac(i),writable:!0})}:Pt;function ky(r){return mo(ln(r))}function Zt(r,i,a){var u=-1,l=r.length;i<0&&(i=-i>l?0:l+i),a=a>l?l:a,a<0&&(a+=l),l=i>a?0:a-i>>>0,i>>>=0;for(var g=O(l);++u<l;)g[u]=r[u+i];return g}function Hy(r,i){var a;return Xr(r,function(u,l,g){return a=i(u,l,g),!a}),!!a}function ao(r,i,a){var u=0,l=r==null?u:r.length;if(typeof i=="number"&&i===i&&l<=be){for(;u<l;){var g=u+l>>>1,w=r[g];w!==null&&!qt(w)&&(a?w<=i:w<i)?u=g+1:l=g}return l}return rc(r,i,Pt,a)}function rc(r,i,a,u){var l=0,g=r==null?0:r.length;if(g===0)return 0;i=a(i);for(var w=i!==i,_=i===null,P=qt(i),N=i===t;l<g;){var C=Xs((l+g)/2),F=a(r[C]),z=F!==t,W=F===null,ne=F===F,pe=qt(F);if(w)var se=u||ne;else N?se=ne&&(u||z):_?se=ne&&z&&(u||!W):P?se=ne&&z&&!W&&(u||!pe):W||pe?se=!1:se=u?F<=i:F<i;se?l=C+1:g=C}return lt(g,Oe)}function Lh(r,i){for(var a=-1,u=r.length,l=0,g=[];++a<u;){var w=r[a],_=i?i(w):w;if(!a||!ar(_,P)){var P=_;g[l++]=w===0?0:w}}return g}function zh(r){return typeof r=="number"?r:qt(r)?J:+r}function Ft(r){if(typeof r=="string")return r;if(le(r))return Le(r,Ft)+"";if(qt(r))return vh?vh.call(r):"";var i=r+"";return i=="0"&&1/r==-1/0?"-0":i}function ei(r,i,a){var u=-1,l=zs,g=r.length,w=!0,_=[],P=_;if(a)w=!1,l=Ta;else if(g>=o){var N=i?null:tm(r);if(N)return Bs(N);w=!1,l=Tn,P=new bi}else P=i?[]:_;e:for(;++u<g;){var C=r[u],F=i?i(C):C;if(C=a||C!==0?C:0,w&&F===F){for(var z=P.length;z--;)if(P[z]===F)continue e;i&&P.push(F),_.push(C)}else l(P,F,a)||(P!==_&&P.push(F),_.push(C))}return _}function ic(r,i){return i=ti(i,r),r=dl(r,i),r==null||delete r[Er(Yt(i))]}function Mh(r,i,a,u){return Mn(r,i,a(Ei(r,i)),u)}function co(r,i,a,u){for(var l=r.length,g=u?l:-1;(u?g--:++g<l)&&i(r[g],g,r););return a?Zt(r,u?0:g,u?g+1:l):Zt(r,u?g+1:0,u?l:g)}function Bh(r,i){var a=r;return a instanceof ve&&(a=a.value()),Na(i,function(u,l){return l.func.apply(l.thisArg,Jr([u],l.args))},a)}function nc(r,i,a){var u=r.length;if(u<2)return u?ei(r[0]):[];for(var l=-1,g=O(u);++l<u;)for(var w=r[l],_=-1;++_<u;)_!=l&&(g[l]=jn(g[l]||w,r[_],i,a));return ei(ot(g,1),i,a)}function kh(r,i,a){for(var u=-1,l=r.length,g=i.length,w={};++u<l;){var _=u<g?i[u]:t;a(w,r[u],_)}return w}function sc(r){return Ve(r)?r:[]}function oc(r){return typeof r=="function"?r:Pt}function ti(r,i){return le(r)?r:gc(r,i)?[r]:vl(xe(r))}var Vy=ge;function ri(r,i,a){var u=r.length;return a=a===t?u:a,!i&&a>=u?r:Zt(r,i,a)}var Hh=Ng||function(r){return _e.clearTimeout(r)};function Vh(r,i){if(i)return r.slice();var a=r.length,u=fh?fh(a):new r.constructor(a);return r.copy(u),u}function ac(r){var i=new r.constructor(r.byteLength);return new Ws(i).set(new Ws(r)),i}function Ky(r,i){var a=i?ac(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.byteLength)}function Gy(r){var i=new r.constructor(r.source,Vt.exec(r));return i.lastIndex=r.lastIndex,i}function Wy(r){return Fn?Ue(Fn.call(r)):{}}function Kh(r,i){var a=i?ac(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.length)}function Gh(r,i){if(r!==i){var a=r!==t,u=r===null,l=r===r,g=qt(r),w=i!==t,_=i===null,P=i===i,N=qt(i);if(!_&&!N&&!g&&r>i||g&&w&&P&&!_&&!N||u&&w&&P||!a&&P||!l)return 1;if(!u&&!g&&!N&&r<i||N&&a&&l&&!u&&!g||_&&a&&l||!w&&l||!P)return-1}return 0}function Qy(r,i,a){for(var u=-1,l=r.criteria,g=i.criteria,w=l.length,_=a.length;++u<w;){var P=Gh(l[u],g[u]);if(P){if(u>=_)return P;var N=a[u];return P*(N=="desc"?-1:1)}}return r.index-i.index}function Wh(r,i,a,u){for(var l=-1,g=r.length,w=a.length,_=-1,P=i.length,N=Ye(g-w,0),C=O(P+N),F=!u;++_<P;)C[_]=i[_];for(;++l<w;)(F||l<g)&&(C[a[l]]=r[l]);for(;N--;)C[_++]=r[l++];return C}function Qh(r,i,a,u){for(var l=-1,g=r.length,w=-1,_=a.length,P=-1,N=i.length,C=Ye(g-_,0),F=O(C+N),z=!u;++l<C;)F[l]=r[l];for(var W=l;++P<N;)F[W+P]=i[P];for(;++w<_;)(z||l<g)&&(F[W+a[w]]=r[l++]);return F}function Et(r,i){var a=-1,u=r.length;for(i||(i=O(u));++a<u;)i[a]=r[a];return i}function _r(r,i,a,u){var l=!a;a||(a={});for(var g=-1,w=i.length;++g<w;){var _=i[g],P=u?u(a[_],r[_],_,a,r):t;P===t&&(P=r[_]),l?Cr(a,_,P):qn(a,_,P)}return a}function Jy(r,i){return _r(r,dc(r),i)}function Zy(r,i){return _r(r,cl(r),i)}function uo(r,i){return function(a,u){var l=le(a)?rg:wy,g=i?i():{};return l(a,r,te(u,2),g)}}function an(r){return ge(function(i,a){var u=-1,l=a.length,g=l>1?a[l-1]:t,w=l>2?a[2]:t;for(g=r.length>3&&typeof g=="function"?(l--,g):t,w&&vt(a[0],a[1],w)&&(g=l<3?t:g,l=1),i=Ue(i);++u<l;){var _=a[u];_&&r(i,_,u,g)}return i})}function Jh(r,i){return function(a,u){if(a==null)return a;if(!It(a))return r(a,u);for(var l=a.length,g=i?l:-1,w=Ue(a);(i?g--:++g<l)&&u(w[g],g,w)!==!1;);return a}}function Zh(r){return function(i,a,u){for(var l=-1,g=Ue(i),w=u(i),_=w.length;_--;){var P=w[r?_:++l];if(a(g[P],P,g)===!1)break}return i}}function Yy(r,i,a){var u=i&k,l=Bn(r);function g(){var w=this&&this!==_e&&this instanceof g?l:r;return w.apply(u?a:this,arguments)}return g}function Yh(r){return function(i){i=xe(i);var a=Xi(i)?sr(i):t,u=a?a[0]:i.charAt(0),l=a?ri(a,1).join(""):i.slice(1);return u[r]()+l}}function cn(r){return function(i){return Na(Jl(Ql(i).replace($n,"")),r,"")}}function Bn(r){return function(){var i=arguments;switch(i.length){case 0:return new r;case 1:return new r(i[0]);case 2:return new r(i[0],i[1]);case 3:return new r(i[0],i[1],i[2]);case 4:return new r(i[0],i[1],i[2],i[3]);case 5:return new r(i[0],i[1],i[2],i[3],i[4]);case 6:return new r(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new r(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=on(r.prototype),u=r.apply(a,i);return Me(u)?u:a}}function Xy(r,i,a){var u=Bn(r);function l(){for(var g=arguments.length,w=O(g),_=g,P=un(l);_--;)w[_]=arguments[_];var N=g<3&&w[0]!==P&&w[g-1]!==P?[]:Zr(w,P);if(g-=N.length,g<a)return il(r,i,ho,l.placeholder,t,w,N,t,t,a-g);var C=this&&this!==_e&&this instanceof l?u:r;return et(C,this,w)}return l}function Xh(r){return function(i,a,u){var l=Ue(i);if(!It(i)){var g=te(a,3);i=tt(i),a=function(_){return g(l[_],_,l)}}var w=r(i,a,u);return w>-1?l[g?i[w]:w]:t}}function el(r){return Ur(function(i){var a=i.length,u=a,l=Qt.prototype.thru;for(r&&i.reverse();u--;){var g=i[u];if(typeof g!="function")throw new Wt(h);if(l&&!w&&go(g)=="wrapper")var w=new Qt([],!0)}for(u=w?u:a;++u<a;){g=i[u];var _=go(g),P=_=="wrapper"?fc(g):t;P&&yc(P[0])&&P[1]==(q|U|ee|L)&&!P[4].length&&P[9]==1?w=w[go(P[0])].apply(w,P[3]):w=g.length==1&&yc(g)?w[_]():w.thru(g)}return function(){var N=arguments,C=N[0];if(w&&N.length==1&&le(C))return w.plant(C).value();for(var F=0,z=a?i[F].apply(this,N):C;++F<a;)z=i[F].call(this,z);return z}})}function ho(r,i,a,u,l,g,w,_,P,N){var C=i&q,F=i&k,z=i&V,W=i&(U|H),ne=i&Y,pe=z?t:Bn(r);function se(){for(var me=arguments.length,Ee=O(me),jt=me;jt--;)Ee[jt]=arguments[jt];if(W)var wt=un(se),Lt=lg(Ee,wt);if(u&&(Ee=Wh(Ee,u,l,W)),g&&(Ee=Qh(Ee,g,w,W)),me-=Lt,W&&me<N){var Ke=Zr(Ee,wt);return il(r,i,ho,se.placeholder,a,Ee,Ke,_,P,N-me)}var cr=F?a:this,Lr=z?cr[r]:r;return me=Ee.length,_?Ee=wm(Ee,_):ne&&me>1&&Ee.reverse(),C&&P<me&&(Ee.length=P),this&&this!==_e&&this instanceof se&&(Lr=pe||Bn(Lr)),Lr.apply(cr,Ee)}return se}function tl(r,i){return function(a,u){return Oy(a,r,i(u),{})}}function lo(r,i){return function(a,u){var l;if(a===t&&u===t)return i;if(a!==t&&(l=a),u!==t){if(l===t)return u;typeof a=="string"||typeof u=="string"?(a=Ft(a),u=Ft(u)):(a=zh(a),u=zh(u)),l=r(a,u)}return l}}function cc(r){return Ur(function(i){return i=Le(i,Ut(te())),ge(function(a){var u=this;return r(i,function(l){return et(l,u,a)})})})}function fo(r,i){i=i===t?" ":Ft(i);var a=i.length;if(a<2)return a?tc(i,r):i;var u=tc(i,Ys(r/en(i)));return Xi(i)?ri(sr(u),0,r).join(""):u.slice(0,r)}function em(r,i,a,u){var l=i&k,g=Bn(r);function w(){for(var _=-1,P=arguments.length,N=-1,C=u.length,F=O(C+P),z=this&&this!==_e&&this instanceof w?g:r;++N<C;)F[N]=u[N];for(;P--;)F[N++]=arguments[++_];return et(z,l?a:this,F)}return w}function rl(r){return function(i,a,u){return u&&typeof u!="number"&&vt(i,a,u)&&(a=u=t),i=jr(i),a===t?(a=i,i=0):a=jr(a),u=u===t?i<a?1:-1:jr(u),Ly(i,a,u,r)}}function po(r){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Xt(i),a=Xt(a)),r(i,a)}}function il(r,i,a,u,l,g,w,_,P,N){var C=i&U,F=C?w:t,z=C?t:w,W=C?g:t,ne=C?t:g;i|=C?ee:R,i&=~(C?R:ee),i&re||(i&=-4);var pe=[r,i,l,W,F,ne,z,_,P,N],se=a.apply(t,pe);return yc(r)&&gl(se,pe),se.placeholder=u,yl(se,r,i)}function uc(r){var i=Ze[r];return function(a,u){if(a=Xt(a),u=u==null?0:lt(fe(u),292),u&&yh(a)){var l=(xe(a)+"e").split("e"),g=i(l[0]+"e"+(+l[1]+u));return l=(xe(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(a)}}var tm=nn&&1/Bs(new nn([,-0]))[1]==G?function(r){return new nn(r)}:Tc;function nl(r){return function(i){var a=ft(i);return a==nt?La(i):a==st?vg(i):hg(i,r(i))}}function Dr(r,i,a,u,l,g,w,_){var P=i&V;if(!P&&typeof r!="function")throw new Wt(h);var N=u?u.length:0;if(N||(i&=-97,u=l=t),w=w===t?w:Ye(fe(w),0),_=_===t?_:fe(_),N-=l?l.length:0,i&R){var C=u,F=l;u=l=t}var z=P?t:fc(r),W=[r,i,a,u,l,C,F,g,w,_];if(z&&ym(W,z),r=W[0],i=W[1],a=W[2],u=W[3],l=W[4],_=W[9]=W[9]===t?P?0:r.length:Ye(W[9]-N,0),!_&&i&(U|H)&&(i&=-25),!i||i==k)var ne=Yy(r,i,a);else i==U||i==H?ne=Xy(r,i,_):(i==ee||i==(k|ee))&&!l.length?ne=em(r,i,a,u):ne=ho.apply(t,W);var pe=z?jh:gl;return yl(pe(ne,W),r,i)}function sl(r,i,a,u){return r===t||ar(r,rn[a])&&!$e.call(u,a)?i:r}function ol(r,i,a,u,l,g){return Me(r)&&Me(i)&&(g.set(i,r),oo(r,i,t,ol,g),g.delete(i)),r}function rm(r){return Vn(r)?t:r}function al(r,i,a,u,l,g){var w=a&x,_=r.length,P=i.length;if(_!=P&&!(w&&P>_))return!1;var N=g.get(r),C=g.get(i);if(N&&C)return N==i&&C==r;var F=-1,z=!0,W=a&T?new bi:t;for(g.set(r,i),g.set(i,r);++F<_;){var ne=r[F],pe=i[F];if(u)var se=w?u(pe,ne,F,i,r,g):u(ne,pe,F,r,i,g);if(se!==t){if(se)continue;z=!1;break}if(W){if(!Ca(i,function(me,Ee){if(!Tn(W,Ee)&&(ne===me||l(ne,me,a,u,g)))return W.push(Ee)})){z=!1;break}}else if(!(ne===pe||l(ne,pe,a,u,g))){z=!1;break}}return g.delete(r),g.delete(i),z}function im(r,i,a,u,l,g,w){switch(a){case Ht:if(r.byteLength!=i.byteLength||r.byteOffset!=i.byteOffset)return!1;r=r.buffer,i=i.buffer;case kt:return!(r.byteLength!=i.byteLength||!g(new Ws(r),new Ws(i)));case Fe:case ke:case Pr:return ar(+r,+i);case gt:return r.name==i.name&&r.message==i.message;case gr:case yr:return r==i+"";case nt:var _=La;case st:var P=u&x;if(_||(_=Bs),r.size!=i.size&&!P)return!1;var N=w.get(r);if(N)return N==i;u|=T,w.set(r,i);var C=al(_(r),_(i),u,l,g,w);return w.delete(r),C;case xr:if(Fn)return Fn.call(r)==Fn.call(i)}return!1}function nm(r,i,a,u,l,g){var w=a&x,_=hc(r),P=_.length,N=hc(i),C=N.length;if(P!=C&&!w)return!1;for(var F=P;F--;){var z=_[F];if(!(w?z in i:$e.call(i,z)))return!1}var W=g.get(r),ne=g.get(i);if(W&&ne)return W==i&&ne==r;var pe=!0;g.set(r,i),g.set(i,r);for(var se=w;++F<P;){z=_[F];var me=r[z],Ee=i[z];if(u)var jt=w?u(Ee,me,z,i,r,g):u(me,Ee,z,r,i,g);if(!(jt===t?me===Ee||l(me,Ee,a,u,g):jt)){pe=!1;break}se||(se=z=="constructor")}if(pe&&!se){var wt=r.constructor,Lt=i.constructor;wt!=Lt&&"constructor"in r&&"constructor"in i&&!(typeof wt=="function"&&wt instanceof wt&&typeof Lt=="function"&&Lt instanceof Lt)&&(pe=!1)}return g.delete(r),g.delete(i),pe}function Ur(r){return vc(pl(r,t,El),r+"")}function hc(r){return Oh(r,tt,dc)}function lc(r){return Oh(r,St,cl)}var fc=eo?function(r){return eo.get(r)}:Tc;function go(r){for(var i=r.name+"",a=sn[i],u=$e.call(sn,i)?a.length:0;u--;){var l=a[u],g=l.func;if(g==null||g==r)return l.name}return i}function un(r){var i=$e.call(p,"placeholder")?p:r;return i.placeholder}function te(){var r=p.iteratee||$c;return r=r===$c?Rh:r,arguments.length?r(arguments[0],arguments[1]):r}function yo(r,i){var a=r.__data__;return fm(i)?a[typeof i=="string"?"string":"hash"]:a.map}function pc(r){for(var i=tt(r),a=i.length;a--;){var u=i[a],l=r[u];i[a]=[u,l,ll(l)]}return i}function Ii(r,i){var a=gg(r,i);return $h(a)?a:t}function sm(r){var i=$e.call(r,vi),a=r[vi];try{r[vi]=t;var u=!0}catch{}var l=Ks.call(r);return u&&(i?r[vi]=a:delete r[vi]),l}var dc=Ma?function(r){return r==null?[]:(r=Ue(r),Qr(Ma(r),function(i){return dh.call(r,i)}))}:Nc,cl=Ma?function(r){for(var i=[];r;)Jr(i,dc(r)),r=Qs(r);return i}:Nc,ft=mt;(Ba&&ft(new Ba(new ArrayBuffer(1)))!=Ht||Cn&&ft(new Cn)!=nt||ka&&ft(ka.resolve())!=Ui||nn&&ft(new nn)!=st||Dn&&ft(new Dn)!=mr)&&(ft=function(r){var i=mt(r),a=i==Ct?r.constructor:t,u=a?Si(a):"";if(u)switch(u){case Mg:return Ht;case Bg:return nt;case kg:return Ui;case Hg:return st;case Vg:return mr}return i});function om(r,i,a){for(var u=-1,l=a.length;++u<l;){var g=a[u],w=g.size;switch(g.type){case"drop":r+=w;break;case"dropRight":i-=w;break;case"take":i=lt(i,r+w);break;case"takeRight":r=Ye(r,i-w);break}}return{start:r,end:i}}function am(r){var i=r.match(Ar);return i?i[1].split(ca):[]}function ul(r,i,a){i=ti(i,r);for(var u=-1,l=i.length,g=!1;++u<l;){var w=Er(i[u]);if(!(g=r!=null&&a(r,w)))break;r=r[w]}return g||++u!=l?g:(l=r==null?0:r.length,!!l&&Io(l)&&Fr(w,l)&&(le(r)||Pi(r)))}function cm(r){var i=r.length,a=new r.constructor(i);return i&&typeof r[0]=="string"&&$e.call(r,"index")&&(a.index=r.index,a.input=r.input),a}function hl(r){return typeof r.constructor=="function"&&!kn(r)?on(Qs(r)):{}}function um(r,i,a){var u=r.constructor;switch(i){case kt:return ac(r);case Fe:case ke:return new u(+r);case Ht:return Ky(r,a);case Kr:case ht:case Li:case zi:case bn:case Mi:case Gr:case Bi:case ki:return Kh(r,a);case nt:return new u;case Pr:case yr:return new u(r);case gr:return Gy(r);case st:return new u;case xr:return Wy(r)}}function hm(r,i){var a=i.length;if(!a)return r;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),r.replace(xn,`{
/* [wrapped with `+i+`] */
`)}function lm(r){return le(r)||Pi(r)||!!(gh&&r&&r[gh])}function Fr(r,i){var a=typeof r;return i=i??Z,!!i&&(a=="number"||a!="symbol"&&ma.test(r))&&r>-1&&r%1==0&&r<i}function vt(r,i,a){if(!Me(a))return!1;var u=typeof i;return(u=="number"?It(a)&&Fr(i,a.length):u=="string"&&i in a)?ar(a[i],r):!1}function gc(r,i){if(le(r))return!1;var a=typeof r;return a=="number"||a=="symbol"||a=="boolean"||r==null||qt(r)?!0:sa.test(r)||!fi.test(r)||i!=null&&r in Ue(i)}function fm(r){var i=typeof r;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?r!=="__proto__":r===null}function yc(r){var i=go(r),a=p[i];if(typeof a!="function"||!(i in ve.prototype))return!1;if(r===a)return!0;var u=fc(a);return!!u&&r===u[0]}function pm(r){return!!lh&&lh in r}var dm=Hs?qr:Cc;function kn(r){var i=r&&r.constructor,a=typeof i=="function"&&i.prototype||rn;return r===a}function ll(r){return r===r&&!Me(r)}function fl(r,i){return function(a){return a==null?!1:a[r]===i&&(i!==t||r in Ue(a))}}function gm(r){var i=_o(r,function(u){return a.size===d&&a.clear(),u}),a=i.cache;return i}function ym(r,i){var a=r[1],u=i[1],l=a|u,g=l<(k|V|q),w=u==q&&a==U||u==q&&a==L&&r[7].length<=i[8]||u==(q|L)&&i[7].length<=i[8]&&a==U;if(!(g||w))return r;u&k&&(r[2]=i[2],l|=a&k?0:re);var _=i[3];if(_){var P=r[3];r[3]=P?Wh(P,_,i[4]):_,r[4]=P?Zr(r[3],m):i[4]}return _=i[5],_&&(P=r[5],r[5]=P?Qh(P,_,i[6]):_,r[6]=P?Zr(r[5],m):i[6]),_=i[7],_&&(r[7]=_),u&q&&(r[8]=r[8]==null?i[8]:lt(r[8],i[8])),r[9]==null&&(r[9]=i[9]),r[0]=i[0],r[1]=l,r}function mm(r){var i=[];if(r!=null)for(var a in Ue(r))i.push(a);return i}function vm(r){return Ks.call(r)}function pl(r,i,a){return i=Ye(i===t?r.length-1:i,0),function(){for(var u=arguments,l=-1,g=Ye(u.length-i,0),w=O(g);++l<g;)w[l]=u[i+l];l=-1;for(var _=O(i+1);++l<i;)_[l]=u[l];return _[i]=a(w),et(r,this,_)}}function dl(r,i){return i.length<2?r:Ei(r,Zt(i,0,-1))}function wm(r,i){for(var a=r.length,u=lt(i.length,a),l=Et(r);u--;){var g=i[u];r[u]=Fr(g,a)?l[g]:t}return r}function mc(r,i){if(!(i==="constructor"&&typeof r[i]=="function")&&i!="__proto__")return r[i]}var gl=ml(jh),Hn=Dg||function(r,i){return _e.setTimeout(r,i)},vc=ml(By);function yl(r,i,a){var u=i+"";return vc(r,hm(u,bm(am(u),a)))}function ml(r){var i=0,a=0;return function(){var u=jg(),l=We-(u-a);if(a=u,l>0){if(++i>=Pe)return arguments[0]}else i=0;return r.apply(t,arguments)}}function mo(r,i){var a=-1,u=r.length,l=u-1;for(i=i===t?u:i;++a<i;){var g=ec(a,l),w=r[g];r[g]=r[a],r[a]=w}return r.length=i,r}var vl=gm(function(r){var i=[];return r.charCodeAt(0)===46&&i.push(""),r.replace(oa,function(a,u,l,g){i.push(l?g.replace(la,"$1"):u||a)}),i});function Er(r){if(typeof r=="string"||qt(r))return r;var i=r+"";return i=="0"&&1/r==-1/0?"-0":i}function Si(r){if(r!=null){try{return Vs.call(r)}catch{}try{return r+""}catch{}}return""}function bm(r,i){return Gt(Ae,function(a){var u="_."+a[0];i&a[1]&&!zs(r,u)&&r.push(u)}),r.sort()}function wl(r){if(r instanceof ve)return r.clone();var i=new Qt(r.__wrapped__,r.__chain__);return i.__actions__=Et(r.__actions__),i.__index__=r.__index__,i.__values__=r.__values__,i}function _m(r,i,a){(a?vt(r,i,a):i===t)?i=1:i=Ye(fe(i),0);var u=r==null?0:r.length;if(!u||i<1)return[];for(var l=0,g=0,w=O(Ys(u/i));l<u;)w[g++]=Zt(r,l,l+=i);return w}function Em(r){for(var i=-1,a=r==null?0:r.length,u=0,l=[];++i<a;){var g=r[i];g&&(l[u++]=g)}return l}function Im(){var r=arguments.length;if(!r)return[];for(var i=O(r-1),a=arguments[0],u=r;u--;)i[u-1]=arguments[u];return Jr(le(a)?Et(a):[a],ot(i,1))}var Sm=ge(function(r,i){return Ve(r)?jn(r,ot(i,1,Ve,!0)):[]}),Pm=ge(function(r,i){var a=Yt(i);return Ve(a)&&(a=t),Ve(r)?jn(r,ot(i,1,Ve,!0),te(a,2)):[]}),xm=ge(function(r,i){var a=Yt(i);return Ve(a)&&(a=t),Ve(r)?jn(r,ot(i,1,Ve,!0),t,a):[]});function Om(r,i,a){var u=r==null?0:r.length;return u?(i=a||i===t?1:fe(i),Zt(r,i<0?0:i,u)):[]}function Am(r,i,a){var u=r==null?0:r.length;return u?(i=a||i===t?1:fe(i),i=u-i,Zt(r,0,i<0?0:i)):[]}function $m(r,i){return r&&r.length?co(r,te(i,3),!0,!0):[]}function Rm(r,i){return r&&r.length?co(r,te(i,3),!0):[]}function Tm(r,i,a,u){var l=r==null?0:r.length;return l?(a&&typeof a!="number"&&vt(r,i,a)&&(a=0,u=l),Iy(r,i,a,u)):[]}function bl(r,i,a){var u=r==null?0:r.length;if(!u)return-1;var l=a==null?0:fe(a);return l<0&&(l=Ye(u+l,0)),Ms(r,te(i,3),l)}function _l(r,i,a){var u=r==null?0:r.length;if(!u)return-1;var l=u-1;return a!==t&&(l=fe(a),l=a<0?Ye(u+l,0):lt(l,u-1)),Ms(r,te(i,3),l,!0)}function El(r){var i=r==null?0:r.length;return i?ot(r,1):[]}function Nm(r){var i=r==null?0:r.length;return i?ot(r,G):[]}function Cm(r,i){var a=r==null?0:r.length;return a?(i=i===t?1:fe(i),ot(r,i)):[]}function Dm(r){for(var i=-1,a=r==null?0:r.length,u={};++i<a;){var l=r[i];u[l[0]]=l[1]}return u}function Il(r){return r&&r.length?r[0]:t}function Um(r,i,a){var u=r==null?0:r.length;if(!u)return-1;var l=a==null?0:fe(a);return l<0&&(l=Ye(u+l,0)),Yi(r,i,l)}function Fm(r){var i=r==null?0:r.length;return i?Zt(r,0,-1):[]}var qm=ge(function(r){var i=Le(r,sc);return i.length&&i[0]===r[0]?Qa(i):[]}),jm=ge(function(r){var i=Yt(r),a=Le(r,sc);return i===Yt(a)?i=t:a.pop(),a.length&&a[0]===r[0]?Qa(a,te(i,2)):[]}),Lm=ge(function(r){var i=Yt(r),a=Le(r,sc);return i=typeof i=="function"?i:t,i&&a.pop(),a.length&&a[0]===r[0]?Qa(a,t,i):[]});function zm(r,i){return r==null?"":Fg.call(r,i)}function Yt(r){var i=r==null?0:r.length;return i?r[i-1]:t}function Mm(r,i,a){var u=r==null?0:r.length;if(!u)return-1;var l=u;return a!==t&&(l=fe(a),l=l<0?Ye(u+l,0):lt(l,u-1)),i===i?bg(r,i,l):Ms(r,ih,l,!0)}function Bm(r,i){return r&&r.length?Dh(r,fe(i)):t}var km=ge(Sl);function Sl(r,i){return r&&r.length&&i&&i.length?Xa(r,i):r}function Hm(r,i,a){return r&&r.length&&i&&i.length?Xa(r,i,te(a,2)):r}function Vm(r,i,a){return r&&r.length&&i&&i.length?Xa(r,i,t,a):r}var Km=Ur(function(r,i){var a=r==null?0:r.length,u=Va(r,i);return qh(r,Le(i,function(l){return Fr(l,a)?+l:l}).sort(Gh)),u});function Gm(r,i){var a=[];if(!(r&&r.length))return a;var u=-1,l=[],g=r.length;for(i=te(i,3);++u<g;){var w=r[u];i(w,u,r)&&(a.push(w),l.push(u))}return qh(r,l),a}function wc(r){return r==null?r:zg.call(r)}function Wm(r,i,a){var u=r==null?0:r.length;return u?(a&&typeof a!="number"&&vt(r,i,a)?(i=0,a=u):(i=i==null?0:fe(i),a=a===t?u:fe(a)),Zt(r,i,a)):[]}function Qm(r,i){return ao(r,i)}function Jm(r,i,a){return rc(r,i,te(a,2))}function Zm(r,i){var a=r==null?0:r.length;if(a){var u=ao(r,i);if(u<a&&ar(r[u],i))return u}return-1}function Ym(r,i){return ao(r,i,!0)}function Xm(r,i,a){return rc(r,i,te(a,2),!0)}function ev(r,i){var a=r==null?0:r.length;if(a){var u=ao(r,i,!0)-1;if(ar(r[u],i))return u}return-1}function tv(r){return r&&r.length?Lh(r):[]}function rv(r,i){return r&&r.length?Lh(r,te(i,2)):[]}function iv(r){var i=r==null?0:r.length;return i?Zt(r,1,i):[]}function nv(r,i,a){return r&&r.length?(i=a||i===t?1:fe(i),Zt(r,0,i<0?0:i)):[]}function sv(r,i,a){var u=r==null?0:r.length;return u?(i=a||i===t?1:fe(i),i=u-i,Zt(r,i<0?0:i,u)):[]}function ov(r,i){return r&&r.length?co(r,te(i,3),!1,!0):[]}function av(r,i){return r&&r.length?co(r,te(i,3)):[]}var cv=ge(function(r){return ei(ot(r,1,Ve,!0))}),uv=ge(function(r){var i=Yt(r);return Ve(i)&&(i=t),ei(ot(r,1,Ve,!0),te(i,2))}),hv=ge(function(r){var i=Yt(r);return i=typeof i=="function"?i:t,ei(ot(r,1,Ve,!0),t,i)});function lv(r){return r&&r.length?ei(r):[]}function fv(r,i){return r&&r.length?ei(r,te(i,2)):[]}function pv(r,i){return i=typeof i=="function"?i:t,r&&r.length?ei(r,t,i):[]}function bc(r){if(!(r&&r.length))return[];var i=0;return r=Qr(r,function(a){if(Ve(a))return i=Ye(a.length,i),!0}),qa(i,function(a){return Le(r,Da(a))})}function Pl(r,i){if(!(r&&r.length))return[];var a=bc(r);return i==null?a:Le(a,function(u){return et(i,t,u)})}var dv=ge(function(r,i){return Ve(r)?jn(r,i):[]}),gv=ge(function(r){return nc(Qr(r,Ve))}),yv=ge(function(r){var i=Yt(r);return Ve(i)&&(i=t),nc(Qr(r,Ve),te(i,2))}),mv=ge(function(r){var i=Yt(r);return i=typeof i=="function"?i:t,nc(Qr(r,Ve),t,i)}),vv=ge(bc);function wv(r,i){return kh(r||[],i||[],qn)}function bv(r,i){return kh(r||[],i||[],Mn)}var _v=ge(function(r){var i=r.length,a=i>1?r[i-1]:t;return a=typeof a=="function"?(r.pop(),a):t,Pl(r,a)});function xl(r){var i=p(r);return i.__chain__=!0,i}function Ev(r,i){return i(r),r}function vo(r,i){return i(r)}var Iv=Ur(function(r){var i=r.length,a=i?r[0]:0,u=this.__wrapped__,l=function(g){return Va(g,r)};return i>1||this.__actions__.length||!(u instanceof ve)||!Fr(a)?this.thru(l):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:vo,args:[l],thisArg:t}),new Qt(u,this.__chain__).thru(function(g){return i&&!g.length&&g.push(t),g}))});function Sv(){return xl(this)}function Pv(){return new Qt(this.value(),this.__chain__)}function xv(){this.__values__===t&&(this.__values__=zl(this.value()));var r=this.__index__>=this.__values__.length,i=r?t:this.__values__[this.__index__++];return{done:r,value:i}}function Ov(){return this}function Av(r){for(var i,a=this;a instanceof ro;){var u=wl(a);u.__index__=0,u.__values__=t,i?l.__wrapped__=u:i=u;var l=u;a=a.__wrapped__}return l.__wrapped__=r,i}function $v(){var r=this.__wrapped__;if(r instanceof ve){var i=r;return this.__actions__.length&&(i=new ve(this)),i=i.reverse(),i.__actions__.push({func:vo,args:[wc],thisArg:t}),new Qt(i,this.__chain__)}return this.thru(wc)}function Rv(){return Bh(this.__wrapped__,this.__actions__)}var Tv=uo(function(r,i,a){$e.call(r,a)?++r[a]:Cr(r,a,1)});function Nv(r,i,a){var u=le(r)?th:Ey;return a&&vt(r,i,a)&&(i=t),u(r,te(i,3))}function Cv(r,i){var a=le(r)?Qr:Ph;return a(r,te(i,3))}var Dv=Xh(bl),Uv=Xh(_l);function Fv(r,i){return ot(wo(r,i),1)}function qv(r,i){return ot(wo(r,i),G)}function jv(r,i,a){return a=a===t?1:fe(a),ot(wo(r,i),a)}function Ol(r,i){var a=le(r)?Gt:Xr;return a(r,te(i,3))}function Al(r,i){var a=le(r)?ig:Sh;return a(r,te(i,3))}var Lv=uo(function(r,i,a){$e.call(r,a)?r[a].push(i):Cr(r,a,[i])});function zv(r,i,a,u){r=It(r)?r:ln(r),a=a&&!u?fe(a):0;var l=r.length;return a<0&&(a=Ye(l+a,0)),So(r)?a<=l&&r.indexOf(i,a)>-1:!!l&&Yi(r,i,a)>-1}var Mv=ge(function(r,i,a){var u=-1,l=typeof i=="function",g=It(r)?O(r.length):[];return Xr(r,function(w){g[++u]=l?et(i,w,a):Ln(w,i,a)}),g}),Bv=uo(function(r,i,a){Cr(r,a,i)});function wo(r,i){var a=le(r)?Le:Th;return a(r,te(i,3))}function kv(r,i,a,u){return r==null?[]:(le(i)||(i=i==null?[]:[i]),a=u?t:a,le(a)||(a=a==null?[]:[a]),Uh(r,i,a))}var Hv=uo(function(r,i,a){r[a?0:1].push(i)},function(){return[[],[]]});function Vv(r,i,a){var u=le(r)?Na:sh,l=arguments.length<3;return u(r,te(i,4),a,l,Xr)}function Kv(r,i,a){var u=le(r)?ng:sh,l=arguments.length<3;return u(r,te(i,4),a,l,Sh)}function Gv(r,i){var a=le(r)?Qr:Ph;return a(r,Eo(te(i,3)))}function Wv(r){var i=le(r)?bh:zy;return i(r)}function Qv(r,i,a){(a?vt(r,i,a):i===t)?i=1:i=fe(i);var u=le(r)?my:My;return u(r,i)}function Jv(r){var i=le(r)?vy:ky;return i(r)}function Zv(r){if(r==null)return 0;if(It(r))return So(r)?en(r):r.length;var i=ft(r);return i==nt||i==st?r.size:Za(r).length}function Yv(r,i,a){var u=le(r)?Ca:Hy;return a&&vt(r,i,a)&&(i=t),u(r,te(i,3))}var Xv=ge(function(r,i){if(r==null)return[];var a=i.length;return a>1&&vt(r,i[0],i[1])?i=[]:a>2&&vt(i[0],i[1],i[2])&&(i=[i[0]]),Uh(r,ot(i,1),[])}),bo=Cg||function(){return _e.Date.now()};function ew(r,i){if(typeof i!="function")throw new Wt(h);return r=fe(r),function(){if(--r<1)return i.apply(this,arguments)}}function $l(r,i,a){return i=a?t:i,i=r&&i==null?r.length:i,Dr(r,q,t,t,t,t,i)}function Rl(r,i){var a;if(typeof i!="function")throw new Wt(h);return r=fe(r),function(){return--r>0&&(a=i.apply(this,arguments)),r<=1&&(i=t),a}}var _c=ge(function(r,i,a){var u=k;if(a.length){var l=Zr(a,un(_c));u|=ee}return Dr(r,u,i,a,l)}),Tl=ge(function(r,i,a){var u=k|V;if(a.length){var l=Zr(a,un(Tl));u|=ee}return Dr(i,u,r,a,l)});function Nl(r,i,a){i=a?t:i;var u=Dr(r,U,t,t,t,t,t,i);return u.placeholder=Nl.placeholder,u}function Cl(r,i,a){i=a?t:i;var u=Dr(r,H,t,t,t,t,t,i);return u.placeholder=Cl.placeholder,u}function Dl(r,i,a){var u,l,g,w,_,P,N=0,C=!1,F=!1,z=!0;if(typeof r!="function")throw new Wt(h);i=Xt(i)||0,Me(a)&&(C=!!a.leading,F="maxWait"in a,g=F?Ye(Xt(a.maxWait)||0,i):g,z="trailing"in a?!!a.trailing:z);function W(Ke){var cr=u,Lr=l;return u=l=t,N=Ke,w=r.apply(Lr,cr),w}function ne(Ke){return N=Ke,_=Hn(me,i),C?W(Ke):w}function pe(Ke){var cr=Ke-P,Lr=Ke-N,Xl=i-cr;return F?lt(Xl,g-Lr):Xl}function se(Ke){var cr=Ke-P,Lr=Ke-N;return P===t||cr>=i||cr<0||F&&Lr>=g}function me(){var Ke=bo();if(se(Ke))return Ee(Ke);_=Hn(me,pe(Ke))}function Ee(Ke){return _=t,z&&u?W(Ke):(u=l=t,w)}function jt(){_!==t&&Hh(_),N=0,u=P=l=_=t}function wt(){return _===t?w:Ee(bo())}function Lt(){var Ke=bo(),cr=se(Ke);if(u=arguments,l=this,P=Ke,cr){if(_===t)return ne(P);if(F)return Hh(_),_=Hn(me,i),W(P)}return _===t&&(_=Hn(me,i)),w}return Lt.cancel=jt,Lt.flush=wt,Lt}var tw=ge(function(r,i){return Ih(r,1,i)}),rw=ge(function(r,i,a){return Ih(r,Xt(i)||0,a)});function iw(r){return Dr(r,Y)}function _o(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new Wt(h);var a=function(){var u=arguments,l=i?i.apply(this,u):u[0],g=a.cache;if(g.has(l))return g.get(l);var w=r.apply(this,u);return a.cache=g.set(l,w)||g,w};return a.cache=new(_o.Cache||Nr),a}_o.Cache=Nr;function Eo(r){if(typeof r!="function")throw new Wt(h);return function(){var i=arguments;switch(i.length){case 0:return!r.call(this);case 1:return!r.call(this,i[0]);case 2:return!r.call(this,i[0],i[1]);case 3:return!r.call(this,i[0],i[1],i[2])}return!r.apply(this,i)}}function nw(r){return Rl(2,r)}var sw=Vy(function(r,i){i=i.length==1&&le(i[0])?Le(i[0],Ut(te())):Le(ot(i,1),Ut(te()));var a=i.length;return ge(function(u){for(var l=-1,g=lt(u.length,a);++l<g;)u[l]=i[l].call(this,u[l]);return et(r,this,u)})}),Ec=ge(function(r,i){var a=Zr(i,un(Ec));return Dr(r,ee,t,i,a)}),Ul=ge(function(r,i){var a=Zr(i,un(Ul));return Dr(r,R,t,i,a)}),ow=Ur(function(r,i){return Dr(r,L,t,t,t,i)});function aw(r,i){if(typeof r!="function")throw new Wt(h);return i=i===t?i:fe(i),ge(r,i)}function cw(r,i){if(typeof r!="function")throw new Wt(h);return i=i==null?0:Ye(fe(i),0),ge(function(a){var u=a[i],l=ri(a,0,i);return u&&Jr(l,u),et(r,this,l)})}function uw(r,i,a){var u=!0,l=!0;if(typeof r!="function")throw new Wt(h);return Me(a)&&(u="leading"in a?!!a.leading:u,l="trailing"in a?!!a.trailing:l),Dl(r,i,{leading:u,maxWait:i,trailing:l})}function hw(r){return $l(r,1)}function lw(r,i){return Ec(oc(i),r)}function fw(){if(!arguments.length)return[];var r=arguments[0];return le(r)?r:[r]}function pw(r){return Jt(r,A)}function dw(r,i){return i=typeof i=="function"?i:t,Jt(r,A,i)}function gw(r){return Jt(r,b|A)}function yw(r,i){return i=typeof i=="function"?i:t,Jt(r,b|A,i)}function mw(r,i){return i==null||Eh(r,i,tt(i))}function ar(r,i){return r===i||r!==r&&i!==i}var vw=po(Wa),ww=po(function(r,i){return r>=i}),Pi=Ah(function(){return arguments}())?Ah:function(r){return Be(r)&&$e.call(r,"callee")&&!dh.call(r,"callee")},le=O.isArray,bw=yt?Ut(yt):Ay;function It(r){return r!=null&&Io(r.length)&&!qr(r)}function Ve(r){return Be(r)&&It(r)}function _w(r){return r===!0||r===!1||Be(r)&&mt(r)==Fe}var ii=Ug||Cc,Ew=nr?Ut(nr):$y;function Iw(r){return Be(r)&&r.nodeType===1&&!Vn(r)}function Sw(r){if(r==null)return!0;if(It(r)&&(le(r)||typeof r=="string"||typeof r.splice=="function"||ii(r)||hn(r)||Pi(r)))return!r.length;var i=ft(r);if(i==nt||i==st)return!r.size;if(kn(r))return!Za(r).length;for(var a in r)if($e.call(r,a))return!1;return!0}function Pw(r,i){return zn(r,i)}function xw(r,i,a){a=typeof a=="function"?a:t;var u=a?a(r,i):t;return u===t?zn(r,i,t,a):!!u}function Ic(r){if(!Be(r))return!1;var i=mt(r);return i==gt||i==Tt||typeof r.message=="string"&&typeof r.name=="string"&&!Vn(r)}function Ow(r){return typeof r=="number"&&yh(r)}function qr(r){if(!Me(r))return!1;var i=mt(r);return i==Nt||i==Vr||i==Rt||i==Fi}function Fl(r){return typeof r=="number"&&r==fe(r)}function Io(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Z}function Me(r){var i=typeof r;return r!=null&&(i=="object"||i=="function")}function Be(r){return r!=null&&typeof r=="object"}var ql=Kt?Ut(Kt):Ty;function Aw(r,i){return r===i||Ja(r,i,pc(i))}function $w(r,i,a){return a=typeof a=="function"?a:t,Ja(r,i,pc(i),a)}function Rw(r){return jl(r)&&r!=+r}function Tw(r){if(dm(r))throw new ue(c);return $h(r)}function Nw(r){return r===null}function Cw(r){return r==null}function jl(r){return typeof r=="number"||Be(r)&&mt(r)==Pr}function Vn(r){if(!Be(r)||mt(r)!=Ct)return!1;var i=Qs(r);if(i===null)return!0;var a=$e.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Vs.call(a)==$g}var Sc=wr?Ut(wr):Ny;function Dw(r){return Fl(r)&&r>=-9007199254740991&&r<=Z}var Ll=Rn?Ut(Rn):Cy;function So(r){return typeof r=="string"||!le(r)&&Be(r)&&mt(r)==yr}function qt(r){return typeof r=="symbol"||Be(r)&&mt(r)==xr}var hn=mi?Ut(mi):Dy;function Uw(r){return r===t}function Fw(r){return Be(r)&&ft(r)==mr}function qw(r){return Be(r)&&mt(r)==ji}var jw=po(Ya),Lw=po(function(r,i){return r<=i});function zl(r){if(!r)return[];if(It(r))return So(r)?sr(r):Et(r);if(Nn&&r[Nn])return mg(r[Nn]());var i=ft(r),a=i==nt?La:i==st?Bs:ln;return a(r)}function jr(r){if(!r)return r===0?r:0;if(r=Xt(r),r===G||r===-1/0){var i=r<0?-1:1;return i*ye}return r===r?r:0}function fe(r){var i=jr(r),a=i%1;return i===i?a?i-a:i:0}function Ml(r){return r?_i(fe(r),0,ce):0}function Xt(r){if(typeof r=="number")return r;if(qt(r))return J;if(Me(r)){var i=typeof r.valueOf=="function"?r.valueOf():r;r=Me(i)?i+"":i}if(typeof r!="string")return r===0?r:+r;r=oh(r);var a=da.test(r);return a||ya.test(r)?he(r.slice(2),a?2:8):pa.test(r)?J:+r}function Bl(r){return _r(r,St(r))}function zw(r){return r?_i(fe(r),-9007199254740991,Z):r===0?r:0}function xe(r){return r==null?"":Ft(r)}var Mw=an(function(r,i){if(kn(i)||It(i)){_r(i,tt(i),r);return}for(var a in i)$e.call(i,a)&&qn(r,a,i[a])}),kl=an(function(r,i){_r(i,St(i),r)}),Po=an(function(r,i,a,u){_r(i,St(i),r,u)}),Bw=an(function(r,i,a,u){_r(i,tt(i),r,u)}),kw=Ur(Va);function Hw(r,i){var a=on(r);return i==null?a:_h(a,i)}var Vw=ge(function(r,i){r=Ue(r);var a=-1,u=i.length,l=u>2?i[2]:t;for(l&&vt(i[0],i[1],l)&&(u=1);++a<u;)for(var g=i[a],w=St(g),_=-1,P=w.length;++_<P;){var N=w[_],C=r[N];(C===t||ar(C,rn[N])&&!$e.call(r,N))&&(r[N]=g[N])}return r}),Kw=ge(function(r){return r.push(t,ol),et(Hl,t,r)});function Gw(r,i){return rh(r,te(i,3),br)}function Ww(r,i){return rh(r,te(i,3),Ga)}function Qw(r,i){return r==null?r:Ka(r,te(i,3),St)}function Jw(r,i){return r==null?r:xh(r,te(i,3),St)}function Zw(r,i){return r&&br(r,te(i,3))}function Yw(r,i){return r&&Ga(r,te(i,3))}function Xw(r){return r==null?[]:so(r,tt(r))}function e0(r){return r==null?[]:so(r,St(r))}function Pc(r,i,a){var u=r==null?t:Ei(r,i);return u===t?a:u}function t0(r,i){return r!=null&&ul(r,i,Sy)}function xc(r,i){return r!=null&&ul(r,i,Py)}var r0=tl(function(r,i,a){i!=null&&typeof i.toString!="function"&&(i=Ks.call(i)),r[i]=a},Ac(Pt)),i0=tl(function(r,i,a){i!=null&&typeof i.toString!="function"&&(i=Ks.call(i)),$e.call(r,i)?r[i].push(a):r[i]=[a]},te),n0=ge(Ln);function tt(r){return It(r)?wh(r):Za(r)}function St(r){return It(r)?wh(r,!0):Uy(r)}function s0(r,i){var a={};return i=te(i,3),br(r,function(u,l,g){Cr(a,i(u,l,g),u)}),a}function o0(r,i){var a={};return i=te(i,3),br(r,function(u,l,g){Cr(a,l,i(u,l,g))}),a}var a0=an(function(r,i,a){oo(r,i,a)}),Hl=an(function(r,i,a,u){oo(r,i,a,u)}),c0=Ur(function(r,i){var a={};if(r==null)return a;var u=!1;i=Le(i,function(g){return g=ti(g,r),u||(u=g.length>1),g}),_r(r,lc(r),a),u&&(a=Jt(a,b|E|A,rm));for(var l=i.length;l--;)ic(a,i[l]);return a});function u0(r,i){return Vl(r,Eo(te(i)))}var h0=Ur(function(r,i){return r==null?{}:qy(r,i)});function Vl(r,i){if(r==null)return{};var a=Le(lc(r),function(u){return[u]});return i=te(i),Fh(r,a,function(u,l){return i(u,l[0])})}function l0(r,i,a){i=ti(i,r);var u=-1,l=i.length;for(l||(l=1,r=t);++u<l;){var g=r==null?t:r[Er(i[u])];g===t&&(u=l,g=a),r=qr(g)?g.call(r):g}return r}function f0(r,i,a){return r==null?r:Mn(r,i,a)}function p0(r,i,a,u){return u=typeof u=="function"?u:t,r==null?r:Mn(r,i,a,u)}var Kl=nl(tt),Gl=nl(St);function d0(r,i,a){var u=le(r),l=u||ii(r)||hn(r);if(i=te(i,4),a==null){var g=r&&r.constructor;l?a=u?new g:[]:Me(r)?a=qr(g)?on(Qs(r)):{}:a={}}return(l?Gt:br)(r,function(w,_,P){return i(a,w,_,P)}),a}function g0(r,i){return r==null?!0:ic(r,i)}function y0(r,i,a){return r==null?r:Mh(r,i,oc(a))}function m0(r,i,a,u){return u=typeof u=="function"?u:t,r==null?r:Mh(r,i,oc(a),u)}function ln(r){return r==null?[]:ja(r,tt(r))}function v0(r){return r==null?[]:ja(r,St(r))}function w0(r,i,a){return a===t&&(a=i,i=t),a!==t&&(a=Xt(a),a=a===a?a:0),i!==t&&(i=Xt(i),i=i===i?i:0),_i(Xt(r),i,a)}function b0(r,i,a){return i=jr(i),a===t?(a=i,i=0):a=jr(a),r=Xt(r),xy(r,i,a)}function _0(r,i,a){if(a&&typeof a!="boolean"&&vt(r,i,a)&&(i=a=t),a===t&&(typeof i=="boolean"?(a=i,i=t):typeof r=="boolean"&&(a=r,r=t)),r===t&&i===t?(r=0,i=1):(r=jr(r),i===t?(i=r,r=0):i=jr(i)),r>i){var u=r;r=i,i=u}if(a||r%1||i%1){var l=mh();return lt(r+l*(i-r+Ce("1e-"+((l+"").length-1))),i)}return ec(r,i)}var E0=cn(function(r,i,a){return i=i.toLowerCase(),r+(a?Wl(i):i)});function Wl(r){return Oc(xe(r).toLowerCase())}function Ql(r){return r=xe(r),r&&r.replace($r,fg).replace($a,"")}function I0(r,i,a){r=xe(r),i=Ft(i);var u=r.length;a=a===t?u:_i(fe(a),0,u);var l=a;return a-=i.length,a>=0&&r.slice(a,l)==i}function S0(r){return r=xe(r),r&&li.test(r)?r.replace(ws,pg):r}function P0(r){return r=xe(r),r&&aa.test(r)?r.replace(Sn,"\\$&"):r}var x0=cn(function(r,i,a){return r+(a?"-":"")+i.toLowerCase()}),O0=cn(function(r,i,a){return r+(a?" ":"")+i.toLowerCase()}),A0=Yh("toLowerCase");function $0(r,i,a){r=xe(r),i=fe(i);var u=i?en(r):0;if(!i||u>=i)return r;var l=(i-u)/2;return fo(Xs(l),a)+r+fo(Ys(l),a)}function R0(r,i,a){r=xe(r),i=fe(i);var u=i?en(r):0;return i&&u<i?r+fo(i-u,a):r}function T0(r,i,a){r=xe(r),i=fe(i);var u=i?en(r):0;return i&&u<i?fo(i-u,a)+r:r}function N0(r,i,a){return a||i==null?i=0:i&&(i=+i),Lg(xe(r).replace(Pn,""),i||0)}function C0(r,i,a){return(a?vt(r,i,a):i===t)?i=1:i=fe(i),tc(xe(r),i)}function D0(){var r=arguments,i=xe(r[0]);return r.length<3?i:i.replace(r[1],r[2])}var U0=cn(function(r,i,a){return r+(a?"_":"")+i.toLowerCase()});function F0(r,i,a){return a&&typeof a!="number"&&vt(r,i,a)&&(i=a=t),a=a===t?ce:a>>>0,a?(r=xe(r),r&&(typeof i=="string"||i!=null&&!Sc(i))&&(i=Ft(i),!i&&Xi(r))?ri(sr(r),0,a):r.split(i,a)):[]}var q0=cn(function(r,i,a){return r+(a?" ":"")+Oc(i)});function j0(r,i,a){return r=xe(r),a=a==null?0:_i(fe(a),0,r.length),i=Ft(i),r.slice(a,a+i.length)==i}function L0(r,i,a){var u=p.templateSettings;a&&vt(r,i,a)&&(i=t),r=xe(r),i=Po({},i,u,sl);var l=Po({},i.imports,u.imports,sl),g=tt(l),w=ja(l,g),_,P,N=0,C=i.interpolate||Vi,F="__p += '",z=za((i.escape||Vi).source+"|"+C.source+"|"+(C===Hi?fa:Vi).source+"|"+(i.evaluate||Vi).source+"|$","g"),W="//# sourceURL="+($e.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ra+"]")+`
`;r.replace(z,function(se,me,Ee,jt,wt,Lt){return Ee||(Ee=jt),F+=r.slice(N,Lt).replace(va,dg),me&&(_=!0,F+=`' +
__e(`+me+`) +
'`),wt&&(P=!0,F+=`';
`+wt+`;
__p += '`),Ee&&(F+=`' +
((__t = (`+Ee+`)) == null ? '' : __t) +
'`),N=Lt+se.length,se}),F+=`';
`;var ne=$e.call(i,"variable")&&i.variable;if(!ne)F=`with (obj) {
`+F+`
}
`;else if(ha.test(ne))throw new ue(f);F=(P?F.replace(na,""):F).replace(Or,"$1").replace(ms,"$1;"),F="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+F+`return __p
}`;var pe=Zl(function(){return Se(g,W+"return "+F).apply(t,w)});if(pe.source=F,Ic(pe))throw pe;return pe}function z0(r){return xe(r).toLowerCase()}function M0(r){return xe(r).toUpperCase()}function B0(r,i,a){if(r=xe(r),r&&(a||i===t))return oh(r);if(!r||!(i=Ft(i)))return r;var u=sr(r),l=sr(i),g=ah(u,l),w=ch(u,l)+1;return ri(u,g,w).join("")}function k0(r,i,a){if(r=xe(r),r&&(a||i===t))return r.slice(0,hh(r)+1);if(!r||!(i=Ft(i)))return r;var u=sr(r),l=ch(u,sr(i))+1;return ri(u,0,l).join("")}function H0(r,i,a){if(r=xe(r),r&&(a||i===t))return r.replace(Pn,"");if(!r||!(i=Ft(i)))return r;var u=sr(r),l=ah(u,sr(i));return ri(u,l).join("")}function V0(r,i){var a=ae,u=we;if(Me(i)){var l="separator"in i?i.separator:l;a="length"in i?fe(i.length):a,u="omission"in i?Ft(i.omission):u}r=xe(r);var g=r.length;if(Xi(r)){var w=sr(r);g=w.length}if(a>=g)return r;var _=a-en(u);if(_<1)return u;var P=w?ri(w,0,_).join(""):r.slice(0,_);if(l===t)return P+u;if(w&&(_+=P.length-_),Sc(l)){if(r.slice(_).search(l)){var N,C=P;for(l.global||(l=za(l.source,xe(Vt.exec(l))+"g")),l.lastIndex=0;N=l.exec(C);)var F=N.index;P=P.slice(0,F===t?_:F)}}else if(r.indexOf(Ft(l),_)!=_){var z=P.lastIndexOf(l);z>-1&&(P=P.slice(0,z))}return P+u}function K0(r){return r=xe(r),r&&_n.test(r)?r.replace(vs,_g):r}var G0=cn(function(r,i,a){return r+(a?" ":"")+i.toUpperCase()}),Oc=Yh("toUpperCase");function Jl(r,i,a){return r=xe(r),i=a?t:i,i===t?yg(r)?Sg(r):ag(r):r.match(i)||[]}var Zl=ge(function(r,i){try{return et(r,t,i)}catch(a){return Ic(a)?a:new ue(a)}}),W0=Ur(function(r,i){return Gt(i,function(a){a=Er(a),Cr(r,a,_c(r[a],r))}),r});function Q0(r){var i=r==null?0:r.length,a=te();return r=i?Le(r,function(u){if(typeof u[1]!="function")throw new Wt(h);return[a(u[0]),u[1]]}):[],ge(function(u){for(var l=-1;++l<i;){var g=r[l];if(et(g[0],this,u))return et(g[1],this,u)}})}function J0(r){return _y(Jt(r,b))}function Ac(r){return function(){return r}}function Z0(r,i){return r==null||r!==r?i:r}var Y0=el(),X0=el(!0);function Pt(r){return r}function $c(r){return Rh(typeof r=="function"?r:Jt(r,b))}function eb(r){return Nh(Jt(r,b))}function tb(r,i){return Ch(r,Jt(i,b))}var rb=ge(function(r,i){return function(a){return Ln(a,r,i)}}),ib=ge(function(r,i){return function(a){return Ln(r,a,i)}});function Rc(r,i,a){var u=tt(i),l=so(i,u);a==null&&!(Me(i)&&(l.length||!u.length))&&(a=i,i=r,r=this,l=so(i,tt(i)));var g=!(Me(a)&&"chain"in a)||!!a.chain,w=qr(r);return Gt(l,function(_){var P=i[_];r[_]=P,w&&(r.prototype[_]=function(){var N=this.__chain__;if(g||N){var C=r(this.__wrapped__),F=C.__actions__=Et(this.__actions__);return F.push({func:P,args:arguments,thisArg:r}),C.__chain__=N,C}return P.apply(r,Jr([this.value()],arguments))})}),r}function nb(){return _e._===this&&(_e._=Rg),this}function Tc(){}function sb(r){return r=fe(r),ge(function(i){return Dh(i,r)})}var ob=cc(Le),ab=cc(th),cb=cc(Ca);function Yl(r){return gc(r)?Da(Er(r)):jy(r)}function ub(r){return function(i){return r==null?t:Ei(r,i)}}var hb=rl(),lb=rl(!0);function Nc(){return[]}function Cc(){return!1}function fb(){return{}}function pb(){return""}function db(){return!0}function gb(r,i){if(r=fe(r),r<1||r>Z)return[];var a=ce,u=lt(r,ce);i=te(i),r-=ce;for(var l=qa(u,i);++a<r;)i(a);return l}function yb(r){return le(r)?Le(r,Er):qt(r)?[r]:Et(vl(xe(r)))}function mb(r){var i=++Ag;return xe(r)+i}var vb=lo(function(r,i){return r+i},0),wb=uc("ceil"),bb=lo(function(r,i){return r/i},1),_b=uc("floor");function Eb(r){return r&&r.length?no(r,Pt,Wa):t}function Ib(r,i){return r&&r.length?no(r,te(i,2),Wa):t}function Sb(r){return nh(r,Pt)}function Pb(r,i){return nh(r,te(i,2))}function xb(r){return r&&r.length?no(r,Pt,Ya):t}function Ob(r,i){return r&&r.length?no(r,te(i,2),Ya):t}var Ab=lo(function(r,i){return r*i},1),$b=uc("round"),Rb=lo(function(r,i){return r-i},0);function Tb(r){return r&&r.length?Fa(r,Pt):0}function Nb(r,i){return r&&r.length?Fa(r,te(i,2)):0}return p.after=ew,p.ary=$l,p.assign=Mw,p.assignIn=kl,p.assignInWith=Po,p.assignWith=Bw,p.at=kw,p.before=Rl,p.bind=_c,p.bindAll=W0,p.bindKey=Tl,p.castArray=fw,p.chain=xl,p.chunk=_m,p.compact=Em,p.concat=Im,p.cond=Q0,p.conforms=J0,p.constant=Ac,p.countBy=Tv,p.create=Hw,p.curry=Nl,p.curryRight=Cl,p.debounce=Dl,p.defaults=Vw,p.defaultsDeep=Kw,p.defer=tw,p.delay=rw,p.difference=Sm,p.differenceBy=Pm,p.differenceWith=xm,p.drop=Om,p.dropRight=Am,p.dropRightWhile=$m,p.dropWhile=Rm,p.fill=Tm,p.filter=Cv,p.flatMap=Fv,p.flatMapDeep=qv,p.flatMapDepth=jv,p.flatten=El,p.flattenDeep=Nm,p.flattenDepth=Cm,p.flip=iw,p.flow=Y0,p.flowRight=X0,p.fromPairs=Dm,p.functions=Xw,p.functionsIn=e0,p.groupBy=Lv,p.initial=Fm,p.intersection=qm,p.intersectionBy=jm,p.intersectionWith=Lm,p.invert=r0,p.invertBy=i0,p.invokeMap=Mv,p.iteratee=$c,p.keyBy=Bv,p.keys=tt,p.keysIn=St,p.map=wo,p.mapKeys=s0,p.mapValues=o0,p.matches=eb,p.matchesProperty=tb,p.memoize=_o,p.merge=a0,p.mergeWith=Hl,p.method=rb,p.methodOf=ib,p.mixin=Rc,p.negate=Eo,p.nthArg=sb,p.omit=c0,p.omitBy=u0,p.once=nw,p.orderBy=kv,p.over=ob,p.overArgs=sw,p.overEvery=ab,p.overSome=cb,p.partial=Ec,p.partialRight=Ul,p.partition=Hv,p.pick=h0,p.pickBy=Vl,p.property=Yl,p.propertyOf=ub,p.pull=km,p.pullAll=Sl,p.pullAllBy=Hm,p.pullAllWith=Vm,p.pullAt=Km,p.range=hb,p.rangeRight=lb,p.rearg=ow,p.reject=Gv,p.remove=Gm,p.rest=aw,p.reverse=wc,p.sampleSize=Qv,p.set=f0,p.setWith=p0,p.shuffle=Jv,p.slice=Wm,p.sortBy=Xv,p.sortedUniq=tv,p.sortedUniqBy=rv,p.split=F0,p.spread=cw,p.tail=iv,p.take=nv,p.takeRight=sv,p.takeRightWhile=ov,p.takeWhile=av,p.tap=Ev,p.throttle=uw,p.thru=vo,p.toArray=zl,p.toPairs=Kl,p.toPairsIn=Gl,p.toPath=yb,p.toPlainObject=Bl,p.transform=d0,p.unary=hw,p.union=cv,p.unionBy=uv,p.unionWith=hv,p.uniq=lv,p.uniqBy=fv,p.uniqWith=pv,p.unset=g0,p.unzip=bc,p.unzipWith=Pl,p.update=y0,p.updateWith=m0,p.values=ln,p.valuesIn=v0,p.without=dv,p.words=Jl,p.wrap=lw,p.xor=gv,p.xorBy=yv,p.xorWith=mv,p.zip=vv,p.zipObject=wv,p.zipObjectDeep=bv,p.zipWith=_v,p.entries=Kl,p.entriesIn=Gl,p.extend=kl,p.extendWith=Po,Rc(p,p),p.add=vb,p.attempt=Zl,p.camelCase=E0,p.capitalize=Wl,p.ceil=wb,p.clamp=w0,p.clone=pw,p.cloneDeep=gw,p.cloneDeepWith=yw,p.cloneWith=dw,p.conformsTo=mw,p.deburr=Ql,p.defaultTo=Z0,p.divide=bb,p.endsWith=I0,p.eq=ar,p.escape=S0,p.escapeRegExp=P0,p.every=Nv,p.find=Dv,p.findIndex=bl,p.findKey=Gw,p.findLast=Uv,p.findLastIndex=_l,p.findLastKey=Ww,p.floor=_b,p.forEach=Ol,p.forEachRight=Al,p.forIn=Qw,p.forInRight=Jw,p.forOwn=Zw,p.forOwnRight=Yw,p.get=Pc,p.gt=vw,p.gte=ww,p.has=t0,p.hasIn=xc,p.head=Il,p.identity=Pt,p.includes=zv,p.indexOf=Um,p.inRange=b0,p.invoke=n0,p.isArguments=Pi,p.isArray=le,p.isArrayBuffer=bw,p.isArrayLike=It,p.isArrayLikeObject=Ve,p.isBoolean=_w,p.isBuffer=ii,p.isDate=Ew,p.isElement=Iw,p.isEmpty=Sw,p.isEqual=Pw,p.isEqualWith=xw,p.isError=Ic,p.isFinite=Ow,p.isFunction=qr,p.isInteger=Fl,p.isLength=Io,p.isMap=ql,p.isMatch=Aw,p.isMatchWith=$w,p.isNaN=Rw,p.isNative=Tw,p.isNil=Cw,p.isNull=Nw,p.isNumber=jl,p.isObject=Me,p.isObjectLike=Be,p.isPlainObject=Vn,p.isRegExp=Sc,p.isSafeInteger=Dw,p.isSet=Ll,p.isString=So,p.isSymbol=qt,p.isTypedArray=hn,p.isUndefined=Uw,p.isWeakMap=Fw,p.isWeakSet=qw,p.join=zm,p.kebabCase=x0,p.last=Yt,p.lastIndexOf=Mm,p.lowerCase=O0,p.lowerFirst=A0,p.lt=jw,p.lte=Lw,p.max=Eb,p.maxBy=Ib,p.mean=Sb,p.meanBy=Pb,p.min=xb,p.minBy=Ob,p.stubArray=Nc,p.stubFalse=Cc,p.stubObject=fb,p.stubString=pb,p.stubTrue=db,p.multiply=Ab,p.nth=Bm,p.noConflict=nb,p.noop=Tc,p.now=bo,p.pad=$0,p.padEnd=R0,p.padStart=T0,p.parseInt=N0,p.random=_0,p.reduce=Vv,p.reduceRight=Kv,p.repeat=C0,p.replace=D0,p.result=l0,p.round=$b,p.runInContext=S,p.sample=Wv,p.size=Zv,p.snakeCase=U0,p.some=Yv,p.sortedIndex=Qm,p.sortedIndexBy=Jm,p.sortedIndexOf=Zm,p.sortedLastIndex=Ym,p.sortedLastIndexBy=Xm,p.sortedLastIndexOf=ev,p.startCase=q0,p.startsWith=j0,p.subtract=Rb,p.sum=Tb,p.sumBy=Nb,p.template=L0,p.times=gb,p.toFinite=jr,p.toInteger=fe,p.toLength=Ml,p.toLower=z0,p.toNumber=Xt,p.toSafeInteger=zw,p.toString=xe,p.toUpper=M0,p.trim=B0,p.trimEnd=k0,p.trimStart=H0,p.truncate=V0,p.unescape=K0,p.uniqueId=mb,p.upperCase=G0,p.upperFirst=Oc,p.each=Ol,p.eachRight=Al,p.first=Il,Rc(p,function(){var r={};return br(p,function(i,a){$e.call(p.prototype,a)||(r[a]=i)}),r}(),{chain:!1}),p.VERSION=s,Gt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(r){p[r].placeholder=p}),Gt(["drop","take"],function(r,i){ve.prototype[r]=function(a){a=a===t?1:Ye(fe(a),0);var u=this.__filtered__&&!i?new ve(this):this.clone();return u.__filtered__?u.__takeCount__=lt(a,u.__takeCount__):u.__views__.push({size:lt(a,ce),type:r+(u.__dir__<0?"Right":"")}),u},ve.prototype[r+"Right"]=function(a){return this.reverse()[r](a).reverse()}}),Gt(["filter","map","takeWhile"],function(r,i){var a=i+1,u=a==ie||a==j;ve.prototype[r]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:te(l,3),type:a}),g.__filtered__=g.__filtered__||u,g}}),Gt(["head","last"],function(r,i){var a="take"+(i?"Right":"");ve.prototype[r]=function(){return this[a](1).value()[0]}}),Gt(["initial","tail"],function(r,i){var a="drop"+(i?"":"Right");ve.prototype[r]=function(){return this.__filtered__?new ve(this):this[a](1)}}),ve.prototype.compact=function(){return this.filter(Pt)},ve.prototype.find=function(r){return this.filter(r).head()},ve.prototype.findLast=function(r){return this.reverse().find(r)},ve.prototype.invokeMap=ge(function(r,i){return typeof r=="function"?new ve(this):this.map(function(a){return Ln(a,r,i)})}),ve.prototype.reject=function(r){return this.filter(Eo(te(r)))},ve.prototype.slice=function(r,i){r=fe(r);var a=this;return a.__filtered__&&(r>0||i<0)?new ve(a):(r<0?a=a.takeRight(-r):r&&(a=a.drop(r)),i!==t&&(i=fe(i),a=i<0?a.dropRight(-i):a.take(i-r)),a)},ve.prototype.takeRightWhile=function(r){return this.reverse().takeWhile(r).reverse()},ve.prototype.toArray=function(){return this.take(ce)},br(ve.prototype,function(r,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=p[u?"take"+(i=="last"?"Right":""):i],g=u||/^find/.test(i);l&&(p.prototype[i]=function(){var w=this.__wrapped__,_=u?[1]:arguments,P=w instanceof ve,N=_[0],C=P||le(w),F=function(me){var Ee=l.apply(p,Jr([me],_));return u&&z?Ee[0]:Ee};C&&a&&typeof N=="function"&&N.length!=1&&(P=C=!1);var z=this.__chain__,W=!!this.__actions__.length,ne=g&&!z,pe=P&&!W;if(!g&&C){w=pe?w:new ve(this);var se=r.apply(w,_);return se.__actions__.push({func:vo,args:[F],thisArg:t}),new Qt(se,z)}return ne&&pe?r.apply(this,_):(se=this.thru(F),ne?u?se.value()[0]:se.value():se)})}),Gt(["pop","push","shift","sort","splice","unshift"],function(r){var i=ks[r],a=/^(?:push|sort|unshift)$/.test(r)?"tap":"thru",u=/^(?:pop|shift)$/.test(r);p.prototype[r]=function(){var l=arguments;if(u&&!this.__chain__){var g=this.value();return i.apply(le(g)?g:[],l)}return this[a](function(w){return i.apply(le(w)?w:[],l)})}}),br(ve.prototype,function(r,i){var a=p[i];if(a){var u=a.name+"";$e.call(sn,u)||(sn[u]=[]),sn[u].push({name:i,func:a})}}),sn[ho(t,V).name]=[{name:"wrapper",func:t}],ve.prototype.clone=Kg,ve.prototype.reverse=Gg,ve.prototype.value=Wg,p.prototype.at=Iv,p.prototype.chain=Sv,p.prototype.commit=Pv,p.prototype.next=xv,p.prototype.plant=Av,p.prototype.reverse=$v,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Rv,p.prototype.first=p.prototype.head,Nn&&(p.prototype[Nn]=Ov),p},tn=Pg();He?((He.exports=tn)._=tn,De._=tn):_e._=tn}).call(es)})($u,$u.exports);var tA=Object.defineProperty,rA=Object.defineProperties,iA=Object.getOwnPropertyDescriptors,Pp=Object.getOwnPropertySymbols,nA=Object.prototype.hasOwnProperty,sA=Object.prototype.propertyIsEnumerable,xp=(n,e,t)=>e in n?tA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Do=(n,e)=>{for(var t in e||(e={}))nA.call(e,t)&&xp(n,t,e[t]);if(Pp)for(var t of Pp(e))sA.call(e,t)&&xp(n,t,e[t]);return n},oA=(n,e)=>rA(n,iA(e));function ci(n,e,t){var s;const o=WO(n);return((s=e.rpcMap)==null?void 0:s[o.reference])||`${eA}?chainId=${o.namespace}:${o.reference}&projectId=${t}`}function Di(n){return n.includes(":")?n.split(":")[1]:n}function eg(n){return n.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function aA(n,e){const t=Object.keys(e.namespaces).filter(o=>o.includes(n));if(!t.length)return[];const s=[];return t.forEach(o=>{const c=e.namespaces[o].accounts;s.push(...c)}),s}function cA(n={},e={}){const t=Op(n),s=Op(e);return $u.exports.merge(t,s)}function Op(n){var e,t,s,o;const c={};if(!JO(n))return c;for(const[h,f]of Object.entries(n)){const y=Yu(h)?[h]:f.chains,d=f.methods||[],m=f.events||[],b=f.rpcMap||{},E=ns(h);c[E]=oA(Do(Do({},c[E]),f),{chains:su(y,(e=c[E])==null?void 0:e.chains),methods:su(d,(t=c[E])==null?void 0:t.methods),events:su(m,(s=c[E])==null?void 0:s.events),rpcMap:Do(Do({},b),(o=c[E])==null?void 0:o.rpcMap)})}return c}function uA(n){return n.includes(":")?n.split(":")[2]:n}function hA(n){const e={};for(const[t,s]of Object.entries(n)){const o=s.methods||[],c=s.events||[],h=s.accounts||[],f=Yu(t)?[t]:s.chains?s.chains:eg(s.accounts);e[t]={chains:f,methods:o,events:c,accounts:h}}return e}function ou(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const tg={},ze=n=>tg[n],au=(n,e)=>{tg[n]=e};class lA{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=Di(t);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class fA{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const s=t||ci(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=parseInt(Di(t));e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,s;let o=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class pA{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=Di(t);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class dA{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=Di(t);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class gA{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const s=this.getCardanoRPCUrl(t),o=Di(t);e[o]=this.createHttpProvider(o,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class yA{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=Di(t);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class mA{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const o=Di(t);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new hi(new ui(s,ze("disableProviderPing")))}}class vA{constructor(e){this.name="near",this.namespace=e.namespace,this.events=ze("events"),this.client=ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||ci(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Hr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||ci(e,this.namespace);return typeof s>"u"?void 0:new hi(new ui(s,ze("disableProviderPing")))}}var wA=Object.defineProperty,bA=Object.defineProperties,_A=Object.getOwnPropertyDescriptors,Ap=Object.getOwnPropertySymbols,EA=Object.prototype.hasOwnProperty,IA=Object.prototype.propertyIsEnumerable,$p=(n,e,t)=>e in n?wA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Uo=(n,e)=>{for(var t in e||(e={}))EA.call(e,t)&&$p(n,t,e[t]);if(Ap)for(var t of Ap(e))IA.call(e,t)&&$p(n,t,e[t]);return n},cu=(n,e)=>bA(n,_A(e));class Xu{constructor(e){this.events=new Fu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Jo(Zo({level:(e==null?void 0:e.logger)||Ip})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Xu(e);return await t.initialize(),t}async request(e,t){const[s,o]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Uo({},e),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(e,t,s){this.request(e,s).then(o=>t(null,o)).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:_p("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=hA(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Yd)throw c;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[s,o]=this.validateChain(e);this.getProvider(s).setDefaultChain(o,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Ep(t)){for(const s of t)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await KO.init({logger:this.providerOpts.logger||Ip,relayUrl:this.providerOpts.relayUrl||ZO,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>ns(t)))];au("client",this.client),au("events",this.events),au("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const s=aA(t,this.session),o=eg(s),c=cA(this.namespaces,this.optionalNamespaces),h=cu(Uo({},c[t]),{accounts:s,chains:o});switch(t){case"eip155":this.rpcProviders[t]=new fA({namespace:h});break;case"solana":this.rpcProviders[t]=new pA({namespace:h});break;case"cosmos":this.rpcProviders[t]=new dA({namespace:h});break;case"polkadot":this.rpcProviders[t]=new lA({namespace:h});break;case"cip34":this.rpcProviders[t]=new gA({namespace:h});break;case"elrond":this.rpcProviders[t]=new yA({namespace:h});break;case"multiversx":this.rpcProviders[t]=new mA({namespace:h});break;case"near":this.rpcProviders[t]=new vA({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:s}=t;if(s.name==="accountsChanged"){const o=s.data;o&&Ep(o)&&this.events.emit("accountsChanged",o.map(uA))}else if(s.name==="chainChanged"){const o=t.chainId,c=t.event.data,h=ns(o),f=ou(o)!==ou(c)?`${h}:${ou(c)}`:o;this.onChainChanged(f)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var s;const{namespaces:o}=t,c=(s=this.client)==null?void 0:s.session.get(e);this.session=cu(Uo({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",cu(Uo({},_p("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Hr.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:s,sessionProperties:o}=e;t&&Object.keys(t).length&&(this.namespaces=t),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",t),this.persist("optionalNamespaces",s)}validateChain(e){const[t,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(h=>ns(h)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];const o=ns(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){var s;if(!this.namespaces)return;const[o,c]=this.validateChain(e);t||this.getProvider(o).setDefaultChain(c),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${Sp}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${Sp}/${e}`)}}const SA=Xu,PA="wc",xA="ethereum_provider",OA=`${PA}@2:${xA}:`,AA="https://rpc.walletconnect.com/v1/",Ru=["eth_sendTransaction","personal_sign"],$A=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Tu=["chainChanged","accountsChanged"],RA=["chainChanged","accountsChanged","message","disconnect","connect"];var TA=Object.defineProperty,NA=Object.defineProperties,CA=Object.getOwnPropertyDescriptors,Rp=Object.getOwnPropertySymbols,DA=Object.prototype.hasOwnProperty,UA=Object.prototype.propertyIsEnumerable,Tp=(n,e,t)=>e in n?TA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ss=(n,e)=>{for(var t in e||(e={}))DA.call(e,t)&&Tp(n,t,e[t]);if(Rp)for(var t of Rp(e))UA.call(e,t)&&Tp(n,t,e[t]);return n},Np=(n,e)=>NA(n,CA(e));function Ko(n){return Number(n[0].split(":")[1])}function uu(n){return`0x${n.toString(16)}`}function FA(n){const{chains:e,optionalChains:t,methods:s,optionalMethods:o,events:c,optionalEvents:h,rpcMap:f}=n;if(!hu(e))throw new Error("Invalid chains");const y={chains:e,methods:s||Ru,events:c||Tu,rpcMap:ss({},e.length?{[Ko(e)]:f[Ko(e)]}:{})},d=c==null?void 0:c.filter(A=>!Tu.includes(A)),m=s==null?void 0:s.filter(A=>!Ru.includes(A));if(!t&&!h&&!o&&!(d!=null&&d.length)&&!(m!=null&&m.length))return{required:e.length?y:void 0};const b=(d==null?void 0:d.length)&&(m==null?void 0:m.length)||!t,E={chains:[...new Set(b?y.chains.concat(t||[]):t)],methods:[...new Set(y.methods.concat(o!=null&&o.length?o:$A))],events:[...new Set(y.events.concat(h!=null&&h.length?h:RA))],rpcMap:f};return{required:e.length?y:void 0,optional:t.length?E:void 0}}class eh{constructor(){this.events=new dr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=OA,this.on=(e,t)=>(this.events.on(e,t),this),this.once=(e,t)=>(this.events.once(e,t),this),this.removeListener=(e,t)=>(this.events.removeListener(e,t),this),this.off=(e,t)=>(this.events.off(e,t),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const t=new eh;return await t.initialize(e),t}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:s}=FA(this.rpc);try{const o=await new Promise(async(h,f)=>{var y;this.rpc.showQrModal&&((y=this.modal)==null||y.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),f(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Np(ss({namespaces:ss({},t&&{[this.namespace]:t})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(d=>{h(d)}).catch(d=>{f(new Error(d.message))})});if(!o)return;const c=Xb(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:uu(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:s}=t;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",uu(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Np(ss({},t1("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,s;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(s=this.modal)==null||s.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",uu(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,s,o]=e.split(":");return{chainId:`${t}:${s}`,address:o}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,s;const o=(t=e==null?void 0:e.chains)!=null?t:[],c=(s=e==null?void 0:e.optionalChains)!=null?s:[],h=o.concat(c);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const f=o.length?(e==null?void 0:e.methods)||Ru:[],y=o.length?(e==null?void 0:e.events)||Tu:[],d=(e==null?void 0:e.optionalMethods)||[],m=(e==null?void 0:e.optionalEvents)||[],b=(e==null?void 0:e.rpcMap)||this.buildRpcMap(h,e.projectId),E=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(A=>this.formatChainId(A)),optionalChains:c.map(A=>this.formatChainId(A)),methods:f,events:y,optionalMethods:d,optionalEvents:m,rpcMap:b,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:E,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const s={};return e.forEach(o=>{s[o]=this.getRpcUrl(o,t)}),s}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Ko(this.rpc.chains):Ko(this.rpc.optionalChains),this.signer=await SA.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:s}=await Kb(()=>import("./index-C9j5dvsw.js").then(o=>o.i),__vite__mapDeps([0,1,2]));t=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(ss({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:s,rpcMap:o}=e;t&&hu(t)&&(this.rpc.chains=t.map(c=>this.formatChainId(c)),t.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),s&&hu(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(c=>this.formatChainId(c)),s.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(e,t){var s;return((s=this.rpc.rpcMap)==null?void 0:s[e])||`${AA}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const a$=eh;export{a$ as EthereumProvider,RA as OPTIONAL_EVENTS,$A as OPTIONAL_METHODS,Tu as REQUIRED_EVENTS,Ru as REQUIRED_METHODS,eh as default};
